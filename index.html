<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>–î–Ω–µ–≤–Ω–∏–∫ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#FF6B35">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏">
    <link rel="stylesheet" href="css/styles.css">
    <!-- Google Identity Services -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>

    <!-- –ó–∞–≥—Ä—É–∑–∫–∞ -->
    <div id="loading" class="loading">
        <div class="loading-spinner"></div>
        <div class="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>

    <!-- –ë–∞–Ω–Ω–µ—Ä –¥–µ–º–æ-—Ä–µ–∂–∏–º–∞ -->
    <div id="demo-banner" class="demo-banner hidden">
        <span>–î–µ–º–æ-—Ä–µ–∂–∏–º</span>
        <button onclick="exitDemoAndLogin()">–í–æ–π—Ç–∏ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è</button>
    </div>

    <!-- ==================== –°–¢–†–ê–ù–ò–¶–ê: –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø ==================== -->
    <section id="page-auth" class="page auth-page">
        <div class="auth-container">
            <div class="auth-logo">
                <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="#FF6B35" stroke-width="2">
                    <path d="M6.5 6.5m-2.5 0a2.5 2.5 0 1 0 5 0a2.5 2.5 0 1 0 -5 0"/>
                    <path d="M17.5 6.5m-2.5 0a2.5 2.5 0 1 0 5 0a2.5 2.5 0 1 0 -5 0"/>
                    <path d="M4 12h2.5l1.5 5l2.5 -5h3l2.5 5l1.5 -5h2.5"/>
                    <path d="M4 17h16"/>
                </svg>
            </div>
            <h1 class="auth-title">–î–Ω–µ–≤–Ω–∏–∫ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</h1>
            <p class="auth-subtitle">–û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ –¥–æ—Å—Ç–∏–≥–∞–π—Ç–µ —Ü–µ–ª–µ–π</p>

            <div class="auth-features">
                <div class="auth-feature">
                    <span class="auth-feature-icon">üìä</span>
                    <span>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –≥—Ä–∞—Ñ–∏–∫–∏</span>
                </div>
                <div class="auth-feature">
                    <span class="auth-feature-icon">üì±</span>
                    <span>–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö</span>
                </div>
                <div class="auth-feature">
                    <span class="auth-feature-icon">üîí</span>
                    <span>–õ–∏—á–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç</span>
                </div>
            </div>

            <button class="btn-google" id="google-signin-btn" onclick="signInWithGoogle()">
                <svg width="20" height="20" viewBox="0 0 24 24">
                    <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                    <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                    <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                    <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                </svg>
                –í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google
            </button>

            <div class="auth-divider">
                <span>–∏–ª–∏</span>
            </div>

            <button class="btn-demo" onclick="startDemoMode()">
                –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –¥–µ–º–æ
            </button>

            <p class="auth-note">–í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –Ω–∞–¥—ë–∂–Ω–æ –∑–∞—â–∏—â–µ–Ω—ã –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏</p>
        </div>
    </section>

    <!-- ==================== –°–¢–†–ê–ù–ò–¶–ê: –¢–†–ï–ù–ò–†–û–í–ö–ê ==================== -->
    <section id="page-workout" class="page">
        <div class="header">
            <div class="header-left">
                <div class="header-greeting" id="header-date">–°–µ–≥–æ–¥–Ω—è</div>
                <div class="header-title">–ù–æ–≤–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</div>
            </div>
            <button class="user-profile-btn" id="user-profile-btn" onclick="showUserMenu()">
                <img id="user-avatar" src="" alt="" class="user-avatar">
            </button>
        </div>

        <div class="container">
            <!-- –î–∞—Ç–∞ -->
            <div class="date-picker" onclick="openDatePicker()">
                <div class="date-picker-icon">
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                        <line x1="16" y1="2" x2="16" y2="6"/>
                        <line x1="8" y1="2" x2="8" y2="6"/>
                        <line x1="3" y1="10" x2="21" y2="10"/>
                    </svg>
                </div>
                <div class="date-picker-text">
                    <div class="date-picker-label">–î–∞—Ç–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</div>
                    <div class="date-picker-value" id="workout-date-display">–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫, 9 –¥–µ–∫–∞–±—Ä—è</div>
                </div>
                <input type="date" id="workout-date" style="position: absolute; opacity: 0; width: 0;">
            </div>

            <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π -->
            <div id="exercises-container">
                <!-- –£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>

            <!-- –î–æ–±–∞–≤–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ -->
            <button class="btn btn-secondary" onclick="showAddExerciseModal()" style="margin-bottom: 16px;">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="5" x2="12" y2="19"/>
                    <line x1="5" y1="12" x2="19" y2="12"/>
                </svg>
                –î–æ–±–∞–≤–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ
            </button>

            <!-- –ó–∞–≤–µ—Ä—à–∏—Ç—å -->
            <button class="btn btn-primary" onclick="showConfirmModal()" id="save-workout-btn" style="display: none;">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 6L9 17l-5-5"/>
                </svg>
                –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É
            </button>
        </div>
    </section>

    <!-- ==================== –°–¢–†–ê–ù–ò–¶–ê: –ò–°–¢–û–†–ò–Ø ==================== -->
    <section id="page-history" class="page">
        <div class="header">
            <div class="header-title">–ò—Å—Ç–æ—Ä–∏—è</div>
            <button class="user-profile-btn" onclick="showUserMenu()">
                <img src="" alt="" class="user-avatar">
            </button>
        </div>

        <div class="container">
            <div id="history-container">
                <div class="empty-state">–ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏...</div>
            </div>
        </div>
    </section>

    <!-- ==================== –°–¢–†–ê–ù–ò–¶–ê: –°–¢–ê–¢–ò–°–¢–ò–ö–ê ==================== -->
    <section id="page-stats" class="page">
        <div class="header">
            <div class="header-title">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
            <button class="user-profile-btn" onclick="showUserMenu()">
                <img src="" alt="" class="user-avatar">
            </button>
        </div>

        <div class="container">
            <div class="form-group">
                <select id="stats-exercise-select" onchange="loadStats()">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ...</option>
                </select>
            </div>

            <div id="stats-container" style="display: none;">
                <div class="stats-grid">
                    <div class="stat-card highlight">
                        <div class="stat-icon">üèÜ</div>
                        <div class="stat-value" id="stat-max-weight">0 –∫–≥</div>
                        <div class="stat-label">–ú–∞–∫—Å. –≤–µ—Å</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üìä</div>
                        <div class="stat-value" id="stat-total-sets">0</div>
                        <div class="stat-label">–í—Å–µ–≥–æ –ø–æ–¥—Ö–æ–¥–æ–≤</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üîÑ</div>
                        <div class="stat-value" id="stat-total-reps">0</div>
                        <div class="stat-label">–í—Å–µ–≥–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üóì</div>
                        <div class="stat-value" id="stat-last-date">‚Äî</div>
                        <div class="stat-label">–ü–æ—Å–ª–µ–¥–Ω—è—è</div>
                    </div>
                </div>

                <div class="chart-card">
                    <div class="chart-title">–ü—Ä–æ–≥—Ä–µ—Å—Å –≤–µ—Å–∞</div>
                    <canvas id="weight-chart"></canvas>
                </div>
            </div>

            <!-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –º–µ—Å—è—Ü -->
            <div id="stats-overview">
                <div class="stats-period-header">
                    <span class="stats-period-title">–ü–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π</span>
                </div>

                <div class="stats-grid">
                    <div class="stat-card highlight">
                        <div class="stat-icon">üèãÔ∏è</div>
                        <div class="stat-value" id="overview-workouts">0</div>
                        <div class="stat-label">—Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üìä</div>
                        <div class="stat-value" id="overview-volume">0—Ç</div>
                        <div class="stat-label">–æ–±—â–∏–π –æ–±—ä—ë–º</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üí™</div>
                        <div class="stat-value" id="overview-exercises">0</div>
                        <div class="stat-label">—É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üîÑ</div>
                        <div class="stat-value" id="overview-sets">0</div>
                        <div class="stat-label">–ø–æ–¥—Ö–æ–¥–æ–≤</div>
                    </div>
                </div>

                <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –ø—Ä–æ—à–ª—ã–º –º–µ—Å—è—Ü–µ–º -->
                <div id="progress-comparison" class="progress-card" style="display: none;">
                    <div class="progress-card-title">–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –ø—Ä–æ—à–ª—ã–º –º–µ—Å—è—Ü–µ–º</div>
                    <div class="progress-items" id="progress-items">
                        <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                </div>

                <!-- –ì—Ä–∞—Ñ–∏–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ -->
                <div class="chart-card">
                    <div class="chart-title">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ –¥–Ω—è–º</div>
                    <canvas id="activity-chart"></canvas>
                </div>

                <!-- –¢–æ–ø —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π -->
                <div class="chart-card" style="margin-top: 16px !important;">
                    <div class="chart-title">–¢–æ–ø —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π</div>
                    <div id="top-exercises-list">
                        <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ==================== –°–¢–†–ê–ù–ò–¶–ê: –£–ü–†–ê–ñ–ù–ï–ù–ò–Ø ==================== -->
    <section id="page-exercises" class="page">
        <div class="header">
            <div class="header-title">–£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è</div>
            <button class="user-profile-btn" onclick="showUserMenu()">
                <img src="" alt="" class="user-avatar">
            </button>
        </div>

        <div class="container" id="exercises-list-container">
            <div class="empty-state">–ó–∞–≥—Ä—É–∑–∫–∞ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π...</div>
        </div>
    </section>

    <!-- ==================== –°–¢–†–ê–ù–ò–¶–ê: –ü–ê–†–ê–ú–ï–¢–†–´ –¢–ï–õ–ê ==================== -->
    <section id="page-body" class="page">
        <div class="header">
            <div class="header-title">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–µ–ª–∞</div>
            <button class="user-profile-btn" onclick="showUserMenu()">
                <img src="" alt="" class="user-avatar">
            </button>
        </div>

        <div class="container">
            <!-- –§–æ—Ä–º–∞ –≤–≤–æ–¥–∞ -->
            <div class="body-form-card">
                <div class="body-form-header">
                    <span class="body-form-icon">üìè</span>
                    <span class="body-form-title">–ù–æ–≤–æ–µ –∏–∑–º–µ—Ä–µ–Ω–∏–µ</span>
                </div>

                <div class="body-metrics-grid">
                    <div class="body-input-group">
                        <label>–†–æ—Å—Ç (—Å–º)</label>
                        <input type="number" id="input-height" placeholder="178" step="0.1" oninput="updateBodyFatPreview()">
                    </div>
                    <div class="body-input-group">
                        <label>–í–µ—Å (–∫–≥)</label>
                        <input type="number" id="input-weight" placeholder="80" step="0.1">
                    </div>
                    <div class="body-input-group">
                        <label>–®–µ—è (—Å–º)</label>
                        <input type="number" id="input-neck" placeholder="38" step="0.1" oninput="updateBodyFatPreview()">
                    </div>
                    <div class="body-input-group">
                        <label>–¢–∞–ª–∏—è (—Å–º)</label>
                        <input type="number" id="input-waist" placeholder="85" step="0.1" oninput="updateBodyFatPreview()">
                    </div>
                </div>

                <!-- –†–∞—Å—á–µ—Ç–Ω—ã–π % –∂–∏—Ä–∞ -->
                <div class="body-fat-preview" id="body-fat-preview" style="display: none;">
                    <div class="body-fat-label">–ü—Ä–æ—Ü–µ–Ω—Ç –∂–∏—Ä–∞ (—Ä–∞—Å—á—ë—Ç–Ω—ã–π)</div>
                    <div class="body-fat-value" id="body-fat-value">‚Äî</div>
                    <div class="body-fat-formula">–§–æ—Ä–º—É–ª–∞ –í–ú–° –°–®–ê –¥–ª—è –º—É–∂—á–∏–Ω</div>
                </div>

                <button class="btn btn-primary" onclick="saveBodyMetric()" id="save-metric-btn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 6L9 17l-5-5"/>
                    </svg>
                    –ó–∞–ø–∏—Å–∞—Ç—å –∏–∑–º–µ—Ä–µ–Ω–∏—è
                </button>
            </div>

            <!-- –¢–µ–∫—É—â–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ -->
            <div id="current-body-metrics" style="display: none;">
                <div class="section-title">–¢–µ–∫—É—â–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏</div>
                <div class="stats-grid">
                    <div class="stat-card highlight">
                        <div class="stat-icon">‚öñÔ∏è</div>
                        <div class="stat-value" id="current-weight-val">‚Äî</div>
                        <div class="stat-label">–í–µ—Å</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üìâ</div>
                        <div class="stat-value" id="current-body-fat">‚Äî</div>
                        <div class="stat-label">% –∂–∏—Ä–∞</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üìè</div>
                        <div class="stat-value" id="current-waist">‚Äî</div>
                        <div class="stat-label">–¢–∞–ª–∏—è</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üìà</div>
                        <div class="stat-value" id="weight-change">‚Äî</div>
                        <div class="stat-label">–ò–∑–º–µ–Ω–µ–Ω–∏–µ</div>
                    </div>
                </div>
            </div>

            <!-- –ì—Ä–∞—Ñ–∏–∫–∏ -->
            <div id="body-charts" style="display: none;">
                <div class="chart-card">
                    <div class="chart-title">–î–∏–Ω–∞–º–∏–∫–∞ –≤–µ—Å–∞</div>
                    <canvas id="weight-body-chart"></canvas>
                </div>

                <div class="chart-card" style="margin-top: 16px;">
                    <div class="chart-title">–î–∏–Ω–∞–º–∏–∫–∞ % –∂–∏—Ä–∞</div>
                    <canvas id="body-fat-chart"></canvas>
                </div>
            </div>

            <!-- –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ—Ä–µ–Ω–∏–π -->
            <div id="body-metrics-history" style="display: none;">
                <div class="section-title">–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ—Ä–µ–Ω–∏–π</div>
                <div id="body-metrics-history-list">
                    <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>
        </div>
    </section>

    <!-- ==================== –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û: –í–´–ë–û–† –£–ü–†–ê–ñ–ù–ï–ù–ò–Ø ==================== -->
    <div id="add-exercise-modal" class="modal hidden">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>–í—ã–±–µ—Ä–∏—Ç–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</h2>
                <button class="btn-icon" onclick="hideAddExerciseModal()">√ó</button>
            </div>
            <div class="modal-body" id="exercise-select-list">
                <!-- –°–ø–∏—Å–æ–∫ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π -->
            </div>
        </div>
    </div>

    <!-- ==================== –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û: –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–ò–Ø ==================== -->
    <div id="confirm-modal" class="modal hidden">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>–ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É?</h2>
                <button class="btn-icon" onclick="hideConfirmModal()">√ó</button>
            </div>
            <div class="modal-body" id="confirm-modal-body">
                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ -->
            </div>
            <div class="confirm-modal-actions">
                <button class="btn btn-secondary" onclick="hideConfirmModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" onclick="confirmSaveWorkout()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 6L9 17l-5-5"/>
                    </svg>
                    –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                </button>
            </div>
        </div>
    </div>

    <!-- ==================== –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û: –¢–ê–ô–ú–ï–† ==================== -->
    <div id="timer-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-title">–û—Ç–¥—ã—Ö</div>
            <div class="timer-circle">
                <svg class="timer-svg" width="200" height="200">
                    <circle class="timer-bg" cx="100" cy="100" r="90" />
                    <circle class="timer-progress" id="timer-progress" cx="100" cy="100" r="90" />
                </svg>
                <div class="timer-display" id="timer-display">02:00</div>
            </div>
            <div class="timer-controls">
                <button class="btn btn-secondary btn-small" onclick="addTimerTime(15)">+15 —Å–µ–∫</button>
                <button class="btn btn-primary btn-small" onclick="stopTimer()">–ì–æ—Ç–æ–≤–æ</button>
            </div>
        </div>
    </div>

    <!-- ==================== –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û: –ú–ï–ù–Æ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø ==================== -->
    <div id="user-menu-modal" class="modal hidden">
        <div class="modal-content modal-small">
            <div class="user-menu-header">
                <img id="user-menu-avatar" src="" alt="" class="user-menu-avatar">
                <div class="user-menu-info">
                    <div class="user-menu-name" id="user-menu-name"></div>
                    <div class="user-menu-email" id="user-menu-email"></div>
                </div>
            </div>
            <div class="user-menu-divider"></div>
            <button class="user-menu-item" onclick="signOut()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                    <polyline points="16 17 21 12 16 7"/>
                    <line x1="21" y1="12" x2="9" y2="12"/>
                </svg>
                –í—ã–π—Ç–∏
            </button>
            <button class="user-menu-item cancel" onclick="hideUserMenu()">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <!-- ==================== –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û: –î–ï–ú–û-–°–û–•–†–ê–ù–ï–ù–ò–ï ==================== -->
    <div id="demo-save-modal" class="modal hidden">
        <div class="modal-content">
            <div class="demo-modal-icon">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#FF6B35" stroke-width="2">
                    <path d="M12 9v4"/>
                    <path d="M12 17h.01"/>
                    <path d="M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0"/>
                </svg>
            </div>
            <h3 class="demo-modal-title">–≠—Ç–æ –¥–µ–º–æ-—Ä–µ–∂–∏–º</h3>
            <p class="demo-modal-text">–î–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç Google</p>
            <div class="demo-modal-actions">
                <button class="btn btn-primary" onclick="exitDemoAndLogin()">–í–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç</button>
                <button class="btn btn-secondary" onclick="hideDemoSaveModal()">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –¥–µ–º–æ</button>
            </div>
        </div>
    </div>

    <!-- ==================== –ù–ê–í–ò–ì–ê–¶–ò–Ø ==================== -->
    <nav class="nav">
        <button class="nav-btn" onclick="showPage('exercises')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M4 6h16M4 12h16M4 18h16"/>
            </svg>
            –£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
        </button>
        <button class="nav-btn" onclick="showPage('history')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 8v4l3 3"/>
                <circle cx="12" cy="12" r="10"/>
            </svg>
            –ò—Å—Ç–æ—Ä–∏—è
        </button>
        <button class="nav-btn nav-btn-main active" onclick="showPage('workout')">
            <svg viewBox="0 0 24 24" fill="none"></svg>
            –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞
        </button>
        <button class="nav-btn" onclick="showPage('stats')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M18 20V10M12 20V4M6 20v-6"/>
            </svg>
            –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        </button>
        <button class="nav-btn" onclick="showPage('body')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="5" r="3"/>
                <path d="M12 8v8"/>
                <path d="M9 21l3-5 3 5"/>
                <path d="M7 12h10"/>
            </svg>
            –ü–∞—Ä–∞–º–µ—Ç—Ä—ã
        </button>
    </nav>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- API -->
    <script src="js/api.js"></script>

    <!-- –ì–ª–∞–≤–Ω—ã–π —Å–∫—Ä–∏–ø—Ç -->
    <script>
        // ============================================
        // –ù–ê–°–¢–†–û–ô–ö–ò GOOGLE AUTH
        // ============================================
        const GOOGLE_CLIENT_ID = '170990227936-afe8ef92mc5aji5npde0hfcq512p86ee.apps.googleusercontent.com';

        // ============================================
        // –°–û–°–¢–û–Ø–ù–ò–ï –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø
        // ============================================
        let exercises = [];
        let currentWorkout = []; // –ú–∞—Å—Å–∏–≤ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π —Ç–µ–∫—É—â–µ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
        let workoutDate = new Date().toISOString().split('T')[0];
        let weightChart = null;
        let lastWorkoutData = {}; // –ö—ç—à –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è–º
        let googleAuth = null;
        let isDemo = false; // –§–ª–∞–≥ –¥–µ–º–æ-—Ä–µ–∂–∏–º–∞
        let bodyMetrics = []; // –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ—Ä–µ–Ω–∏–π —Ç–µ–ª–∞
        let weightBodyChart = null; // –ì—Ä–∞—Ñ–∏–∫ –≤–µ—Å–∞ —Ç–µ–ª–∞
        let bodyFatChart = null; // –ì—Ä–∞—Ñ–∏–∫ % –∂–∏—Ä–∞

        // ============================================
        // –î–ï–ú–û-–î–ê–ù–ù–´–ï
        // ============================================
        const DEMO_EXERCISES = [
            { id: 'ex_dips', name: '–ë—Ä—É—Å—å—è', category: '–ì—Ä—É–¥—å', type: 'base' },
            { id: 'ex_chest_press', name: '–ñ–∏–º –Ω–∞ –≥—Ä—É–¥—å', category: '–ì—Ä—É–¥—å', type: 'base' },
            { id: 'ex_butterfly', name: '–ë–∞–±–æ—á–∫–∞', category: '–ì—Ä—É–¥—å', type: 'isolation' },
            { id: 'ex_pullups', name: '–ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è', category: '–°–ø–∏–Ω–∞', type: 'base' },
            { id: 'ex_horizontal_row', name: '–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ —Ç—è–≥–∏', category: '–°–ø–∏–Ω–∞', type: 'base' },
            { id: 'ex_reverse_fly', name: '–û–±—Ä–∞—Ç–Ω–æ–µ —Ä–∞–∑–≤–µ–¥–µ–Ω–∏–µ', category: '–°–ø–∏–Ω–∞', type: 'isolation' },
            { id: 'ex_shoulder_press_dumbbell', name: '–ñ–∏–º –≥–∞–Ω—Ç–µ–ª–µ–π', category: '–ü–ª–µ—á–∏', type: 'base' },
            { id: 'ex_shoulder_press_machine', name: '–ñ–∏–º –≤ —Ç—Ä–µ–Ω–∞–∂—ë—Ä–µ', category: '–ü–ª–µ—á–∏', type: 'base' },
            { id: 'ex_lateral_raise', name: '–†–∞–∑–≤–µ–¥–µ–Ω–∏–µ –≥–∞–Ω—Ç–µ–ª–µ–π', category: '–ü–ª–µ—á–∏', type: 'isolation' },
            { id: 'ex_leg_press', name: '–ñ–∏–º –Ω–æ–≥–∞–º–∏', category: '–ù–æ–≥–∏', type: 'base' },
            { id: 'ex_hack_squat', name: '–ì–∞–∫–∫-–ø—Ä–∏—Å–µ–¥–∞–Ω–∏—è', category: '–ù–æ–≥–∏', type: 'base' },
            { id: 'ex_leg_curl', name: '–°–≥–∏–±–∞–Ω–∏–µ –Ω–æ–≥', category: '–ù–æ–≥–∏', type: 'isolation' },
            { id: 'ex_bicep_curl', name: '–°–≥–∏–±–∞–Ω–∏–µ —Ä—É–∫', category: '–ë–∏—Ü–µ–ø—Å', type: 'isolation' },
            { id: 'ex_tricep_extension', name: '–†–∞–∑–≥–∏–±–∞–Ω–∏–µ —Ä—É–∫', category: '–¢—Ä–∏—Ü–µ–ø—Å', type: 'isolation' }
        ];

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–µ–º–æ-—Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 2 –Ω–µ–¥–µ–ª–∏
        function generateDemoWorkouts() {
            const workouts = [];
            const today = new Date();

            // –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ 1: 3 –¥–Ω—è –Ω–∞–∑–∞–¥ (–ì—Ä—É–¥—å + –¢—Ä–∏—Ü–µ–ø—Å)
            const date1 = new Date(today);
            date1.setDate(date1.getDate() - 3);
            const d1 = date1.toISOString().split('T')[0];
            workouts.push(
                { date: d1, exercise_id: 'ex_dips', exercise_name: '–ë—Ä—É—Å—å—è', weight: 0, reps: 15 },
                { date: d1, exercise_id: 'ex_dips', exercise_name: '–ë—Ä—É—Å—å—è', weight: 0, reps: 12 },
                { date: d1, exercise_id: 'ex_dips', exercise_name: '–ë—Ä—É—Å—å—è', weight: 0, reps: 10 },
                { date: d1, exercise_id: 'ex_chest_press', exercise_name: '–ñ–∏–º –Ω–∞ –≥—Ä—É–¥—å', weight: 60, reps: 12 },
                { date: d1, exercise_id: 'ex_chest_press', exercise_name: '–ñ–∏–º –Ω–∞ –≥—Ä—É–¥—å', weight: 70, reps: 10 },
                { date: d1, exercise_id: 'ex_chest_press', exercise_name: '–ñ–∏–º –Ω–∞ –≥—Ä—É–¥—å', weight: 70, reps: 8 },
                { date: d1, exercise_id: 'ex_tricep_extension', exercise_name: '–†–∞–∑–≥–∏–±–∞–Ω–∏–µ —Ä—É–∫', weight: 25, reps: 15 },
                { date: d1, exercise_id: 'ex_tricep_extension', exercise_name: '–†–∞–∑–≥–∏–±–∞–Ω–∏–µ —Ä—É–∫', weight: 25, reps: 12 }
            );

            // –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ 2: 5 –¥–Ω–µ–π –Ω–∞–∑–∞–¥ (–°–ø–∏–Ω–∞ + –ë–∏—Ü–µ–ø—Å)
            const date2 = new Date(today);
            date2.setDate(date2.getDate() - 5);
            const d2 = date2.toISOString().split('T')[0];
            workouts.push(
                { date: d2, exercise_id: 'ex_pullups', exercise_name: '–ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è', weight: 0, reps: 12 },
                { date: d2, exercise_id: 'ex_pullups', exercise_name: '–ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è', weight: 0, reps: 10 },
                { date: d2, exercise_id: 'ex_pullups', exercise_name: '–ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è', weight: 0, reps: 8 },
                { date: d2, exercise_id: 'ex_horizontal_row', exercise_name: '–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ —Ç—è–≥–∏', weight: 50, reps: 12 },
                { date: d2, exercise_id: 'ex_horizontal_row', exercise_name: '–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ —Ç—è–≥–∏', weight: 55, reps: 10 },
                { date: d2, exercise_id: 'ex_horizontal_row', exercise_name: '–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ —Ç—è–≥–∏', weight: 55, reps: 10 },
                { date: d2, exercise_id: 'ex_bicep_curl', exercise_name: '–°–≥–∏–±–∞–Ω–∏–µ —Ä—É–∫', weight: 12, reps: 15 },
                { date: d2, exercise_id: 'ex_bicep_curl', exercise_name: '–°–≥–∏–±–∞–Ω–∏–µ —Ä—É–∫', weight: 14, reps: 12 }
            );

            // –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ 3: 7 –¥–Ω–µ–π –Ω–∞–∑–∞–¥ (–ù–æ–≥–∏)
            const date3 = new Date(today);
            date3.setDate(date3.getDate() - 7);
            const d3 = date3.toISOString().split('T')[0];
            workouts.push(
                { date: d3, exercise_id: 'ex_leg_press', exercise_name: '–ñ–∏–º –Ω–æ–≥–∞–º–∏', weight: 120, reps: 15 },
                { date: d3, exercise_id: 'ex_leg_press', exercise_name: '–ñ–∏–º –Ω–æ–≥–∞–º–∏', weight: 140, reps: 12 },
                { date: d3, exercise_id: 'ex_leg_press', exercise_name: '–ñ–∏–º –Ω–æ–≥–∞–º–∏', weight: 140, reps: 10 },
                { date: d3, exercise_id: 'ex_hack_squat', exercise_name: '–ì–∞–∫–∫-–ø—Ä–∏—Å–µ–¥–∞–Ω–∏—è', weight: 80, reps: 12 },
                { date: d3, exercise_id: 'ex_hack_squat', exercise_name: '–ì–∞–∫–∫-–ø—Ä–∏—Å–µ–¥–∞–Ω–∏—è', weight: 90, reps: 10 },
                { date: d3, exercise_id: 'ex_hack_squat', exercise_name: '–ì–∞–∫–∫-–ø—Ä–∏—Å–µ–¥–∞–Ω–∏—è', weight: 90, reps: 8 },
                { date: d3, exercise_id: 'ex_leg_curl', exercise_name: '–°–≥–∏–±–∞–Ω–∏–µ –Ω–æ–≥', weight: 40, reps: 15 },
                { date: d3, exercise_id: 'ex_leg_curl', exercise_name: '–°–≥–∏–±–∞–Ω–∏–µ –Ω–æ–≥', weight: 45, reps: 12 }
            );

            // –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ 4: 10 –¥–Ω–µ–π –Ω–∞–∑–∞–¥ (–ü–ª–µ—á–∏)
            const date4 = new Date(today);
            date4.setDate(date4.getDate() - 10);
            const d4 = date4.toISOString().split('T')[0];
            workouts.push(
                { date: d4, exercise_id: 'ex_shoulder_press_dumbbell', exercise_name: '–ñ–∏–º –≥–∞–Ω—Ç–µ–ª–µ–π', weight: 20, reps: 12 },
                { date: d4, exercise_id: 'ex_shoulder_press_dumbbell', exercise_name: '–ñ–∏–º –≥–∞–Ω—Ç–µ–ª–µ–π', weight: 22, reps: 10 },
                { date: d4, exercise_id: 'ex_shoulder_press_dumbbell', exercise_name: '–ñ–∏–º –≥–∞–Ω—Ç–µ–ª–µ–π', weight: 22, reps: 8 },
                { date: d4, exercise_id: 'ex_lateral_raise', exercise_name: '–†–∞–∑–≤–µ–¥–µ–Ω–∏–µ –≥–∞–Ω—Ç–µ–ª–µ–π', weight: 10, reps: 15 },
                { date: d4, exercise_id: 'ex_lateral_raise', exercise_name: '–†–∞–∑–≤–µ–¥–µ–Ω–∏–µ –≥–∞–Ω—Ç–µ–ª–µ–π', weight: 10, reps: 12 }
            );

            return workouts;
        }

        let DEMO_WORKOUTS = [];

        // ============================================
        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
        // ============================================
        document.addEventListener('DOMContentLoaded', async () => {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
            if (!API.isAuthenticated()) {
                showAuthPage();
                document.getElementById('loading').classList.add('hidden');
                return;
            }

            // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω - –∑–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
            await initApp();
        });

        // –°–ª—É—à–∞–µ–º —Å–æ–±—ã—Ç–∏–µ logout
        window.addEventListener('auth:logout', () => {
            showAuthPage();
        });

        /**
         * –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
         */
        function showAuthPage() {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('page-auth').classList.add('active');
            document.querySelector('.nav').style.display = 'none';
        }

        /**
         * –ü–æ–∫–∞–∑–∞—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
         */
        function showMainApp() {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('page-workout').classList.add('active');
            document.querySelector('.nav').style.display = 'flex';

            // –û–±–Ω–æ–≤–ª—è–µ–º UI –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            updateUserUI();
        }

        /**
         * –û–±–Ω–æ–≤–∏—Ç—å UI –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
         */
        function updateUserUI() {
            if (isDemo) {
                // –î–µ–º–æ-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
                const demoAvatar = 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23FF6B35"><circle cx="12" cy="8" r="4"/><path d="M12 14c-6 0-8 3-8 6v2h16v-2c0-3-2-6-8-6z"/></svg>';
                document.querySelectorAll('.user-avatar').forEach(img => img.src = demoAvatar);
                document.getElementById('user-menu-avatar').src = demoAvatar;
                document.getElementById('user-menu-name').textContent = '–î–µ–º–æ-—Ä–µ–∂–∏–º';
                document.getElementById('user-menu-email').textContent = '–í–æ–π–¥–∏—Ç–µ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö';
                return;
            }

            const user = API.getCurrentUser();
            if (user) {
                const avatar = user.picture || 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23999"><circle cx="12" cy="8" r="4"/><path d="M12 14c-6 0-8 3-8 6v2h16v-2c0-3-2-6-8-6z"/></svg>';
                // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ –∞–≤–∞—Ç–∞—Ä—ã –Ω–∞ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö
                document.querySelectorAll('.user-avatar').forEach(img => img.src = avatar);
                document.getElementById('user-menu-avatar').src = avatar;
                document.getElementById('user-menu-name').textContent = user.name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
                document.getElementById('user-menu-email').textContent = user.email || '';
            }
        }

        /**
         * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Google Sign-In
         */
        function initGoogleSignIn() {
            if (typeof google !== 'undefined' && google.accounts) {
                google.accounts.id.initialize({
                    client_id: GOOGLE_CLIENT_ID,
                    callback: handleGoogleSignIn,
                    auto_select: false
                });
            }
        }

        /**
         * –í—Ö–æ–¥ —á–µ—Ä–µ–∑ Google
         */
        function signInWithGoogle() {
            if (typeof google !== 'undefined' && google.accounts) {
                google.accounts.id.prompt((notification) => {
                    if (notification.isNotDisplayed() || notification.isSkippedMoment()) {
                        // One Tap –Ω–µ –ø–æ–∫–∞–∑–∞–ª—Å—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º popup
                        google.accounts.oauth2.initTokenClient({
                            client_id: GOOGLE_CLIENT_ID,
                            scope: 'email profile',
                            callback: (response) => {
                                if (response.access_token) {
                                    // –ü–æ–ª—É—á–∞–µ–º ID token —á–µ—Ä–µ–∑ access token
                                    fetchGoogleUserInfo(response.access_token);
                                }
                            }
                        }).requestAccessToken();
                    }
                });
            } else {
                alert('Google Sign-In –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
            }
        }

        /**
         * –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
         */
        async function fetchGoogleUserInfo(accessToken) {
            try {
                const response = await fetch('https://www.googleapis.com/oauth2/v3/userinfo', {
                    headers: { Authorization: `Bearer ${accessToken}` }
                });
                const userInfo = await response.json();

                // –î–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–∞—à–∏–º API –Ω–∞–º –Ω—É–∂–µ–Ω ID Token, –∞ –Ω–µ access token
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º google.accounts.id –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è ID token
                alert('–î–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤—Ö–æ–¥ —á–µ—Ä–µ–∑ One Tap popup');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
                alert('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.');
            }
        }

        /**
         * –û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ Google
         */
        async function handleGoogleSignIn(response) {
            if (response.credential) {
                document.getElementById('loading').classList.remove('hidden');

                try {
                    // –î–µ–∫–æ–¥–∏—Ä—É–µ–º JWT –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    const payload = JSON.parse(atob(response.credential.split('.')[1]));
                    const user = {
                        user_id: payload.sub,
                        email: payload.email,
                        name: payload.name,
                        picture: payload.picture
                    };

                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–∫–µ–Ω –∏ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    API.setAuthToken(response.credential, user);

                    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
                    await initApp();
                    showMainApp();
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', error);
                    alert('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ' + error.message);
                    API.clearAuthToken();
                    showAuthPage();
                } finally {
                    document.getElementById('loading').classList.add('hidden');
                }
            }
        }

        /**
         * –í—ã—Ö–æ–¥ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞
         */
        function signOut() {
            hideUserMenu();

            // –í –¥–µ–º–æ-—Ä–µ–∂–∏–º–µ –ø—Ä–æ—Å—Ç–æ –≤—ã—Ö–æ–¥–∏–º –∏–∑ –¥–µ–º–æ
            if (isDemo) {
                exitDemoAndLogin();
                return;
            }

            API.clearAuthToken();

            // –û—á–∏—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            exercises = [];
            currentWorkout = [];
            lastWorkoutData = {};

            // –û—Ç–∑—ã–≤–∞–µ–º –¥–æ—Å—Ç—É–ø Google
            if (typeof google !== 'undefined' && google.accounts) {
                google.accounts.id.disableAutoSelect();
            }

            showAuthPage();
        }

        /**
         * –ü–æ–∫–∞–∑–∞—Ç—å –º–µ–Ω—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
         */
        function showUserMenu() {
            document.getElementById('user-menu-modal').classList.remove('hidden');
        }

        /**
         * –°–∫—Ä—ã—Ç—å –º–µ–Ω—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
         */
        function hideUserMenu() {
            document.getElementById('user-menu-modal').classList.add('hidden');
        }

        /**
         * –ó–∞–ø—É—Å–∫ –¥–µ–º–æ-—Ä–µ–∂–∏–º–∞
         */
        function startDemoMode() {
            isDemo = true;
            DEMO_WORKOUTS = generateDemoWorkouts();

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ
            exercises = DEMO_EXERCISES;

            // –ó–∞–ø–æ–ª–Ω—è–µ–º lastWorkoutData –∏–∑ –¥–µ–º–æ-—Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
            const byExerciseAndDate = {};
            DEMO_WORKOUTS.forEach(w => {
                const key = w.exercise_id + '_' + w.date;
                if (!byExerciseAndDate[key]) {
                    byExerciseAndDate[key] = {
                        exercise_id: w.exercise_id,
                        date: w.date,
                        sets: []
                    };
                }
                byExerciseAndDate[key].sets.push({
                    weight: w.weight,
                    reps: w.reps
                });
            });

            Object.values(byExerciseAndDate).forEach(item => {
                const existing = lastWorkoutData[item.exercise_id];
                if (!existing || !existing.date || new Date(item.date) > new Date(existing.date)) {
                    lastWorkoutData[item.exercise_id] = {
                        date: item.date,
                        sets: item.sets
                    };
                }
            });

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–∞—Ç—É
            document.getElementById('workout-date').value = workoutDate;
            updateDateDisplay();

            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å–ø–∏—Å–∫–∏
            renderExercisesList();
            populateStatsSelect();

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–∞–Ω–Ω–µ—Ä –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
            document.body.classList.add('demo-mode');
            document.getElementById('demo-banner').classList.remove('hidden');
            showMainApp();

            // –°–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            document.getElementById('loading').classList.add('hidden');
        }

        /**
         * –í—ã—Ö–æ–¥ –∏–∑ –¥–µ–º–æ –∏ –ø–µ—Ä–µ—Ö–æ–¥ –∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
         */
        function exitDemoAndLogin() {
            isDemo = false;
            exercises = [];
            currentWorkout = [];
            lastWorkoutData = {};
            DEMO_WORKOUTS = [];
            DEMO_BODY_METRICS = [];
            bodyMetrics = [];

            document.body.classList.remove('demo-mode');
            document.getElementById('demo-banner').classList.add('hidden');
            hideDemoSaveModal();
            showAuthPage();
        }

        /**
         * –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–µ–º–æ-—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
         */
        function showDemoSaveModal() {
            document.getElementById('demo-save-modal').classList.remove('hidden');
        }

        /**
         * –°–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–µ–º–æ-—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
         */
        function hideDemoSaveModal() {
            document.getElementById('demo-save-modal').classList.add('hidden');
        }

        /**
         * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
         */
        async function initApp() {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Google Sign-In
            initGoogleSignIn();

            // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–∞—Ç—É
            document.getElementById('workout-date').value = workoutDate;
            updateDateDisplay();

            // –û–±–Ω–æ–≤–ª—è–µ–º UI –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            updateUserUI();

            // –ó–∞–≥—Ä—É–∑–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
            await loadExercises();

            // –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–∞–Ω–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è
            await loadLastWorkoutData();

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
            showMainApp();

            // –°–∫—Ä—ã—Ç—å –∑–∞–≥—Ä—É–∑–∫—É
            document.getElementById('loading').classList.add('hidden');
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Google –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–∫—Ä–∏–ø—Ç–∞
        window.onload = function() {
            if (typeof google !== 'undefined') {
                initGoogleSignIn();
            }
        };

        /**
         * –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ –∫–∞–∂–¥–æ–º—É —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—é
         */
        async function loadLastWorkoutData() {
            try {
                const workouts = await API.getWorkouts();

                // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è–º, –±–µ—Ä—ë–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–∞–Ω–Ω—ã–µ
                workouts.forEach(w => {
                    if (!lastWorkoutData[w.exercise_id]) {
                        lastWorkoutData[w.exercise_id] = {
                            sets: []
                        };
                    }
                });

                // –î–ª—è –∫–∞–∂–¥–æ–≥–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è —Å–æ–±–∏—Ä–∞–µ–º –ø–æ–¥—Ö–æ–¥—ã –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
                const byExerciseAndDate = {};
                workouts.forEach(w => {
                    const key = w.exercise_id + '_' + w.date;
                    if (!byExerciseAndDate[key]) {
                        byExerciseAndDate[key] = {
                            exercise_id: w.exercise_id,
                            date: w.date,
                            sets: []
                        };
                    }
                    byExerciseAndDate[key].sets.push({
                        weight: w.weight,
                        reps: w.reps
                    });
                });

                // –ë–µ—Ä—ë–º –ø–æ—Å–ª–µ–¥–Ω—é—é —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
                Object.values(byExerciseAndDate).forEach(item => {
                    const existing = lastWorkoutData[item.exercise_id];
                    if (!existing || !existing.date || new Date(item.date) > new Date(existing.date)) {
                        lastWorkoutData[item.exercise_id] = {
                            date: item.date,
                            sets: item.sets.sort((a, b) => a.set_number - b.set_number)
                        };
                    }
                });
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏:', error);
            }
        }

        /**
         * –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–∞–Ω–Ω—ã–µ –ø–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—é
         */
        function getLastExerciseData(exerciseId) {
            const data = lastWorkoutData[exerciseId];
            if (data && data.sets && data.sets.length > 0) {
                return data.sets;
            }
            // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: 40 –∫–≥, 10 –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π
            return [
                { weight: 40, reps: 10 },
                { weight: 40, reps: 10 },
                { weight: 40, reps: 10 }
            ];
        }

        // ============================================
        // –ó–ê–ì–†–£–ó–ö–ê –î–ê–ù–ù–´–•
        // ============================================
        async function loadExercises() {
            try {
                exercises = await API.getExercises();
                renderExercisesList();
                populateStatsSelect();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π:', error);
                alert('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ.');
            }
        }

        // ============================================
        // –ù–ê–í–ò–ì–ê–¶–ò–Ø
        // ============================================
        function showPage(pageName) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));

            document.getElementById('page-' + pageName).classList.add('active');
            event.target.closest('.nav-btn').classList.add('active');

            window.scrollTo(0, 0);

            // –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            if (pageName === 'history') {
                loadHistory();
            } else if (pageName === 'stats') {
                loadStats();
            } else if (pageName === 'body') {
                loadBodyMetrics();
            }
        }

        // ============================================
        // –î–ê–¢–ê
        // ============================================
        function openDatePicker() {
            document.getElementById('workout-date').showPicker();
        }

        document.getElementById('workout-date').addEventListener('change', (e) => {
            workoutDate = e.target.value;
            updateDateDisplay();
        });

        function updateDateDisplay() {
            const date = new Date(workoutDate);
            const options = { weekday: 'long', day: 'numeric', month: 'long' };
            const formatted = date.toLocaleDateString('ru-RU', options);
            document.getElementById('workout-date-display').textContent = formatted.charAt(0).toUpperCase() + formatted.slice(1);

            // –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫
            const today = new Date().toISOString().split('T')[0];
            const yesterday = new Date(Date.now() - 86400000).toISOString().split('T')[0];

            if (workoutDate === today) {
                document.getElementById('header-date').textContent = '–°–µ–≥–æ–¥–Ω—è';
            } else if (workoutDate === yesterday) {
                document.getElementById('header-date').textContent = '–í—á–µ—Ä–∞';
            } else {
                document.getElementById('header-date').textContent = date.toLocaleDateString('ru-RU', { day: 'numeric', month: 'long' });
            }
        }

        // ============================================
        // –°–¢–†–ê–ù–ò–¶–ê –¢–†–ï–ù–ò–†–û–í–ö–ò
        // ============================================
        function showAddExerciseModal() {
            const modal = document.getElementById('add-exercise-modal');
            const list = document.getElementById('exercise-select-list');

            // –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
            const byCategory = {};
            exercises.forEach(ex => {
                if (!byCategory[ex.category]) {
                    byCategory[ex.category] = [];
                }
                byCategory[ex.category].push(ex);
            });

            // –û—Ç–¥–µ–ª—å–Ω–æ –±–∞–∑–æ–≤—ã–µ –∏ –∏–∑–æ–ª–∏—Ä—É—é—â–∏–µ
            const baseCategories = ['–ì—Ä—É–¥—å', '–°–ø–∏–Ω–∞', '–ü–ª–µ—á–∏', '–ù–æ–≥–∏'];

            let html = '<div class="section-title">–ë–∞–∑–æ–≤—ã–µ</div>';
            baseCategories.forEach(cat => {
                if (byCategory[cat]) {
                    html += `<div class="category-section">
                        <div class="category-title">${cat}</div>
                        <div class="exercises-grid">
                            ${byCategory[cat].filter(e => e.type === 'base').map(ex => `
                                <button class="exercise-tag" onclick="addExerciseToWorkout('${ex.id}')">
                                    <div class="exercise-tag-icon">${getExerciseIcon(ex.category)}</div>
                                    ${ex.name}
                                </button>
                            `).join('')}
                        </div>
                    </div>`;
                }
            });

            html += '<div class="section-title" style="margin-top: 24px;">–ò–∑–æ–ª–∏—Ä—É—é—â–∏–µ</div>';
            Object.entries(byCategory).forEach(([cat, exs]) => {
                const isolations = exs.filter(e => e.type === 'isolation' || e.type === 'custom');
                if (isolations.length > 0) {
                    html += `<div class="category-section">
                        <div class="category-title">${cat}</div>
                        <div class="exercises-grid">
                            ${isolations.map(ex => `
                                <button class="exercise-tag" onclick="addExerciseToWorkout('${ex.id}')">
                                    <div class="exercise-tag-icon">${getExerciseIcon(ex.category)}</div>
                                    ${ex.name}
                                </button>
                            `).join('')}
                        </div>
                    </div>`;
                }
            });

            list.innerHTML = html;
            modal.classList.remove('hidden');
        }

        function hideAddExerciseModal() {
            document.getElementById('add-exercise-modal').classList.add('hidden');
        }

        function getExerciseIcon(category) {
            const icons = {
                '–ì—Ä—É–¥—å': 'üí™',
                '–°–ø–∏–Ω–∞': 'üèãÔ∏è',
                '–ü–ª–µ—á–∏': 'üéØ',
                '–ù–æ–≥–∏': 'ü¶µ',
                '–ë–∏—Ü–µ–ø—Å': 'üí™',
                '–¢—Ä–∏—Ü–µ–ø—Å': 'üí™',
                '–ò–∫—Ä—ã': 'ü¶∂',
                '–ö–æ—Ä': 'üßò'
            };
            return icons[category] || 'üèãÔ∏è';
        }

        function addExerciseToWorkout(exerciseId) {
            const exercise = exercises.find(e => e.id === exerciseId);
            if (!exercise) return;

            // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å –ø—Ä–æ—à–ª–æ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
            const lastData = getLastExerciseData(exerciseId);

            // –î–æ–±–∞–≤–ª—è–µ–º —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ —Å 3 –ø–æ–¥—Ö–æ–¥–∞–º–∏ (–¥–∞–Ω–Ω—ã–µ –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏ –∏–ª–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
            const sets = [];
            for (let i = 0; i < 3; i++) {
                if (lastData[i]) {
                    sets.push({
                        weight: lastData[i].weight || 40,
                        reps: lastData[i].reps || 10
                    });
                } else {
                    // –ï—Å–ª–∏ –≤ –∏—Å—Ç–æ—Ä–∏–∏ –º–µ–Ω—å—à–µ 3 –ø–æ–¥—Ö–æ–¥–æ–≤, –±–µ—Ä—ë–º –ø–æ—Å–ª–µ–¥–Ω–∏–π –∏–∑–≤–µ—Å—Ç–Ω—ã–π –∏–ª–∏ –¥–µ—Ñ–æ–ª—Ç
                    const lastKnown = lastData[lastData.length - 1] || { weight: 40, reps: 10 };
                    sets.push({
                        weight: lastKnown.weight || 40,
                        reps: lastKnown.reps || 10
                    });
                }
            }

            currentWorkout.push({
                exercise: exercise,
                sets: sets
            });

            renderCurrentWorkout();
            hideAddExerciseModal();
        }

        function renderCurrentWorkout() {
            const container = document.getElementById('exercises-container');

            if (currentWorkout.length === 0) {
                container.innerHTML = '<div class="empty-state">–î–æ–±–∞–≤—å—Ç–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É</div>';
                document.getElementById('save-workout-btn').style.display = 'none';
                return;
            }

            document.getElementById('save-workout-btn').style.display = 'flex';

            container.innerHTML = currentWorkout.map((item, exIndex) => `
                <div class="exercise-card">
                    <div class="exercise-card-header">
                        <div class="exercise-icon">${getExerciseIcon(item.exercise.category)}</div>
                        <div class="exercise-info">
                            <div class="exercise-name">${item.exercise.name}</div>
                            <div class="exercise-category">${item.exercise.category}</div>
                        </div>
                        <button class="btn-icon danger" onclick="removeExercise(${exIndex})">√ó</button>
                    </div>
                    <div class="exercise-card-body">
                        <div class="sets-header">
                            <span></span>
                            <span>–í–µ—Å</span>
                            <span>–ü–æ–≤—Ç–æ—Ä—ã</span>
                            <span></span>
                        </div>
                        ${item.sets.map((set, setIndex) => `
                            <div class="set-row">
                                <span class="set-num">${setIndex + 1}</span>
                                <input type="number" class="set-input" placeholder="–∫–≥" value="${set.weight}"
                                    onchange="updateSet(${exIndex}, ${setIndex}, 'weight', this.value)">
                                <input type="number" class="set-input" placeholder="0" value="${set.reps}"
                                    onchange="updateSet(${exIndex}, ${setIndex}, 'reps', this.value)">
                                <button class="btn-icon danger" style="width:32px;height:32px;"
                                    onclick="removeSet(${exIndex}, ${setIndex})" ${item.sets.length === 1 ? 'disabled' : ''}>√ó</button>
                            </div>
                        `).join('')}
                        <button class="add-set-btn" onclick="addSet(${exIndex})">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"/>
                                <line x1="5" y1="12" x2="19" y2="12"/>
                            </svg>
                            –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Ö–æ–¥
                        </button>
                        <button class="timer-btn" onclick="startTimer()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M12 6v6l4 2"/>
                            </svg>
                            –¢–∞–π–º–µ—Ä –æ—Ç–¥—ã—Ö–∞ ¬∑ 2:00
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function updateSet(exIndex, setIndex, field, value) {
            currentWorkout[exIndex].sets[setIndex][field] = value;
        }

        function addSet(exIndex) {
            currentWorkout[exIndex].sets.push({ weight: '', reps: '' });
            renderCurrentWorkout();
        }

        function removeSet(exIndex, setIndex) {
            if (currentWorkout[exIndex].sets.length > 1) {
                currentWorkout[exIndex].sets.splice(setIndex, 1);
                renderCurrentWorkout();
            }
        }

        function removeExercise(exIndex) {
            currentWorkout.splice(exIndex, 1);
            renderCurrentWorkout();
        }

        function showConfirmModal() {
            // –°–æ–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            let totalSets = 0;
            let totalReps = 0;
            let totalVolume = 0;
            let exercisesHtml = '';

            currentWorkout.forEach(item => {
                let exSets = 0;
                let exReps = 0;
                let exVolume = 0;
                let setsDetails = [];

                item.sets.forEach(set => {
                    const weight = parseFloat(set.weight) || 0;
                    const reps = parseInt(set.reps) || 0;

                    if (weight > 0 || reps > 0) {
                        exSets++;
                        exReps += reps;
                        exVolume += weight * reps;
                        setsDetails.push(`${weight}–∫–≥ √ó ${reps}`);
                    }
                });

                if (exSets > 0) {
                    totalSets += exSets;
                    totalReps += exReps;
                    totalVolume += exVolume;

                    exercisesHtml += `
                        <div class="confirm-exercise">
                            <div class="confirm-exercise-header">
                                <span class="confirm-exercise-icon">${getExerciseIcon(item.exercise.category)}</span>
                                <span class="confirm-exercise-name">${item.exercise.name}</span>
                            </div>
                            <div class="confirm-exercise-sets">${setsDetails.join(' ¬∑ ')}</div>
                        </div>
                    `;
                }
            });

            if (totalSets === 0) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø–æ–¥—Ö–æ–¥');
                return;
            }

            const modalBody = document.getElementById('confirm-modal-body');
            modalBody.innerHTML = `
                <div class="confirm-stats">
                    <div class="confirm-stat">
                        <div class="confirm-stat-value">${currentWorkout.length}</div>
                        <div class="confirm-stat-label">—É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π</div>
                    </div>
                    <div class="confirm-stat">
                        <div class="confirm-stat-value">${totalSets}</div>
                        <div class="confirm-stat-label">–ø–æ–¥—Ö–æ–¥–æ–≤</div>
                    </div>
                    <div class="confirm-stat">
                        <div class="confirm-stat-value">${totalReps}</div>
                        <div class="confirm-stat-label">–ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π</div>
                    </div>
                    <div class="confirm-stat">
                        <div class="confirm-stat-value">${(totalVolume / 1000).toFixed(1)}—Ç</div>
                        <div class="confirm-stat-label">–æ–±—ä—ë–º</div>
                    </div>
                </div>
                <div class="confirm-exercises-list">
                    ${exercisesHtml}
                </div>
            `;

            document.getElementById('confirm-modal').classList.remove('hidden');
        }

        function hideConfirmModal() {
            document.getElementById('confirm-modal').classList.add('hidden');
        }

        async function confirmSaveWorkout() {
            hideConfirmModal();
            await saveWorkout();
        }

        async function saveWorkout() {
            // –ë–ª–æ–∫–∏—Ä—É–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –¥–µ–º–æ-—Ä–µ–∂–∏–º–µ
            if (isDemo) {
                showDemoSaveModal();
                return;
            }

            // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –ø–æ–¥—Ö–æ–¥—ã
            const workouts = [];

            currentWorkout.forEach(item => {
                item.sets.forEach((set, index) => {
                    const weight = parseFloat(set.weight) || 0;
                    const reps = parseInt(set.reps) || 0;

                    if (weight > 0 || reps > 0) {
                        workouts.push({
                            date: workoutDate,
                            exercise_id: item.exercise.id,
                            exercise_name: item.exercise.name,
                            set_number: index + 1,
                            weight: weight,
                            reps: reps
                        });
                    }
                });
            });

            if (workouts.length === 0) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø–æ–¥—Ö–æ–¥');
                return;
            }

            try {
                document.getElementById('loading').classList.remove('hidden');
                await API.addWorkouts(workouts);

                alert('–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!');
                currentWorkout = [];
                renderCurrentWorkout();
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + error.message);
            } finally {
                document.getElementById('loading').classList.add('hidden');
            }
        }

        // ============================================
        // –¢–ê–ô–ú–ï–†
        // ============================================
        let timerSeconds = 120;
        let timerInterval = null;
        let timerTotal = 120;

        function startTimer(seconds = 120) {
            timerSeconds = seconds;
            timerTotal = seconds;
            document.getElementById('timer-modal').classList.remove('hidden');
            updateTimerDisplay();

            timerInterval = setInterval(() => {
                timerSeconds--;
                updateTimerDisplay();

                if (timerSeconds <= 0) {
                    stopTimer();
                    if (navigator.vibrate) navigator.vibrate([200, 100, 200]);
                    playBeep();
                }
            }, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
            document.getElementById('timer-modal').classList.add('hidden');
        }

        function addTimerTime(seconds) {
            timerSeconds += seconds;
            timerTotal += seconds;
            updateTimerDisplay();
        }

        function updateTimerDisplay() {
            const mins = Math.floor(timerSeconds / 60);
            const secs = timerSeconds % 60;
            document.getElementById('timer-display').textContent =
                mins.toString().padStart(2, '0') + ':' + secs.toString().padStart(2, '0');

            // –û–±–Ω–æ–≤–∏—Ç—å –∫—Ä—É–≥–æ–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å
            const progress = document.getElementById('timer-progress');
            const circumference = 2 * Math.PI * 90;
            const offset = circumference - (timerSeconds / timerTotal) * circumference;
            progress.style.strokeDasharray = circumference;
            progress.style.strokeDashoffset = offset;
        }

        function playBeep() {
            const ctx = new (window.AudioContext || window.webkitAudioContext)();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.connect(gain);
            gain.connect(ctx.destination);
            osc.frequency.value = 800;
            gain.gain.value = 0.3;
            osc.start();
            setTimeout(() => osc.stop(), 200);
        }

        // ============================================
        // –ò–°–¢–û–†–ò–Ø
        // ============================================
        async function loadHistory() {
            const container = document.getElementById('history-container');

            try {
                // –í –¥–µ–º–æ-—Ä–µ–∂–∏–º–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ
                const workouts = isDemo ? DEMO_WORKOUTS : await API.getWorkouts();

                if (workouts.length === 0) {
                    container.innerHTML = '<div class="empty-state">–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π</div>';
                    return;
                }

                // –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ –∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—é
                const grouped = {};
                workouts.forEach(w => {
                    const dateKey = w.date;
                    if (!grouped[dateKey]) {
                        grouped[dateKey] = {};
                    }
                    if (!grouped[dateKey][w.exercise_id]) {
                        grouped[dateKey][w.exercise_id] = {
                            name: w.exercise_name,
                            sets: []
                        };
                    }
                    grouped[dateKey][w.exercise_id].sets.push({
                        weight: w.weight,
                        reps: w.reps
                    });
                });

                // –†–µ–Ω–¥–µ—Ä
                let html = '';
                const dates = Object.keys(grouped).sort((a, b) => new Date(b) - new Date(a));

                dates.forEach(dateKey => {
                    const date = new Date(dateKey);
                    const today = new Date().toISOString().split('T')[0];
                    const yesterday = new Date(Date.now() - 86400000).toISOString().split('T')[0];

                    let dateLabel;
                    if (dateKey === today) {
                        dateLabel = '–°–µ–≥–æ–¥–Ω—è';
                    } else if (dateKey === yesterday) {
                        dateLabel = '–í—á–µ—Ä–∞';
                    } else {
                        dateLabel = date.toLocaleDateString('ru-RU', { day: 'numeric', month: 'long' });
                    }

                    html += `<div class="history-group">
                        <div class="history-date">${dateLabel}</div>`;

                    Object.values(grouped[dateKey]).forEach(ex => {
                        const exerciseData = exercises.find(e => e.name === ex.name);
                        const icon = exerciseData ? getExerciseIcon(exerciseData.category) : 'üèãÔ∏è';

                        html += `
                            <div class="history-card">
                                <div class="history-icon">${icon}</div>
                                <div class="history-info">
                                    <div class="history-exercise">${ex.name}</div>
                                    <div class="history-details">${ex.sets.length} –ø–æ–¥—Ö–æ–¥–æ–≤</div>
                                    <div class="history-sets">
                                        ${ex.sets.map(s => `<span class="history-set">${s.weight}–∫–≥ √ó ${s.reps}</span>`).join('')}
                                    </div>
                                </div>
                            </div>
                        `;
                    });

                    html += '</div>';
                });

                container.innerHTML = html;
            } catch (error) {
                container.innerHTML = '<div class="empty-state">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>';
            }
        }

        // ============================================
        // –°–¢–ê–¢–ò–°–¢–ò–ö–ê
        // ============================================
        let activityChart = null;

        function populateStatsSelect() {
            const select = document.getElementById('stats-exercise-select');
            select.innerHTML = '<option value="">–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</option>';

            exercises.forEach(ex => {
                const option = document.createElement('option');
                option.value = ex.id;
                option.textContent = ex.name;
                select.appendChild(option);
            });
        }

        async function loadStats() {
            const select = document.getElementById('stats-exercise-select');
            const exerciseId = select.value;

            if (!exerciseId) {
                document.getElementById('stats-container').style.display = 'none';
                document.getElementById('stats-overview').style.display = 'block';
                await loadMonthlyOverview();
                return;
            }

            document.getElementById('stats-overview').style.display = 'none';

            try {
                const stats = await API.getStats(exerciseId);

                document.getElementById('stat-max-weight').textContent = stats.maxWeight + ' –∫–≥';
                document.getElementById('stat-total-sets').textContent = stats.totalSets;
                document.getElementById('stat-total-reps').textContent = stats.totalReps;

                if (stats.lastWorkout) {
                    const date = new Date(stats.lastWorkout.date);
                    document.getElementById('stat-last-date').textContent =
                        date.toLocaleDateString('ru-RU', { day: 'numeric', month: 'short' });
                } else {
                    document.getElementById('stat-last-date').textContent = '‚Äî';
                }

                // –ì—Ä–∞—Ñ–∏–∫
                renderWeightChart(stats.workouts);

                document.getElementById('stats-container').style.display = 'block';
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
            }
        }

        async function loadMonthlyOverview() {
            try {
                // –í –¥–µ–º–æ-—Ä–µ–∂–∏–º–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ
                const workouts = isDemo ? DEMO_WORKOUTS : await API.getWorkouts();

                const now = new Date();
                const thirtyDaysAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
                const sixtyDaysAgo = new Date(now.getTime() - 60 * 24 * 60 * 60 * 1000);

                // –§–∏–ª—å—Ç—Ä—É–µ–º –ø–æ –ø–µ—Ä–∏–æ–¥–∞–º
                const currentMonth = workouts.filter(w => new Date(w.date) >= thirtyDaysAgo);
                const prevMonth = workouts.filter(w => {
                    const d = new Date(w.date);
                    return d >= sixtyDaysAgo && d < thirtyDaysAgo;
                });

                // –°—á–∏—Ç–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü
                const workoutDays = new Set(currentMonth.map(w => w.date));
                const uniqueExercises = new Set(currentMonth.map(w => w.exercise_id));
                const totalVolume = currentMonth.reduce((sum, w) => sum + (parseFloat(w.weight) || 0) * (parseInt(w.reps) || 0), 0);
                const totalSets = currentMonth.length;

                // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏
                document.getElementById('overview-workouts').textContent = workoutDays.size;
                document.getElementById('overview-volume').textContent = (totalVolume / 1000).toFixed(1) + '—Ç';
                document.getElementById('overview-exercises').textContent = uniqueExercises.size;
                document.getElementById('overview-sets').textContent = totalSets;

                // –°—á–∏—Ç–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–∞ –ø—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
                const prevWorkoutDays = new Set(prevMonth.map(w => w.date));
                const prevVolume = prevMonth.reduce((sum, w) => sum + (parseFloat(w.weight) || 0) * (parseInt(w.reps) || 0), 0);
                const prevSets = prevMonth.length;

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –µ—Å–ª–∏ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –∑–∞ –ø—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü
                if (prevMonth.length > 0) {
                    const progressItems = document.getElementById('progress-items');
                    const comparisons = [
                        {
                            label: '–¢—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫',
                            current: workoutDays.size,
                            prev: prevWorkoutDays.size
                        },
                        {
                            label: '–û–±—ä—ë–º (–∫–≥)',
                            current: Math.round(totalVolume),
                            prev: Math.round(prevVolume)
                        },
                        {
                            label: '–ü–æ–¥—Ö–æ–¥–æ–≤',
                            current: totalSets,
                            prev: prevSets
                        }
                    ];

                    progressItems.innerHTML = comparisons.map(c => {
                        const diff = c.prev > 0 ? Math.round((c.current - c.prev) / c.prev * 100) : (c.current > 0 ? 100 : 0);
                        const isPositive = diff >= 0;
                        return `
                            <div class="progress-item">
                                <div class="progress-item-label">${c.label}</div>
                                <div class="progress-item-values">
                                    <span class="progress-item-current">${c.current}</span>
                                    <span class="progress-item-diff ${isPositive ? 'positive' : 'negative'}">
                                        ${isPositive ? '‚Üë' : '‚Üì'} ${Math.abs(diff)}%
                                    </span>
                                </div>
                            </div>
                        `;
                    }).join('');

                    document.getElementById('progress-comparison').style.display = 'block';
                }

                // –ì—Ä–∞—Ñ–∏–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ –¥–Ω—è–º (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π)
                renderActivityChart(currentMonth);

                // –¢–æ–ø —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π
                renderTopExercises(currentMonth);

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ–±–∑–æ—Ä–∞:', error);
            }
        }

        function renderActivityChart(workouts) {
            const ctx = document.getElementById('activity-chart').getContext('2d');

            if (activityChart) {
                activityChart.destroy();
            }

            // –°–æ–∑–¥–∞—ë–º –º–∞—Å—Å–∏–≤ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 30 –¥–Ω–µ–π
            const days = [];
            const volumes = [];
            for (let i = 29; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                days.push(date.toLocaleDateString('ru-RU', { day: 'numeric', month: 'short' }));

                // –°—á–∏—Ç–∞–µ–º –æ–±—ä—ë–º –∑–∞ —ç—Ç–æ—Ç –¥–µ–Ω—å
                const dayWorkouts = workouts.filter(w => w.date === dateStr);
                const dayVolume = dayWorkouts.reduce((sum, w) => sum + (parseFloat(w.weight) || 0) * (parseInt(w.reps) || 0), 0);
                volumes.push(dayVolume / 1000); // –≤ —Ç–æ–Ω–Ω–∞—Ö
            }

            activityChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: days,
                    datasets: [{
                        label: '–û–±—ä—ë–º (—Ç)',
                        data: volumes,
                        backgroundColor: volumes.map(v => v > 0 ? '#FF6B35' : '#F0F0F0'),
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: {
                            display: false
                        },
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: value => value + '—Ç'
                            }
                        }
                    }
                }
            });
        }

        function renderTopExercises(workouts) {
            const container = document.getElementById('top-exercises-list');

            // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è–º
            const byExercise = {};
            workouts.forEach(w => {
                if (!byExercise[w.exercise_id]) {
                    byExercise[w.exercise_id] = {
                        name: w.exercise_name,
                        sets: 0,
                        volume: 0,
                        maxWeight: 0
                    };
                }
                byExercise[w.exercise_id].sets++;
                byExercise[w.exercise_id].volume += (parseFloat(w.weight) || 0) * (parseInt(w.reps) || 0);
                byExercise[w.exercise_id].maxWeight = Math.max(byExercise[w.exercise_id].maxWeight, parseFloat(w.weight) || 0);
            });

            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –æ–±—ä—ë–º—É –∏ –±–µ—Ä—ë–º —Ç–æ–ø-5
            const sorted = Object.entries(byExercise)
                .sort((a, b) => b[1].volume - a[1].volume)
                .slice(0, 5);

            if (sorted.length === 0) {
                container.innerHTML = '<div class="empty-state" style="padding: 20px;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∑–∞ —ç—Ç–æ—Ç –ø–µ—Ä–∏–æ–¥</div>';
                return;
            }

            const maxVolume = sorted[0][1].volume;

            container.innerHTML = sorted.map(([id, data], index) => {
                const exercise = exercises.find(e => e.id === id);
                const icon = exercise ? getExerciseIcon(exercise.category) : 'üèãÔ∏è';
                const percentage = (data.volume / maxVolume * 100).toFixed(0);

                return `
                    <div class="top-exercise-item">
                        <div class="top-exercise-rank">${index + 1}</div>
                        <div class="top-exercise-icon">${icon}</div>
                        <div class="top-exercise-info">
                            <div class="top-exercise-name">${data.name}</div>
                            <div class="top-exercise-stats">${data.sets} –ø–æ–¥—Ö–æ–¥–æ–≤ ¬∑ –º–∞–∫—Å. ${data.maxWeight} –∫–≥</div>
                            <div class="top-exercise-bar">
                                <div class="top-exercise-bar-fill" style="width: ${percentage}%"></div>
                            </div>
                        </div>
                        <div class="top-exercise-volume">${(data.volume / 1000).toFixed(1)}—Ç</div>
                    </div>
                `;
            }).join('');
        }

        function renderWeightChart(workouts) {
            const ctx = document.getElementById('weight-chart').getContext('2d');

            if (weightChart) {
                weightChart.destroy();
            }

            // –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ (–º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –≤–µ—Å –∑–∞ –¥–µ–Ω—å)
            const byDate = {};
            workouts.forEach(w => {
                const date = w.date;
                if (!byDate[date] || w.weight > byDate[date]) {
                    byDate[date] = parseFloat(w.weight) || 0;
                }
            });

            const labels = Object.keys(byDate).map(d =>
                new Date(d).toLocaleDateString('ru-RU', { day: 'numeric', month: 'short' })
            );
            const data = Object.values(byDate);

            weightChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '–í–µ—Å (–∫–≥)',
                        data: data,
                        borderColor: '#FF6B35',
                        backgroundColor: 'rgba(255, 107, 53, 0.1)',
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: { beginAtZero: false }
                    }
                }
            });
        }

        // ============================================
        // –°–¢–†–ê–ù–ò–¶–ê –£–ü–†–ê–ñ–ù–ï–ù–ò–ô
        // ============================================
        function renderExercisesList() {
            const container = document.getElementById('exercises-list-container');

            // –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞
            const byCategory = {};
            exercises.forEach(ex => {
                if (!byCategory[ex.category]) {
                    byCategory[ex.category] = [];
                }
                byCategory[ex.category].push(ex);
            });

            const baseCategories = ['–ì—Ä—É–¥—å', '–°–ø–∏–Ω–∞', '–ü–ª–µ—á–∏', '–ù–æ–≥–∏'];

            let html = '<div class="section-title">–ë–∞–∑–æ–≤—ã–µ</div>';
            baseCategories.forEach(cat => {
                if (byCategory[cat]) {
                    const baseExs = byCategory[cat].filter(e => e.type === 'base');
                    if (baseExs.length > 0) {
                        html += `<div class="category-section">
                            <div class="category-title">${cat}</div>
                            <div class="exercises-grid">
                                ${baseExs.map(ex => `
                                    <div class="exercise-tag">
                                        <div class="exercise-tag-icon">${getExerciseIcon(cat)}</div>
                                        ${ex.name}
                                    </div>
                                `).join('')}
                            </div>
                        </div>`;
                    }
                }
            });

            html += '<div class="section-title" style="margin-top: 24px;">–ò–∑–æ–ª–∏—Ä—É—é—â–∏–µ</div>';
            Object.entries(byCategory).forEach(([cat, exs]) => {
                const isolations = exs.filter(e => e.type === 'isolation' || e.type === 'custom');
                if (isolations.length > 0) {
                    html += `<div class="category-section">
                        <div class="category-title">${cat}</div>
                        <div class="exercises-grid">
                            ${isolations.map(ex => `
                                <div class="exercise-tag">
                                    <div class="exercise-tag-icon">${getExerciseIcon(cat)}</div>
                                    ${ex.name}
                                </div>
                            `).join('')}
                        </div>
                    </div>`;
                }
            });

            container.innerHTML = html;
        }

        // ============================================
        // –ü–ê–†–ê–ú–ï–¢–†–´ –¢–ï–õ–ê
        // ============================================

        /**
         * –†–∞—Å—á–µ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç–∞ –∂–∏—Ä–∞ –ø–æ —Ñ–æ—Ä–º—É–ª–µ –í–ú–° –°–®–ê (–¥–ª—è –º—É–∂—á–∏–Ω)
         * % –∂–∏—Ä–∞ = 495 / (1.0324 - 0.19077 * log10(—Ç–∞–ª–∏—è - —à–µ—è) + 0.15456 * log10(—Ä–æ—Å—Ç)) - 450
         */
        function calculateBodyFat(height, neck, waist) {
            if (!height || !neck || !waist || waist <= neck) return null;

            const logWaistNeck = Math.log10(waist - neck);
            const logHeight = Math.log10(height);

            const bodyFat = 495 / (1.0324 - 0.19077 * logWaistNeck + 0.15456 * logHeight) - 450;

            return Math.max(0, Math.min(50, bodyFat)).toFixed(1); // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º 0-50%
        }

        /**
         * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ % –∂–∏—Ä–∞ –ø—Ä–∏ –≤–≤–æ–¥–µ
         */
        function updateBodyFatPreview() {
            const height = parseFloat(document.getElementById('input-height').value);
            const neck = parseFloat(document.getElementById('input-neck').value);
            const waist = parseFloat(document.getElementById('input-waist').value);

            const preview = document.getElementById('body-fat-preview');
            const valueEl = document.getElementById('body-fat-value');

            if (height && neck && waist && waist > neck) {
                const bodyFat = calculateBodyFat(height, neck, waist);
                valueEl.textContent = bodyFat + '%';
                preview.style.display = 'block';
            } else {
                preview.style.display = 'none';
            }
        }

        /**
         * –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–µ–º–æ-–¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ç–µ–ª–∞
         */
        let DEMO_BODY_METRICS = [];

        function generateDemoBodyMetrics() {
            const metrics = [];
            const today = new Date();

            // –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ –∫–æ–ª–µ–±–∞–Ω–∏—è –≤–µ—Å–∞ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (—Ä–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è)
            // –ë–∞–∑–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è: –≤–µ—Å ~78–∫–≥, —Ç–∞–ª–∏—è ~86—Å–º, —à–µ—è ~37—Å–º
            const baseWeight = 78;
            const baseWaist = 86;
            const baseNeck = 37;

            // –ü–∞—Ç—Ç–µ—Ä–Ω —Å –∫–æ–ª–µ–±–∞–Ω–∏—è–º–∏: –Ω–∞–±–æ—Ä –≤–µ—Å–∞ —Å –æ—Ç–∫–∞—Ç–∞–º–∏, % –∂–∏—Ä–∞ —Å ~17.9% –¥–æ ~16.4%
            const weightVariations = [0, 0.5, 0.2, 0.8, 0.5, 1.3, 0.9, 1.5, 1.8];
            const waistVariations = [0, -0.3, 0.1, -0.5, -0.2, -0.7, -0.4, -1.0, -1.2];
            const neckVariations = [0, 0.2, 0.1, 0.4, 0.3, 0.6, 0.5, 0.7, 0.8];

            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 8 –Ω–µ–¥–µ–ª—å
            for (let i = 8; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i * 7);

                const idx = 8 - i;
                const height = 178;
                const weight = (baseWeight + weightVariations[idx]).toFixed(1);
                const neck = (baseNeck + neckVariations[idx]).toFixed(1);
                const waist = (baseWaist + waistVariations[idx]).toFixed(1);

                // –†–∞—Å—á–µ—Ç % –∂–∏—Ä–∞ –ø–æ —Ñ–æ—Ä–º—É–ª–µ –í–ú–° –°–®–ê
                const bodyFat = calculateBodyFat(height, parseFloat(neck), parseFloat(waist));

                metrics.push({
                    id: 'bm_demo_' + i,
                    date: date.toISOString().split('T')[0],
                    height: height,
                    weight: parseFloat(weight),
                    neck: parseFloat(neck),
                    waist: parseFloat(waist),
                    body_fat_percent: bodyFat
                });
            }

            return metrics;
        }

        /**
         * –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö —Ç–µ–ª–∞
         */
        async function loadBodyMetrics() {
            try {
                if (isDemo) {
                    if (DEMO_BODY_METRICS.length === 0) {
                        DEMO_BODY_METRICS = generateDemoBodyMetrics();
                    }
                    bodyMetrics = DEMO_BODY_METRICS;
                } else {
                    bodyMetrics = await API.getBodyMetrics();
                }

                renderBodyMetrics();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ç–µ–ª–∞:', error);
            }
        }

        /**
         * –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ç–µ–ª–∞
         */
        function renderBodyMetrics() {
            const currentMetrics = document.getElementById('current-body-metrics');
            const bodyCharts = document.getElementById('body-charts');
            const metricsHistory = document.getElementById('body-metrics-history');

            if (bodyMetrics.length === 0) {
                currentMetrics.style.display = 'none';
                bodyCharts.style.display = 'none';
                metricsHistory.style.display = 'none';
                return;
            }

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏–∏
            currentMetrics.style.display = 'block';
            bodyCharts.style.display = 'block';
            metricsHistory.style.display = 'block';

            // –¢–µ–∫—É—â–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ (–ø–æ—Å–ª–µ–¥–Ω–µ–µ –∏–∑–º–µ—Ä–µ–Ω–∏–µ)
            const latest = bodyMetrics[0];
            document.getElementById('current-weight-val').textContent = latest.weight + ' –∫–≥';
            document.getElementById('current-body-fat').textContent = latest.body_fat_percent + '%';
            document.getElementById('current-waist').textContent = latest.waist + ' —Å–º';

            // –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤–µ—Å–∞ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü
            const monthAgo = new Date();
            monthAgo.setMonth(monthAgo.getMonth() - 1);
            const oldMetric = bodyMetrics.find(m => new Date(m.date) <= monthAgo);

            if (oldMetric) {
                const change = (latest.weight - oldMetric.weight).toFixed(1);
                const changeText = change > 0 ? '+' + change : change;
                document.getElementById('weight-change').textContent = changeText + ' –∫–≥';
            } else if (bodyMetrics.length > 1) {
                const oldest = bodyMetrics[bodyMetrics.length - 1];
                const change = (latest.weight - oldest.weight).toFixed(1);
                const changeText = change > 0 ? '+' + change : change;
                document.getElementById('weight-change').textContent = changeText + ' –∫–≥';
            }

            // –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ä–æ—Å—Ç–∞ –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏–∑–º–µ—Ä–µ–Ω–∏—è
            if (latest.height && !document.getElementById('input-height').value) {
                document.getElementById('input-height').value = latest.height;
            }

            // –ì—Ä–∞—Ñ–∏–∫–∏
            renderWeightBodyChart();
            renderBodyFatChart();

            // –ò—Å—Ç–æ—Ä–∏—è
            renderBodyMetricsHistory();
        }

        /**
         * –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –≥—Ä–∞—Ñ–∏–∫–∞ –≤–µ—Å–∞ —Ç–µ–ª–∞
         */
        function renderWeightBodyChart() {
            const ctx = document.getElementById('weight-body-chart').getContext('2d');

            if (weightBodyChart) {
                weightBodyChart.destroy();
            }

            const sortedMetrics = [...bodyMetrics].sort((a, b) => new Date(a.date) - new Date(b.date));

            const labels = sortedMetrics.map(m =>
                new Date(m.date).toLocaleDateString('ru-RU', { day: 'numeric', month: 'short' })
            );
            const data = sortedMetrics.map(m => parseFloat(m.weight));

            weightBodyChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '–í–µ—Å (–∫–≥)',
                        data: data,
                        borderColor: '#FF6B35',
                        backgroundColor: 'rgba(255, 107, 53, 0.1)',
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            ticks: {
                                callback: value => parseFloat(value).toFixed(1) + ' –∫–≥'
                            }
                        }
                    }
                }
            });
        }

        /**
         * –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –≥—Ä–∞—Ñ–∏–∫–∞ % –∂–∏—Ä–∞
         */
        function renderBodyFatChart() {
            const ctx = document.getElementById('body-fat-chart').getContext('2d');

            if (bodyFatChart) {
                bodyFatChart.destroy();
            }

            const sortedMetrics = [...bodyMetrics].sort((a, b) => new Date(a.date) - new Date(b.date));

            const labels = sortedMetrics.map(m =>
                new Date(m.date).toLocaleDateString('ru-RU', { day: 'numeric', month: 'short' })
            );
            const data = sortedMetrics.map(m => parseFloat(m.body_fat_percent));

            bodyFatChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '% –∂–∏—Ä–∞',
                        data: data,
                        borderColor: '#4CAF50',
                        backgroundColor: 'rgba(76, 175, 80, 0.1)',
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            ticks: {
                                callback: value => parseFloat(value).toFixed(1) + '%'
                            }
                        }
                    }
                }
            });
        }

        /**
         * –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ—Ä–µ–Ω–∏–π
         */
        function renderBodyMetricsHistory() {
            const container = document.getElementById('body-metrics-history-list');

            container.innerHTML = bodyMetrics.slice(0, 10).map(m => {
                const date = new Date(m.date);
                const dateStr = date.toLocaleDateString('ru-RU', { day: 'numeric', month: 'long' });

                return `
                    <div class="body-metric-history-card">
                        <div class="body-metric-date">${dateStr}</div>
                        <div class="body-metric-values">
                            <span class="body-metric-tag">‚öñÔ∏è ${m.weight} –∫–≥</span>
                            <span class="body-metric-tag">üìâ ${m.body_fat_percent}%</span>
                            <span class="body-metric-tag">üìè ${m.waist} —Å–º</span>
                            <span class="body-metric-tag">üëî ${m.neck} —Å–º</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        /**
         * –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–º–µ—Ä–µ–Ω–∏–π —Ç–µ–ª–∞
         */
        async function saveBodyMetric() {
            const height = parseFloat(document.getElementById('input-height').value);
            const weight = parseFloat(document.getElementById('input-weight').value);
            const neck = parseFloat(document.getElementById('input-neck').value);
            const waist = parseFloat(document.getElementById('input-waist').value);

            if (!height || !weight || !neck || !waist) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                return;
            }

            if (waist <= neck) {
                alert('–û—Ö–≤–∞—Ç —Ç–∞–ª–∏–∏ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –±–æ–ª—å—à–µ –æ—Ö–≤–∞—Ç–∞ —à–µ–∏');
                return;
            }

            const bodyFat = calculateBodyFat(height, neck, waist);

            const metric = {
                date: new Date().toISOString().split('T')[0],
                height: height,
                weight: weight,
                neck: neck,
                waist: waist,
                body_fat_percent: bodyFat
            };

            if (isDemo) {
                showDemoSaveModal();
                return;
            }

            try {
                document.getElementById('loading').classList.remove('hidden');
                await API.addBodyMetric(metric);

                // –û—á–∏—â–∞–µ–º –ø–æ–ª—è (–∫—Ä–æ–º–µ —Ä–æ—Å—Ç–∞)
                document.getElementById('input-weight').value = '';
                document.getElementById('input-neck').value = '';
                document.getElementById('input-waist').value = '';
                document.getElementById('body-fat-preview').style.display = 'none';

                alert('–ò–∑–º–µ—Ä–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');

                // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                await loadBodyMetrics();
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + error.message);
            } finally {
                document.getElementById('loading').classList.add('hidden');
            }
        }
    </script>
</body>
</html>

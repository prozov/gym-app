<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>–î–Ω–µ–≤–Ω–∏–∫ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#FF6B35">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>

    <!-- –ó–∞–≥—Ä—É–∑–∫–∞ -->
    <div id="loading" class="loading">
        <div class="loading-spinner"></div>
        <div class="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>

    <!-- –ë–∞–Ω–Ω–µ—Ä –¥–µ–º–æ-—Ä–µ–∂–∏–º–∞ -->
    <div id="demo-banner" class="demo-banner hidden">
        <span>–î–µ–º–æ-—Ä–µ–∂–∏–º</span>
        <button onclick="exitDemoAndLogin()">–í–æ–π—Ç–∏ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è</button>
    </div>

    <!-- ==================== –°–¢–†–ê–ù–ò–¶–ê: –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø ==================== -->
    <section id="page-auth" class="page auth-page">
        <div class="auth-container">
            <div class="auth-logo">
                <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="#FF6B35" stroke-width="2">
                    <path d="M6.5 6.5m-2.5 0a2.5 2.5 0 1 0 5 0a2.5 2.5 0 1 0 -5 0"/>
                    <path d="M17.5 6.5m-2.5 0a2.5 2.5 0 1 0 5 0a2.5 2.5 0 1 0 -5 0"/>
                    <path d="M4 12h2.5l1.5 5l2.5 -5h3l2.5 5l1.5 -5h2.5"/>
                    <path d="M4 17h16"/>
                </svg>
            </div>
            <h1 class="auth-title">–î–Ω–µ–≤–Ω–∏–∫ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</h1>
            <p class="auth-subtitle">–û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ –¥–æ—Å—Ç–∏–≥–∞–π—Ç–µ —Ü–µ–ª–µ–π</p>

            <div class="auth-features">
                <div class="auth-feature">
                    <span class="auth-feature-icon">üìä</span>
                    <span>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –≥—Ä–∞—Ñ–∏–∫–∏</span>
                </div>
                <div class="auth-feature">
                    <span class="auth-feature-icon">üì±</span>
                    <span>–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö</span>
                </div>
                <div class="auth-feature">
                    <span class="auth-feature-icon">üîí</span>
                    <span>–õ–∏—á–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç</span>
                </div>
            </div>

            <!-- –¢–∞–±—ã –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ñ–æ—Ä–º -->
            <div class="auth-tabs">
                <button class="auth-tab active" id="tab-login" onclick="showLoginForm()">–í—Ö–æ–¥</button>
                <button class="auth-tab" id="tab-register" onclick="showRegisterForm()">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
            </div>

            <!-- –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ -->
            <div id="login-form" class="auth-form">
                <div class="form-group">
                    <label for="login-username">–õ–æ–≥–∏–Ω</label>
                    <input type="text" id="login-username" placeholder="–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω" autocomplete="username">
                </div>
                <div class="form-group">
                    <label for="login-password">–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" id="login-password" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" autocomplete="current-password">
                </div>
                <div id="login-error" class="auth-error hidden"></div>
                <button class="btn-primary" onclick="handleLogin()">–í–æ–π—Ç–∏</button>
            </div>

            <!-- –§–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
            <div id="register-form" class="auth-form hidden">
                <div class="form-group">
                    <label for="register-username">–õ–æ–≥–∏–Ω</label>
                    <input type="text" id="register-username" placeholder="–ú–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞" autocomplete="username">
                </div>
                <div class="form-group">
                    <label for="register-name">–ò–º—è</label>
                    <input type="text" id="register-name" placeholder="–ö–∞–∫ –≤–∞—Å –Ω–∞–∑—ã–≤–∞—Ç—å?">
                </div>
                <div class="form-group">
                    <label for="register-password">–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" id="register-password" placeholder="–ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤" autocomplete="new-password">
                </div>
                <div class="form-group">
                    <label for="register-password-confirm">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å</label>
                    <input type="password" id="register-password-confirm" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å" autocomplete="new-password">
                </div>
                <div id="register-error" class="auth-error hidden"></div>
                <button class="btn-primary" onclick="handleRegister()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
            </div>

            <div class="auth-divider">
                <span>–∏–ª–∏</span>
            </div>

            <button class="btn-demo" onclick="startDemoMode()">
                –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –¥–µ–º–æ
            </button>

            <p class="auth-note">–í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –Ω–∞–¥—ë–∂–Ω–æ –∑–∞—â–∏—â–µ–Ω—ã –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏</p>
        </div>
    </section>

    <!-- ==================== –°–¢–†–ê–ù–ò–¶–ê: –¢–†–ï–ù–ò–†–û–í–ö–ê ==================== -->
    <section id="page-workout" class="page">
        <div class="header">
            <div class="header-left">
                <div class="header-greeting" id="header-date">–°–µ–≥–æ–¥–Ω—è</div>
                <div class="header-title">–ù–æ–≤–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</div>
            </div>
            <button class="user-profile-btn" id="user-profile-btn" onclick="showUserMenu()">
                <img id="user-avatar" src="" alt="" class="user-avatar">
            </button>
        </div>

        <div class="container">
            <!-- –î–∞—Ç–∞ -->
            <div class="date-picker" onclick="openDatePicker()">
                <div class="date-picker-icon">
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                        <line x1="16" y1="2" x2="16" y2="6"/>
                        <line x1="8" y1="2" x2="8" y2="6"/>
                        <line x1="3" y1="10" x2="21" y2="10"/>
                    </svg>
                </div>
                <div class="date-picker-text">
                    <div class="date-picker-label">–î–∞—Ç–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</div>
                    <div class="date-picker-value" id="workout-date-display">–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫, 9 –¥–µ–∫–∞–±—Ä—è</div>
                </div>
                <input type="date" id="workout-date" style="position: absolute; opacity: 0; width: 0;">
            </div>

            <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π -->
            <div id="exercises-container">
                <!-- –£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>

            <!-- –î–æ–±–∞–≤–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ -->
            <button class="btn btn-secondary" onclick="showAddExerciseModal()" style="margin-bottom: 16px;">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="5" x2="12" y2="19"/>
                    <line x1="5" y1="12" x2="19" y2="12"/>
                </svg>
                –î–æ–±–∞–≤–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ
            </button>

            <!-- –ó–∞–≤–µ—Ä—à–∏—Ç—å -->
            <button class="btn btn-primary" onclick="showConfirmModal()" id="save-workout-btn" style="display: none;">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 6L9 17l-5-5"/>
                </svg>
                –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É
            </button>
        </div>
    </section>

    <!-- ==================== –°–¢–†–ê–ù–ò–¶–ê: –ò–°–¢–û–†–ò–Ø ==================== -->
    <section id="page-history" class="page">
        <div class="header">
            <div class="header-title">–ò—Å—Ç–æ—Ä–∏—è</div>
            <button class="user-profile-btn" onclick="showUserMenu()">
                <img src="" alt="" class="user-avatar">
            </button>
        </div>

        <div class="container">
            <div id="history-container">
                <div class="empty-state">–ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏...</div>
            </div>
        </div>
    </section>

    <!-- ==================== –°–¢–†–ê–ù–ò–¶–ê: –°–¢–ê–¢–ò–°–¢–ò–ö–ê ==================== -->
    <section id="page-stats" class="page">
        <div class="header">
            <div class="header-title">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
            <button class="user-profile-btn" onclick="showUserMenu()">
                <img src="" alt="" class="user-avatar">
            </button>
        </div>

        <div class="container">
            <div class="form-group">
                <select id="stats-exercise-select" onchange="loadStats()">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ...</option>
                </select>
            </div>

            <div id="stats-container" style="display: none;">
                <div class="stats-grid">
                    <div class="stat-card highlight">
                        <div class="stat-icon">üèÜ</div>
                        <div class="stat-value" id="stat-max-weight">0 –∫–≥</div>
                        <div class="stat-label">–ú–∞–∫—Å. –≤–µ—Å</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üìä</div>
                        <div class="stat-value" id="stat-total-sets">0</div>
                        <div class="stat-label">–í—Å–µ–≥–æ –ø–æ–¥—Ö–æ–¥–æ–≤</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üîÑ</div>
                        <div class="stat-value" id="stat-total-reps">0</div>
                        <div class="stat-label">–í—Å–µ–≥–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üóì</div>
                        <div class="stat-value" id="stat-last-date">‚Äî</div>
                        <div class="stat-label">–ü–æ—Å–ª–µ–¥–Ω—è—è</div>
                    </div>
                </div>

                <div class="chart-card">
                    <div class="chart-title">–ü—Ä–æ–≥—Ä–µ—Å—Å –≤–µ—Å–∞</div>
                    <canvas id="weight-chart"></canvas>
                </div>
            </div>

            <!-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –º–µ—Å—è—Ü -->
            <div id="stats-overview">
                <div class="stats-period-header">
                    <span class="stats-period-title">–ü–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π</span>
                </div>

                <div class="stats-grid">
                    <div class="stat-card highlight">
                        <div class="stat-icon">üèãÔ∏è</div>
                        <div class="stat-value" id="overview-workouts">0</div>
                        <div class="stat-label">—Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üìä</div>
                        <div class="stat-value" id="overview-volume">0—Ç</div>
                        <div class="stat-label">–æ–±—â–∏–π –æ–±—ä—ë–º</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üí™</div>
                        <div class="stat-value" id="overview-exercises">0</div>
                        <div class="stat-label">—É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üîÑ</div>
                        <div class="stat-value" id="overview-sets">0</div>
                        <div class="stat-label">–ø–æ–¥—Ö–æ–¥–æ–≤</div>
                    </div>
                </div>

                <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –ø—Ä–æ—à–ª—ã–º –º–µ—Å—è—Ü–µ–º -->
                <div id="progress-comparison" class="progress-card" style="display: none;">
                    <div class="progress-card-title">–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –ø—Ä–æ—à–ª—ã–º –º–µ—Å—è—Ü–µ–º</div>
                    <div class="progress-items" id="progress-items">
                        <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                </div>

                <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –≥—Ä—É–ø–ø–∞–º –º—ã—à—Ü -->
                <div class="chart-card">
                    <div class="chart-title">–¢–æ–Ω–Ω–∞–∂ –ø–æ –≥—Ä—É–ø–ø–∞–º –º—ã—à—Ü</div>
                    <div class="muscle-tabs">
                        <button class="muscle-tab active" data-muscle="–ì—Ä—É–¥—å" onclick="switchMuscleTab('–ì—Ä—É–¥—å')"><svg class="exercise-icon" viewBox="0 0 512 512" fill="currentColor"><path d="M328.9285,384.0338l-88.7768-19.4819a45.1112,45.1112,0,0,1-22.987-13.1816,45.1318,45.1318,0,0,1-22.9911,13.1816l-88.7685,19.4819A74.41,74.41,0,0,1,59.02,379.3844l10.5835,69.76A12.787,12.787,0,0,0,82.2459,460.013h38.8186a13.8146,13.8146,0,0,1,.2532-2.635c11.3056-54.6549,66.2153-62.9,68.5956-63.24a12.7481,12.7481,0,0,1,3.5714,25.2447c-1.7868.2553-37.8267,6.2054-46.58,40.63H287.408c-8.84-34.51-44.9653-40.375-46.58-40.63a12.7479,12.7479,0,0,1,3.5693-25.2447c2.3823.34,57.2069,8.5851,68.5956,63.24a14.5059,14.5059,0,0,1,.2552,2.635h38.8186a12.7869,12.7869,0,0,0,12.6421-10.8689l10.5648-69.6363a75.1639,75.1639,0,0,1-46.3453,4.526Z"/><path d="M456.8851,168.4729,445.77,157.3571a118.9832,118.9832,0,0,0-69.3779-33.9335l-65.709-8.2137A34.0008,34.0008,0,0,1,280.9,81.4719V64.7754A12.7881,12.7881,0,0,0,268.1128,51.987H166.1875A12.7881,12.7881,0,0,0,153.4,64.7754v16.697A34,34,0,0,1,123.617,115.21l-61.0315,7.6284A12.77,12.77,0,0,0,51.4,135.509l-.0125,199.267c0,5.3939,3.4967,12.5,7.77,15.7912l.1805.139a47.4215,47.4215,0,0,0,39.0988,8.7475l90.2751-19.8124a19.9909,19.9909,0,0,0,15.7051-19.5255V230.403A25.5145,25.5145,0,0,0,188.5851,206.79c-24.1075-9.94-62.1106-21.8134-106.0985-21.8134a12.75,12.75,0,1,1,0-25.5c48.0947,0,89.4741,12.8828,115.7129,23.6945a51.2519,51.2519,0,0,1,18.9652,13.5443,51.2285,51.2285,0,0,1,18.9611-13.5484c26.2387-10.8076,67.6181-23.69,115.7129-23.69a12.75,12.75,0,0,1,0,25.5c-43.9755,0-81.97,11.867-106.0778,21.8009a25.5235,25.5235,0,0,0-15.8441,23.6251v89.7231a19.9793,19.9793,0,0,0,15.6968,19.5152L334.39,359.1232a50.7429,50.7429,0,0,0,51.8716-19.6355A99.3146,99.3146,0,0,0,405.52,280.494V255.986a12.75,12.75,0,1,1,25.5,0v24.508a124.5529,124.5529,0,0,1-21.9161,70.6885,322.33,322.33,0,0,0,28.2724,36.4518,12.7458,12.7458,0,0,0,22.1777-8.4964l1.0583-201.5995A12.7314,12.7314,0,0,0,456.8851,168.4729Z"/></svg> –ì—Ä—É–¥—å</button>
                        <button class="muscle-tab" data-muscle="–°–ø–∏–Ω–∞" onclick="switchMuscleTab('–°–ø–∏–Ω–∞')"><svg class="exercise-icon" viewBox="0 0 512 512" fill="currentColor"><path d="M434.5,230.5H421.75V179.4792A16.98,16.98,0,0,0,404.7708,162.5H387.7272A16.9769,16.9769,0,0,0,370.75,179.4792V332.5228A16.9765,16.9765,0,0,0,387.7272,349.5h17.0436A16.98,16.98,0,0,0,421.75,332.5228V281.5H434.5a25.5,25.5,0,0,0,0-51Z"/><path d="M328.2147,145.5H311.2832A17.0353,17.0353,0,0,0,294.25,162.5353V230.5h-76.5V162.5353A17.0371,17.0371,0,0,0,200.7147,145.5H183.7832A17.0353,17.0353,0,0,0,166.75,162.5353V349.4668A17.0336,17.0336,0,0,0,183.7832,366.5h16.9315A17.0353,17.0353,0,0,0,217.75,349.4668V281.5h76.5v67.9668A17.0336,17.0336,0,0,0,311.2832,366.5h16.9315A17.0353,17.0353,0,0,0,345.25,349.4668V162.5353A17.0371,17.0371,0,0,0,328.2147,145.5Z"/><path d="M124.2708,162.5H107.2272A16.9769,16.9769,0,0,0,90.25,179.4792V230.5H77.5a25.5,25.5,0,0,0,0,51H90.25v51.0228A16.9765,16.9765,0,0,0,107.2272,349.5h17.0436A16.98,16.98,0,0,0,141.25,332.5228V179.4792A16.98,16.98,0,0,0,124.2708,162.5Z"/></svg> –°–ø–∏–Ω–∞</button>
                        <button class="muscle-tab" data-muscle="–ü–ª–µ—á–∏" onclick="switchMuscleTab('–ü–ª–µ—á–∏')"><svg class="exercise-icon" viewBox="0 0 512 512" fill="currentColor"><path d="M454.4343,245.3087l-12.8351-22.1849a29.5616,29.5616,0,0,0-25.7552-14.875H352.9448a33.9894,33.9894,0,0,0-34,34v68H232.4133a244.264,244.264,0,0,1-11.8992,26.69c-7.8185,14.8231-30.15,3.4908-22.7812-11.56a229.8355,229.8355,0,0,0,17.17-43.69c7.3248-26.6522,9.66-51.4157,7.2259-77.0945a84.0784,84.0784,0,0,0,31.0241-45.8151C277.8769,54.2383,132.6258,7.3,91.3992,107.1c-10.9145,29.7814,1.7243,59.92-15.4726,88.3987a226.89,226.89,0,0,0-16.1488,42.67c-9.1786,34.17-9.8592,67.2353-3.5693,94.095,4.4561,17.8753,3.9986,36.4371-2.3809,53.6349-11.773,43.2192,33.2626,85.8537,75.483,71.1437l201.8737-54.2287a76.0144,76.0144,0,0,0,27.54-17.5945l88.9948-88.9953A42.21,42.21,0,0,0,454.4343,245.3087Zm-326.5693,45.73a183.1658,183.1658,0,0,1-13.3456,35.36,12.7014,12.7014,0,0,1-11.3908,6.97c-9.2014.19-15.7362-10.2568-11.3884-18.445,13.8824-26.74,21.1407-67.2838,14.5341-93.585a12.8276,12.8276,0,0,1,9.5193-15.3C143.8742,200.3057,133.38,271.1115,127.865,291.0387Z"/></svg> –ü–ª–µ—á–∏</button>
                        <button class="muscle-tab" data-muscle="–ù–æ–≥–∏" onclick="switchMuscleTab('–ù–æ–≥–∏')"><svg class="exercise-icon" viewBox="0 0 512 512" fill="currentColor"><path d="M428.5878,61.591A12.7583,12.7583,0,0,0,416.2238,52H95.7762a12.7583,12.7583,0,0,0-12.364,9.591C75.4746,92.4056,52,194.471,52,324c0,56.8142,9.8738,106.0248,14.572,126.22A12.67,12.67,0,0,0,78.9651,460H183.4865a12.7778,12.7778,0,0,0,12.0174-8.4808c16.9585-47.0053,30.0094-111.3607,44.3449-270.4042a65.0917,65.0917,0,0,1-27.625-15.0446l-41.3089-37.1455A12.7592,12.7592,0,1,1,188,109.97l41.3088,37.23c15.7259,14.11,37.6545,14.11,53.38,0l41.2258-37.23a12.8386,12.8386,0,0,1,18.0189.9348,12.6863,12.6863,0,0,1-.9338,18.02L299.7742,166.07a66.368,66.368,0,0,1-27.71,15.0446c14.3354,159.0466,27.461,223.4015,44.432,270.4068A12.7762,12.7762,0,0,0,328.5115,460H433.0349a12.67,12.67,0,0,0,12.3931-9.78C450.1262,430.0248,460,380.8142,460,324,460,194.471,436.5254,92.4056,428.5878,61.591Z"/></svg> –ù–æ–≥–∏</button>
                    </div>
                    <canvas id="muscle-group-chart"></canvas>
                </div>

                <!-- –¢–æ–ø —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π -->
                <div class="chart-card" style="margin-top: 16px;">
                    <div class="chart-title">–¢–æ–ø —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π</div>
                    <div id="top-exercises-list">
                        <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ==================== –°–¢–†–ê–ù–ò–¶–ê: –£–ü–†–ê–ñ–ù–ï–ù–ò–Ø ==================== -->
    <section id="page-exercises" class="page">
        <div class="header">
            <div class="header-title">–£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è</div>
            <button class="user-profile-btn" onclick="showUserMenu()">
                <img src="" alt="" class="user-avatar">
            </button>
        </div>

        <div class="container" id="exercises-list-container">
            <div class="empty-state">–ó–∞–≥—Ä—É–∑–∫–∞ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π...</div>
        </div>
    </section>

    <!-- ==================== –°–¢–†–ê–ù–ò–¶–ê: –ü–ê–†–ê–ú–ï–¢–†–´ –¢–ï–õ–ê ==================== -->
    <section id="page-body" class="page">
        <div class="header">
            <div class="header-title">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–µ–ª–∞</div>
            <button class="user-profile-btn" onclick="showUserMenu()">
                <img src="" alt="" class="user-avatar">
            </button>
        </div>

        <div class="container">
            <!-- –§–æ—Ä–º–∞ –≤–≤–æ–¥–∞ -->
            <div class="body-form-card">
                <div class="body-form-header">
                    <span class="body-form-icon">üìè</span>
                    <span class="body-form-title">–ù–æ–≤–æ–µ –∏–∑–º–µ—Ä–µ–Ω–∏–µ</span>
                </div>

                <div class="body-metrics-grid">
                    <div class="body-input-group">
                        <label>–†–æ—Å—Ç (—Å–º)</label>
                        <input type="number" id="input-height" placeholder="178" step="0.1" oninput="updateBodyFatPreview()">
                    </div>
                    <div class="body-input-group">
                        <label>–í–µ—Å (–∫–≥)</label>
                        <input type="number" id="input-weight" placeholder="80" step="0.1">
                    </div>
                    <div class="body-input-group">
                        <label>–®–µ—è (—Å–º)</label>
                        <input type="number" id="input-neck" placeholder="38" step="0.1" oninput="updateBodyFatPreview()">
                    </div>
                    <div class="body-input-group">
                        <label>–¢–∞–ª–∏—è (—Å–º)</label>
                        <input type="number" id="input-waist" placeholder="85" step="0.1" oninput="updateBodyFatPreview()">
                    </div>
                </div>

                <!-- –†–∞—Å—á–µ—Ç–Ω—ã–π % –∂–∏—Ä–∞ -->
                <div class="body-fat-preview" id="body-fat-preview" style="display: none;">
                    <div class="body-fat-label">–ü—Ä–æ—Ü–µ–Ω—Ç –∂–∏—Ä–∞ (—Ä–∞—Å—á—ë—Ç–Ω—ã–π)</div>
                    <div class="body-fat-value" id="body-fat-value">‚Äî</div>
                    <div class="body-fat-formula">–§–æ—Ä–º—É–ª–∞ –í–ú–° –°–®–ê –¥–ª—è –º—É–∂—á–∏–Ω</div>
                </div>

                <button class="btn btn-primary" onclick="saveBodyMetric()" id="save-metric-btn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 6L9 17l-5-5"/>
                    </svg>
                    –ó–∞–ø–∏—Å–∞—Ç—å –∏–∑–º–µ—Ä–µ–Ω–∏—è
                </button>
            </div>

            <!-- –¢–µ–∫—É—â–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ -->
            <div id="current-body-metrics" style="display: none;">
                <div class="section-title">–¢–µ–∫—É—â–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏</div>
                <div class="stats-grid">
                    <div class="stat-card highlight">
                        <div class="stat-icon">‚öñÔ∏è</div>
                        <div class="stat-value" id="current-weight-val">‚Äî</div>
                        <div class="stat-label">–í–µ—Å</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üìâ</div>
                        <div class="stat-value" id="current-body-fat">‚Äî</div>
                        <div class="stat-label">% –∂–∏—Ä–∞</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üìè</div>
                        <div class="stat-value" id="current-waist">‚Äî</div>
                        <div class="stat-label">–¢–∞–ª–∏—è</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üìà</div>
                        <div class="stat-value" id="weight-change">‚Äî</div>
                        <div class="stat-label">–ò–∑–º–µ–Ω–µ–Ω–∏–µ</div>
                    </div>
                </div>
            </div>

            <!-- –ì—Ä–∞—Ñ–∏–∫–∏ -->
            <div id="body-charts" style="display: none;">
                <div class="chart-card">
                    <div class="chart-title">–î–∏–Ω–∞–º–∏–∫–∞ –≤–µ—Å–∞</div>
                    <canvas id="weight-body-chart"></canvas>
                </div>

                <div class="chart-card" style="margin-top: 16px;">
                    <div class="chart-title">–î–∏–Ω–∞–º–∏–∫–∞ % –∂–∏—Ä–∞</div>
                    <canvas id="body-fat-chart"></canvas>
                </div>
            </div>

            <!-- –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ—Ä–µ–Ω–∏–π -->
            <div id="body-metrics-history" style="display: none;">
                <div class="section-title">–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ—Ä–µ–Ω–∏–π</div>
                <div id="body-metrics-history-list">
                    <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>
        </div>
    </section>

    <!-- ==================== –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û: –í–´–ë–û–† –£–ü–†–ê–ñ–ù–ï–ù–ò–Ø ==================== -->
    <div id="add-exercise-modal" class="modal hidden">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>–í—ã–±–µ—Ä–∏—Ç–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</h2>
                <button class="btn-icon" onclick="hideAddExerciseModal()">√ó</button>
            </div>
            <div class="modal-body" id="exercise-select-list">
                <!-- –°–ø–∏—Å–æ–∫ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π -->
            </div>
        </div>
    </div>

    <!-- ==================== –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û: –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–ò–Ø ==================== -->
    <div id="confirm-modal" class="modal hidden">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>–ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É?</h2>
                <button class="btn-icon" onclick="hideConfirmModal()">√ó</button>
            </div>
            <div class="modal-body" id="confirm-modal-body">
                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ -->
            </div>
            <div class="confirm-modal-actions">
                <button class="btn btn-secondary" onclick="hideConfirmModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" onclick="confirmSaveWorkout()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 6L9 17l-5-5"/>
                    </svg>
                    –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                </button>
            </div>
        </div>
    </div>

    <!-- ==================== –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û: –¢–ê–ô–ú–ï–† ==================== -->
    <div id="timer-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-title">–û—Ç–¥—ã—Ö</div>
            <div class="timer-circle">
                <svg class="timer-svg" width="200" height="200">
                    <circle class="timer-bg" cx="100" cy="100" r="90" />
                    <circle class="timer-progress" id="timer-progress" cx="100" cy="100" r="90" />
                </svg>
                <div class="timer-display" id="timer-display">02:00</div>
            </div>
            <div class="timer-controls">
                <button class="btn btn-secondary btn-small" onclick="addTimerTime(15)">+15 —Å–µ–∫</button>
                <button class="btn btn-primary btn-small" onclick="stopTimer()">–ì–æ—Ç–æ–≤–æ</button>
            </div>
        </div>
    </div>

    <!-- ==================== –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û: –ú–ï–ù–Æ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø ==================== -->
    <div id="user-menu-modal" class="modal hidden">
        <div class="modal-content modal-small">
            <div class="user-menu-header">
                <img id="user-menu-avatar" src="" alt="" class="user-menu-avatar">
                <div class="user-menu-info">
                    <div class="user-menu-name" id="user-menu-name"></div>
                    <div class="user-menu-email" id="user-menu-email"></div>
                </div>
            </div>
            <div class="user-menu-divider"></div>
            <button class="user-menu-item" onclick="signOut()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                    <polyline points="16 17 21 12 16 7"/>
                    <line x1="21" y1="12" x2="9" y2="12"/>
                </svg>
                –í—ã–π—Ç–∏
            </button>
            <button class="user-menu-item cancel" onclick="hideUserMenu()">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <!-- ==================== –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û: –î–ï–ú–û-–°–û–•–†–ê–ù–ï–ù–ò–ï ==================== -->
    <div id="demo-save-modal" class="modal hidden">
        <div class="modal-content">
            <div class="demo-modal-icon">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#FF6B35" stroke-width="2">
                    <path d="M12 9v4"/>
                    <path d="M12 17h.01"/>
                    <path d="M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0"/>
                </svg>
            </div>
            <h3 class="demo-modal-title">–≠—Ç–æ –¥–µ–º–æ-—Ä–µ–∂–∏–º</h3>
            <p class="demo-modal-text">–î–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç Google</p>
            <div class="demo-modal-actions">
                <button class="btn btn-primary" onclick="exitDemoAndLogin()">–í–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç</button>
                <button class="btn btn-secondary" onclick="hideDemoSaveModal()">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –¥–µ–º–æ</button>
            </div>
        </div>
    </div>

    <!-- ==================== –ù–ê–í–ò–ì–ê–¶–ò–Ø ==================== -->
    <nav class="nav">
        <button class="nav-btn" onclick="showPage('exercises')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M4 6h16M4 12h16M4 18h16"/>
            </svg>
            –£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
        </button>
        <button class="nav-btn" onclick="showPage('history')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 8v4l3 3"/>
                <circle cx="12" cy="12" r="10"/>
            </svg>
            –ò—Å—Ç–æ—Ä–∏—è
        </button>
        <button class="nav-btn nav-btn-main active" onclick="showPage('workout')">
            <svg viewBox="0 0 24 24" fill="none"></svg>
            –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞
        </button>
        <button class="nav-btn" onclick="showPage('stats')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M18 20V10M12 20V4M6 20v-6"/>
            </svg>
            –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        </button>
        <button class="nav-btn" onclick="showPage('body')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="5" r="3"/>
                <path d="M12 8v8"/>
                <path d="M9 21l3-5 3 5"/>
                <path d="M7 12h10"/>
            </svg>
            –ü–∞—Ä–∞–º–µ—Ç—Ä—ã
        </button>
    </nav>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- API -->
    <script src="js/api.js"></script>

    <!-- –ì–ª–∞–≤–Ω—ã–π —Å–∫—Ä–∏–ø—Ç -->
    <script>
        // ============================================
        // –°–û–°–¢–û–Ø–ù–ò–ï –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø
        // ============================================
        let exercises = [];
        let currentWorkout = []; // –ú–∞—Å—Å–∏–≤ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π —Ç–µ–∫—É—â–µ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
        let workoutDate = new Date().toISOString().split('T')[0];
        let weightChart = null;
        let lastWorkoutData = {}; // –ö—ç—à –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è–º
        let isDemo = false; // –§–ª–∞–≥ –¥–µ–º–æ-—Ä–µ–∂–∏–º–∞
        let bodyMetrics = []; // –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ—Ä–µ–Ω–∏–π —Ç–µ–ª–∞
        let weightBodyChart = null; // –ì—Ä–∞—Ñ–∏–∫ –≤–µ—Å–∞ —Ç–µ–ª–∞
        let bodyFatChart = null; // –ì—Ä–∞—Ñ–∏–∫ % –∂–∏—Ä–∞

        // ============================================
        // –î–ï–ú–û-–î–ê–ù–ù–´–ï
        // ============================================
        const DEMO_EXERCISES = [
            { id: 'ex_dips', name: '–ë—Ä—É—Å—å—è', category: '–ì—Ä—É–¥—å', type: 'base' },
            { id: 'ex_chest_press', name: '–ñ–∏–º –Ω–∞ –≥—Ä—É–¥—å', category: '–ì—Ä—É–¥—å', type: 'base' },
            { id: 'ex_butterfly', name: '–ë–∞–±–æ—á–∫–∞', category: '–ì—Ä—É–¥—å', type: 'isolation' },
            { id: 'ex_pullups', name: '–ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è', category: '–°–ø–∏–Ω–∞', type: 'base' },
            { id: 'ex_horizontal_row', name: '–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ —Ç—è–≥–∏', category: '–°–ø–∏–Ω–∞', type: 'base' },
            { id: 'ex_reverse_fly', name: '–û–±—Ä–∞—Ç–Ω–æ–µ —Ä–∞–∑–≤–µ–¥–µ–Ω–∏–µ', category: '–°–ø–∏–Ω–∞', type: 'isolation' },
            { id: 'ex_shoulder_press_dumbbell', name: '–ñ–∏–º –≥–∞–Ω—Ç–µ–ª–µ–π', category: '–ü–ª–µ—á–∏', type: 'base' },
            { id: 'ex_shoulder_press_machine', name: '–ñ–∏–º –≤ —Ç—Ä–µ–Ω–∞–∂—ë—Ä–µ', category: '–ü–ª–µ—á–∏', type: 'base' },
            { id: 'ex_lateral_raise', name: '–†–∞–∑–≤–µ–¥–µ–Ω–∏–µ –≥–∞–Ω—Ç–µ–ª–µ–π', category: '–ü–ª–µ—á–∏', type: 'isolation' },
            { id: 'ex_leg_press', name: '–ñ–∏–º –Ω–æ–≥–∞–º–∏', category: '–ù–æ–≥–∏', type: 'base' },
            { id: 'ex_hack_squat', name: '–ì–∞–∫–∫-–ø—Ä–∏—Å–µ–¥–∞–Ω–∏—è', category: '–ù–æ–≥–∏', type: 'base' },
            { id: 'ex_leg_curl', name: '–°–≥–∏–±–∞–Ω–∏–µ –Ω–æ–≥', category: '–ù–æ–≥–∏', type: 'isolation' },
            { id: 'ex_bicep_curl', name: '–°–≥–∏–±–∞–Ω–∏–µ —Ä—É–∫', category: '–†—É–∫–∏', type: 'isolation' },
            { id: 'ex_tricep_extension', name: '–†–∞–∑–≥–∏–±–∞–Ω–∏–µ —Ä—É–∫', category: '–†—É–∫–∏', type: 'isolation' }
        ];

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–µ–º–æ-—Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 2 –º–µ—Å—è—Ü–∞ —Å —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–µ–π
        function generateDemoWorkouts() {
            const workouts = [];
            const today = new Date();

            // –•–µ–ª–ø–µ—Ä –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –¥–∞—Ç—ã
            const getDate = (daysAgo) => {
                const d = new Date(today);
                d.setDate(d.getDate() - daysAgo);
                return d.toISOString().split('T')[0];
            };

            // ========== –ì–†–£–î–¨ (8 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –∑–∞ 2 –º–µ—Å—è—Ü–∞) ==========
            // –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ 8 (—Å–∞–º–∞—è —Å—Ç–∞—Ä–∞—è) - 56 –¥–Ω–µ–π –Ω–∞–∑–∞–¥
            workouts.push(
                { date: getDate(56), exercise_id: 'ex_chest_press', exercise_name: '–ñ–∏–º –Ω–∞ –≥—Ä—É–¥—å', weight: 50, reps: 12 },
                { date: getDate(56), exercise_id: 'ex_chest_press', exercise_name: '–ñ–∏–º –Ω–∞ –≥—Ä—É–¥—å', weight: 55, reps: 10 },
                { date: getDate(56), exercise_id: 'ex_chest_press', exercise_name: '–ñ–∏–º –Ω–∞ –≥—Ä—É–¥—å', weight: 55, reps: 8 },
                { date: getDate(56), exercise_id: 'ex_dips', exercise_name: '–ë—Ä—É—Å—å—è', weight: 0, reps: 10 },
                { date: getDate(56), exercise_id: 'ex_dips', exercise_name: '–ë—Ä—É—Å—å—è', weight: 0, reps: 8 }
            );
            // –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ 7 - 49 –¥–Ω–µ–π –Ω–∞–∑–∞–¥
            workouts.push(
                { date: getDate(49), exercise_id: 'ex_chest_press', exercise_name: '–ñ–∏–º –Ω–∞ –≥—Ä—É–¥—å', weight: 55, reps: 12 },
                { date: getDate(49), exercise_id: 'ex_chest_press', exercise_name: '–ñ–∏–º –Ω–∞ –≥—Ä—É–¥—å', weight: 55, reps: 10 },
                { date: getDate(49), exercise_id: 'ex_chest_press', exercise_name: '–ñ–∏–º –Ω–∞ –≥—Ä—É–¥—å', weight: 60, reps: 8 },
                { date: getDate(49), exercise_id: 'ex_dips', exercise_name: '–ë—Ä—É—Å—å—è', weight: 0, reps: 12 },
                { date: getDate(49), exercise_id: 'ex_dips', exercise_name: '–ë—Ä—É—Å—å—è', weight: 0, reps: 10 }
            );
            // –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ 6 - 42 –¥–Ω—è –Ω–∞–∑–∞–¥
            workouts.push(
                { date: getDate(42), exercise_id: 'ex_chest_press', exercise_name: '–ñ–∏–º –Ω–∞ –≥—Ä—É–¥—å', weight: 55, reps: 12 },
                { date: getDate(42), exercise_id: 'ex_chest_press', exercise_name: '–ñ–∏–º –Ω–∞ –≥—Ä—É–¥—å', weight: 60, reps: 10 },
                { date: getDate(42), exercise_id: 'ex_chest_press', exercise_name: '–ñ–∏–º –Ω–∞ –≥—Ä—É–¥—å', weight: 60, reps: 9 },
                { date: getDate(42), exercise_id: 'ex_dips', exercise_name: '–ë—Ä—É—Å—å—è', weight: 0, reps: 12 },
                { date: getDate(42), exercise_id: 'ex_dips', exercise_name: '–ë—Ä—É—Å—å—è', weight: 0, reps: 11 }
            );
            // –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ 5 - 35 –¥–Ω–µ–π –Ω–∞–∑–∞–¥
            workouts.push(
                { date: getDate(35), exercise_id: 'ex_chest_press', exercise_name: '–ñ–∏–º –Ω–∞ –≥—Ä—É–¥—å', weight: 60, reps: 12 },
                { date: getDate(35), exercise_id: 'ex_chest_press', exercise_name: '–ñ–∏–º –Ω–∞ –≥—Ä—É–¥—å', weight: 60, reps: 10 },
                { date: getDate(35), exercise_id: 'ex_chest_press', exercise_name: '–ñ–∏–º –Ω–∞ –≥—Ä—É–¥—å', weight: 65, reps: 8 },
                { date: getDate(35), exercise_id: 'ex_dips', exercise_name: '–ë—Ä—É—Å—å—è', weight: 0, reps: 14 },
                { date: getDate(35), exercise_id: 'ex_dips', exercise_name: '–ë—Ä—É—Å—å—è', weight: 0, reps: 12 }
            );
            // –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ 4 - 28 –¥–Ω–µ–π –Ω–∞–∑–∞–¥
            workouts.push(
                { date: getDate(28), exercise_id: 'ex_chest_press', exercise_name: '–ñ–∏–º –Ω–∞ –≥—Ä—É–¥—å', weight: 60, reps: 12 },
                { date: getDate(28), exercise_id: 'ex_chest_press', exercise_name: '–ñ–∏–º –Ω–∞ –≥—Ä—É–¥—å', weight: 65, reps: 10 },
                { date: getDate(28), exercise_id: 'ex_chest_press', exercise_name: '–ñ–∏–º –Ω–∞ –≥—Ä—É–¥—å', weight: 65, reps: 8 },
                { date: getDate(28), exercise_id: 'ex_dips', exercise_name: '–ë—Ä—É—Å—å—è', weight: 0, reps: 15 },
                { date: getDate(28), exercise_id: 'ex_dips', exercise_name: '–ë—Ä—É—Å—å—è', weight: 0, reps: 12 }
            );
            // –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ 3 - 21 –¥–µ–Ω—å –Ω–∞–∑–∞–¥
            workouts.push(
                { date: getDate(21), exercise_id: 'ex_chest_press', exercise_name: '–ñ–∏–º –Ω–∞ –≥—Ä—É–¥—å', weight: 65, reps: 12 },
                { date: getDate(21), exercise_id: 'ex_chest_press', exercise_name: '–ñ–∏–º –Ω–∞ –≥—Ä—É–¥—å', weight: 65, reps: 10 },
                { date: getDate(21), exercise_id: 'ex_chest_press', exercise_name: '–ñ–∏–º –Ω–∞ –≥—Ä—É–¥—å', weight: 70, reps: 7 },
                { date: getDate(21), exercise_id: 'ex_dips', exercise_name: '–ë—Ä—É—Å—å—è', weight: 5, reps: 12 },
                { date: getDate(21), exercise_id: 'ex_dips', exercise_name: '–ë—Ä—É—Å—å—è', weight: 5, reps: 10 }
            );
            // –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ 2 - 14 –¥–Ω–µ–π –Ω–∞–∑–∞–¥
            workouts.push(
                { date: getDate(14), exercise_id: 'ex_chest_press', exercise_name: '–ñ–∏–º –Ω–∞ –≥—Ä—É–¥—å', weight: 65, reps: 12 },
                { date: getDate(14), exercise_id: 'ex_chest_press', exercise_name: '–ñ–∏–º –Ω–∞ –≥—Ä—É–¥—å', weight: 70, reps: 10 },
                { date: getDate(14), exercise_id: 'ex_chest_press', exercise_name: '–ñ–∏–º –Ω–∞ –≥—Ä—É–¥—å', weight: 70, reps: 8 },
                { date: getDate(14), exercise_id: 'ex_dips', exercise_name: '–ë—Ä—É—Å—å—è', weight: 5, reps: 14 },
                { date: getDate(14), exercise_id: 'ex_dips', exercise_name: '–ë—Ä—É—Å—å—è', weight: 5, reps: 12 }
            );
            // –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ 1 - 3 –¥–Ω—è –Ω–∞–∑–∞–¥ (–ø–æ—Å–ª–µ–¥–Ω—è—è)
            workouts.push(
                { date: getDate(3), exercise_id: 'ex_chest_press', exercise_name: '–ñ–∏–º –Ω–∞ –≥—Ä—É–¥—å', weight: 70, reps: 12 },
                { date: getDate(3), exercise_id: 'ex_chest_press', exercise_name: '–ñ–∏–º –Ω–∞ –≥—Ä—É–¥—å', weight: 70, reps: 10 },
                { date: getDate(3), exercise_id: 'ex_chest_press', exercise_name: '–ñ–∏–º –Ω–∞ –≥—Ä—É–¥—å', weight: 75, reps: 8 },
                { date: getDate(3), exercise_id: 'ex_dips', exercise_name: '–ë—Ä—É—Å—å—è', weight: 10, reps: 12 },
                { date: getDate(3), exercise_id: 'ex_dips', exercise_name: '–ë—Ä—É—Å—å—è', weight: 10, reps: 10 }
            );

            // ========== –°–ü–ò–ù–ê (8 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫) ==========
            workouts.push(
                { date: getDate(54), exercise_id: 'ex_pullups', exercise_name: '–ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è', weight: 0, reps: 8 },
                { date: getDate(54), exercise_id: 'ex_pullups', exercise_name: '–ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è', weight: 0, reps: 6 },
                { date: getDate(54), exercise_id: 'ex_horizontal_row', exercise_name: '–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ —Ç—è–≥–∏', weight: 40, reps: 12 },
                { date: getDate(54), exercise_id: 'ex_horizontal_row', exercise_name: '–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ —Ç—è–≥–∏', weight: 45, reps: 10 }
            );
            workouts.push(
                { date: getDate(47), exercise_id: 'ex_pullups', exercise_name: '–ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è', weight: 0, reps: 9 },
                { date: getDate(47), exercise_id: 'ex_pullups', exercise_name: '–ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è', weight: 0, reps: 7 },
                { date: getDate(47), exercise_id: 'ex_horizontal_row', exercise_name: '–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ —Ç—è–≥–∏', weight: 45, reps: 12 },
                { date: getDate(47), exercise_id: 'ex_horizontal_row', exercise_name: '–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ —Ç—è–≥–∏', weight: 45, reps: 10 }
            );
            workouts.push(
                { date: getDate(40), exercise_id: 'ex_pullups', exercise_name: '–ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è', weight: 0, reps: 10 },
                { date: getDate(40), exercise_id: 'ex_pullups', exercise_name: '–ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è', weight: 0, reps: 8 },
                { date: getDate(40), exercise_id: 'ex_horizontal_row', exercise_name: '–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ —Ç—è–≥–∏', weight: 45, reps: 12 },
                { date: getDate(40), exercise_id: 'ex_horizontal_row', exercise_name: '–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ —Ç—è–≥–∏', weight: 50, reps: 10 }
            );
            workouts.push(
                { date: getDate(33), exercise_id: 'ex_pullups', exercise_name: '–ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è', weight: 0, reps: 10 },
                { date: getDate(33), exercise_id: 'ex_pullups', exercise_name: '–ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è', weight: 0, reps: 9 },
                { date: getDate(33), exercise_id: 'ex_horizontal_row', exercise_name: '–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ —Ç—è–≥–∏', weight: 50, reps: 12 },
                { date: getDate(33), exercise_id: 'ex_horizontal_row', exercise_name: '–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ —Ç—è–≥–∏', weight: 50, reps: 10 }
            );
            workouts.push(
                { date: getDate(26), exercise_id: 'ex_pullups', exercise_name: '–ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è', weight: 0, reps: 11 },
                { date: getDate(26), exercise_id: 'ex_pullups', exercise_name: '–ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è', weight: 0, reps: 9 },
                { date: getDate(26), exercise_id: 'ex_horizontal_row', exercise_name: '–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ —Ç—è–≥–∏', weight: 50, reps: 12 },
                { date: getDate(26), exercise_id: 'ex_horizontal_row', exercise_name: '–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ —Ç—è–≥–∏', weight: 55, reps: 10 }
            );
            workouts.push(
                { date: getDate(19), exercise_id: 'ex_pullups', exercise_name: '–ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è', weight: 0, reps: 12 },
                { date: getDate(19), exercise_id: 'ex_pullups', exercise_name: '–ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è', weight: 0, reps: 10 },
                { date: getDate(19), exercise_id: 'ex_horizontal_row', exercise_name: '–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ —Ç—è–≥–∏', weight: 55, reps: 12 },
                { date: getDate(19), exercise_id: 'ex_horizontal_row', exercise_name: '–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ —Ç—è–≥–∏', weight: 55, reps: 10 }
            );
            workouts.push(
                { date: getDate(12), exercise_id: 'ex_pullups', exercise_name: '–ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è', weight: 5, reps: 10 },
                { date: getDate(12), exercise_id: 'ex_pullups', exercise_name: '–ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è', weight: 5, reps: 8 },
                { date: getDate(12), exercise_id: 'ex_horizontal_row', exercise_name: '–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ —Ç—è–≥–∏', weight: 55, reps: 12 },
                { date: getDate(12), exercise_id: 'ex_horizontal_row', exercise_name: '–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ —Ç—è–≥–∏', weight: 60, reps: 10 }
            );
            workouts.push(
                { date: getDate(5), exercise_id: 'ex_pullups', exercise_name: '–ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è', weight: 5, reps: 12 },
                { date: getDate(5), exercise_id: 'ex_pullups', exercise_name: '–ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è', weight: 5, reps: 10 },
                { date: getDate(5), exercise_id: 'ex_horizontal_row', exercise_name: '–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ —Ç—è–≥–∏', weight: 60, reps: 12 },
                { date: getDate(5), exercise_id: 'ex_horizontal_row', exercise_name: '–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ —Ç—è–≥–∏', weight: 60, reps: 10 }
            );

            // ========== –ù–û–ì–ò (8 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫) ==========
            workouts.push(
                { date: getDate(55), exercise_id: 'ex_leg_press', exercise_name: '–ñ–∏–º –Ω–æ–≥–∞–º–∏', weight: 100, reps: 15 },
                { date: getDate(55), exercise_id: 'ex_leg_press', exercise_name: '–ñ–∏–º –Ω–æ–≥–∞–º–∏', weight: 110, reps: 12 },
                { date: getDate(55), exercise_id: 'ex_hack_squat', exercise_name: '–ì–∞–∫–∫-–ø—Ä–∏—Å–µ–¥–∞–Ω–∏—è', weight: 60, reps: 12 },
                { date: getDate(55), exercise_id: 'ex_hack_squat', exercise_name: '–ì–∞–∫–∫-–ø—Ä–∏—Å–µ–¥–∞–Ω–∏—è', weight: 70, reps: 10 }
            );
            workouts.push(
                { date: getDate(48), exercise_id: 'ex_leg_press', exercise_name: '–ñ–∏–º –Ω–æ–≥–∞–º–∏', weight: 110, reps: 15 },
                { date: getDate(48), exercise_id: 'ex_leg_press', exercise_name: '–ñ–∏–º –Ω–æ–≥–∞–º–∏', weight: 120, reps: 12 },
                { date: getDate(48), exercise_id: 'ex_hack_squat', exercise_name: '–ì–∞–∫–∫-–ø—Ä–∏—Å–µ–¥–∞–Ω–∏—è', weight: 70, reps: 12 },
                { date: getDate(48), exercise_id: 'ex_hack_squat', exercise_name: '–ì–∞–∫–∫-–ø—Ä–∏—Å–µ–¥–∞–Ω–∏—è', weight: 75, reps: 10 }
            );
            workouts.push(
                { date: getDate(41), exercise_id: 'ex_leg_press', exercise_name: '–ñ–∏–º –Ω–æ–≥–∞–º–∏', weight: 115, reps: 15 },
                { date: getDate(41), exercise_id: 'ex_leg_press', exercise_name: '–ñ–∏–º –Ω–æ–≥–∞–º–∏', weight: 125, reps: 12 },
                { date: getDate(41), exercise_id: 'ex_hack_squat', exercise_name: '–ì–∞–∫–∫-–ø—Ä–∏—Å–µ–¥–∞–Ω–∏—è', weight: 75, reps: 12 },
                { date: getDate(41), exercise_id: 'ex_hack_squat', exercise_name: '–ì–∞–∫–∫-–ø—Ä–∏—Å–µ–¥–∞–Ω–∏—è', weight: 80, reps: 10 }
            );
            workouts.push(
                { date: getDate(34), exercise_id: 'ex_leg_press', exercise_name: '–ñ–∏–º –Ω–æ–≥–∞–º–∏', weight: 120, reps: 15 },
                { date: getDate(34), exercise_id: 'ex_leg_press', exercise_name: '–ñ–∏–º –Ω–æ–≥–∞–º–∏', weight: 130, reps: 12 },
                { date: getDate(34), exercise_id: 'ex_hack_squat', exercise_name: '–ì–∞–∫–∫-–ø—Ä–∏—Å–µ–¥–∞–Ω–∏—è', weight: 80, reps: 12 },
                { date: getDate(34), exercise_id: 'ex_hack_squat', exercise_name: '–ì–∞–∫–∫-–ø—Ä–∏—Å–µ–¥–∞–Ω–∏—è', weight: 85, reps: 10 }
            );
            workouts.push(
                { date: getDate(27), exercise_id: 'ex_leg_press', exercise_name: '–ñ–∏–º –Ω–æ–≥–∞–º–∏', weight: 125, reps: 15 },
                { date: getDate(27), exercise_id: 'ex_leg_press', exercise_name: '–ñ–∏–º –Ω–æ–≥–∞–º–∏', weight: 135, reps: 12 },
                { date: getDate(27), exercise_id: 'ex_hack_squat', exercise_name: '–ì–∞–∫–∫-–ø—Ä–∏—Å–µ–¥–∞–Ω–∏—è', weight: 85, reps: 12 },
                { date: getDate(27), exercise_id: 'ex_hack_squat', exercise_name: '–ì–∞–∫–∫-–ø—Ä–∏—Å–µ–¥–∞–Ω–∏—è', weight: 90, reps: 10 }
            );
            workouts.push(
                { date: getDate(20), exercise_id: 'ex_leg_press', exercise_name: '–ñ–∏–º –Ω–æ–≥–∞–º–∏', weight: 130, reps: 15 },
                { date: getDate(20), exercise_id: 'ex_leg_press', exercise_name: '–ñ–∏–º –Ω–æ–≥–∞–º–∏', weight: 140, reps: 12 },
                { date: getDate(20), exercise_id: 'ex_hack_squat', exercise_name: '–ì–∞–∫–∫-–ø—Ä–∏—Å–µ–¥–∞–Ω–∏—è', weight: 85, reps: 12 },
                { date: getDate(20), exercise_id: 'ex_hack_squat', exercise_name: '–ì–∞–∫–∫-–ø—Ä–∏—Å–µ–¥–∞–Ω–∏—è', weight: 95, reps: 10 }
            );
            workouts.push(
                { date: getDate(13), exercise_id: 'ex_leg_press', exercise_name: '–ñ–∏–º –Ω–æ–≥–∞–º–∏', weight: 135, reps: 15 },
                { date: getDate(13), exercise_id: 'ex_leg_press', exercise_name: '–ñ–∏–º –Ω–æ–≥–∞–º–∏', weight: 145, reps: 12 },
                { date: getDate(13), exercise_id: 'ex_hack_squat', exercise_name: '–ì–∞–∫–∫-–ø—Ä–∏—Å–µ–¥–∞–Ω–∏—è', weight: 90, reps: 12 },
                { date: getDate(13), exercise_id: 'ex_hack_squat', exercise_name: '–ì–∞–∫–∫-–ø—Ä–∏—Å–µ–¥–∞–Ω–∏—è', weight: 100, reps: 10 }
            );
            workouts.push(
                { date: getDate(6), exercise_id: 'ex_leg_press', exercise_name: '–ñ–∏–º –Ω–æ–≥–∞–º–∏', weight: 140, reps: 15 },
                { date: getDate(6), exercise_id: 'ex_leg_press', exercise_name: '–ñ–∏–º –Ω–æ–≥–∞–º–∏', weight: 150, reps: 12 },
                { date: getDate(6), exercise_id: 'ex_hack_squat', exercise_name: '–ì–∞–∫–∫-–ø—Ä–∏—Å–µ–¥–∞–Ω–∏—è', weight: 95, reps: 12 },
                { date: getDate(6), exercise_id: 'ex_hack_squat', exercise_name: '–ì–∞–∫–∫-–ø—Ä–∏—Å–µ–¥–∞–Ω–∏—è', weight: 105, reps: 10 }
            );

            // ========== –ü–õ–ï–ß–ò (8 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫) ==========
            workouts.push(
                { date: getDate(53), exercise_id: 'ex_shoulder_press_dumbbell', exercise_name: '–ñ–∏–º –≥–∞–Ω—Ç–µ–ª–µ–π', weight: 14, reps: 12 },
                { date: getDate(53), exercise_id: 'ex_shoulder_press_dumbbell', exercise_name: '–ñ–∏–º –≥–∞–Ω—Ç–µ–ª–µ–π', weight: 16, reps: 10 },
                { date: getDate(53), exercise_id: 'ex_lateral_raise', exercise_name: '–†–∞–∑–≤–µ–¥–µ–Ω–∏–µ –≥–∞–Ω—Ç–µ–ª–µ–π', weight: 8, reps: 15 },
                { date: getDate(53), exercise_id: 'ex_lateral_raise', exercise_name: '–†–∞–∑–≤–µ–¥–µ–Ω–∏–µ –≥–∞–Ω—Ç–µ–ª–µ–π', weight: 8, reps: 12 }
            );
            workouts.push(
                { date: getDate(46), exercise_id: 'ex_shoulder_press_dumbbell', exercise_name: '–ñ–∏–º –≥–∞–Ω—Ç–µ–ª–µ–π', weight: 16, reps: 12 },
                { date: getDate(46), exercise_id: 'ex_shoulder_press_dumbbell', exercise_name: '–ñ–∏–º –≥–∞–Ω—Ç–µ–ª–µ–π', weight: 16, reps: 10 },
                { date: getDate(46), exercise_id: 'ex_lateral_raise', exercise_name: '–†–∞–∑–≤–µ–¥–µ–Ω–∏–µ –≥–∞–Ω—Ç–µ–ª–µ–π', weight: 8, reps: 15 },
                { date: getDate(46), exercise_id: 'ex_lateral_raise', exercise_name: '–†–∞–∑–≤–µ–¥–µ–Ω–∏–µ –≥–∞–Ω—Ç–µ–ª–µ–π', weight: 10, reps: 12 }
            );
            workouts.push(
                { date: getDate(39), exercise_id: 'ex_shoulder_press_dumbbell', exercise_name: '–ñ–∏–º –≥–∞–Ω—Ç–µ–ª–µ–π', weight: 16, reps: 12 },
                { date: getDate(39), exercise_id: 'ex_shoulder_press_dumbbell', exercise_name: '–ñ–∏–º –≥–∞–Ω—Ç–µ–ª–µ–π', weight: 18, reps: 10 },
                { date: getDate(39), exercise_id: 'ex_lateral_raise', exercise_name: '–†–∞–∑–≤–µ–¥–µ–Ω–∏–µ –≥–∞–Ω—Ç–µ–ª–µ–π', weight: 10, reps: 15 },
                { date: getDate(39), exercise_id: 'ex_lateral_raise', exercise_name: '–†–∞–∑–≤–µ–¥–µ–Ω–∏–µ –≥–∞–Ω—Ç–µ–ª–µ–π', weight: 10, reps: 12 }
            );
            workouts.push(
                { date: getDate(32), exercise_id: 'ex_shoulder_press_dumbbell', exercise_name: '–ñ–∏–º –≥–∞–Ω—Ç–µ–ª–µ–π', weight: 18, reps: 12 },
                { date: getDate(32), exercise_id: 'ex_shoulder_press_dumbbell', exercise_name: '–ñ–∏–º –≥–∞–Ω—Ç–µ–ª–µ–π', weight: 18, reps: 10 },
                { date: getDate(32), exercise_id: 'ex_lateral_raise', exercise_name: '–†–∞–∑–≤–µ–¥–µ–Ω–∏–µ –≥–∞–Ω—Ç–µ–ª–µ–π', weight: 10, reps: 15 },
                { date: getDate(32), exercise_id: 'ex_lateral_raise', exercise_name: '–†–∞–∑–≤–µ–¥–µ–Ω–∏–µ –≥–∞–Ω—Ç–µ–ª–µ–π', weight: 10, reps: 14 }
            );
            workouts.push(
                { date: getDate(25), exercise_id: 'ex_shoulder_press_dumbbell', exercise_name: '–ñ–∏–º –≥–∞–Ω—Ç–µ–ª–µ–π', weight: 18, reps: 12 },
                { date: getDate(25), exercise_id: 'ex_shoulder_press_dumbbell', exercise_name: '–ñ–∏–º –≥–∞–Ω—Ç–µ–ª–µ–π', weight: 20, reps: 10 },
                { date: getDate(25), exercise_id: 'ex_lateral_raise', exercise_name: '–†–∞–∑–≤–µ–¥–µ–Ω–∏–µ –≥–∞–Ω—Ç–µ–ª–µ–π', weight: 10, reps: 15 },
                { date: getDate(25), exercise_id: 'ex_lateral_raise', exercise_name: '–†–∞–∑–≤–µ–¥–µ–Ω–∏–µ –≥–∞–Ω—Ç–µ–ª–µ–π', weight: 12, reps: 12 }
            );
            workouts.push(
                { date: getDate(18), exercise_id: 'ex_shoulder_press_dumbbell', exercise_name: '–ñ–∏–º –≥–∞–Ω—Ç–µ–ª–µ–π', weight: 20, reps: 12 },
                { date: getDate(18), exercise_id: 'ex_shoulder_press_dumbbell', exercise_name: '–ñ–∏–º –≥–∞–Ω—Ç–µ–ª–µ–π', weight: 20, reps: 10 },
                { date: getDate(18), exercise_id: 'ex_lateral_raise', exercise_name: '–†–∞–∑–≤–µ–¥–µ–Ω–∏–µ –≥–∞–Ω—Ç–µ–ª–µ–π', weight: 12, reps: 15 },
                { date: getDate(18), exercise_id: 'ex_lateral_raise', exercise_name: '–†–∞–∑–≤–µ–¥–µ–Ω–∏–µ –≥–∞–Ω—Ç–µ–ª–µ–π', weight: 12, reps: 12 }
            );
            workouts.push(
                { date: getDate(11), exercise_id: 'ex_shoulder_press_dumbbell', exercise_name: '–ñ–∏–º –≥–∞–Ω—Ç–µ–ª–µ–π', weight: 20, reps: 12 },
                { date: getDate(11), exercise_id: 'ex_shoulder_press_dumbbell', exercise_name: '–ñ–∏–º –≥–∞–Ω—Ç–µ–ª–µ–π', weight: 22, reps: 10 },
                { date: getDate(11), exercise_id: 'ex_lateral_raise', exercise_name: '–†–∞–∑–≤–µ–¥–µ–Ω–∏–µ –≥–∞–Ω—Ç–µ–ª–µ–π', weight: 12, reps: 15 },
                { date: getDate(11), exercise_id: 'ex_lateral_raise', exercise_name: '–†–∞–∑–≤–µ–¥–µ–Ω–∏–µ –≥–∞–Ω—Ç–µ–ª–µ–π', weight: 12, reps: 14 }
            );
            workouts.push(
                { date: getDate(4), exercise_id: 'ex_shoulder_press_dumbbell', exercise_name: '–ñ–∏–º –≥–∞–Ω—Ç–µ–ª–µ–π', weight: 22, reps: 12 },
                { date: getDate(4), exercise_id: 'ex_shoulder_press_dumbbell', exercise_name: '–ñ–∏–º –≥–∞–Ω—Ç–µ–ª–µ–π', weight: 22, reps: 10 },
                { date: getDate(4), exercise_id: 'ex_lateral_raise', exercise_name: '–†–∞–∑–≤–µ–¥–µ–Ω–∏–µ –≥–∞–Ω—Ç–µ–ª–µ–π', weight: 12, reps: 15 },
                { date: getDate(4), exercise_id: 'ex_lateral_raise', exercise_name: '–†–∞–∑–≤–µ–¥–µ–Ω–∏–µ –≥–∞–Ω—Ç–µ–ª–µ–π', weight: 14, reps: 12 }
            );

            return workouts;
        }

        let DEMO_WORKOUTS = [];

        // ============================================
        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
        // ============================================
        document.addEventListener('DOMContentLoaded', async () => {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
            if (!API.isAuthenticated()) {
                showAuthPage();
                document.getElementById('loading').classList.add('hidden');
                return;
            }

            // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω - –∑–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
            await initApp();
        });

        // –°–ª—É—à–∞–µ–º —Å–æ–±—ã—Ç–∏–µ logout
        window.addEventListener('auth:logout', () => {
            showAuthPage();
        });

        /**
         * –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
         */
        function showAuthPage() {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('page-auth').classList.add('active');
            document.querySelector('.nav').style.display = 'none';
        }

        /**
         * –ü–æ–∫–∞–∑–∞—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
         */
        function showMainApp() {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('page-workout').classList.add('active');
            document.querySelector('.nav').style.display = 'flex';

            // –û–±–Ω–æ–≤–ª—è–µ–º UI –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            updateUserUI();
        }

        /**
         * –û–±–Ω–æ–≤–∏—Ç—å UI –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
         */
        function updateUserUI() {
            if (isDemo) {
                // –î–µ–º–æ-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
                const demoAvatar = 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23FF6B35"><circle cx="12" cy="8" r="4"/><path d="M12 14c-6 0-8 3-8 6v2h16v-2c0-3-2-6-8-6z"/></svg>';
                document.querySelectorAll('.user-avatar').forEach(img => img.src = demoAvatar);
                document.getElementById('user-menu-avatar').src = demoAvatar;
                document.getElementById('user-menu-name').textContent = '–î–µ–º–æ-—Ä–µ–∂–∏–º';
                document.getElementById('user-menu-email').textContent = '–í–æ–π–¥–∏—Ç–µ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö';
                return;
            }

            const user = API.getCurrentUser();
            if (user) {
                // –î–µ—Ñ–æ–ª—Ç–Ω—ã–π –∞–≤–∞—Ç–∞—Ä
                const avatar = 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23FF6B35"><circle cx="12" cy="8" r="4"/><path d="M12 14c-6 0-8 3-8 6v2h16v-2c0-3-2-6-8-6z"/></svg>';
                // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ –∞–≤–∞—Ç–∞—Ä—ã –Ω–∞ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö
                document.querySelectorAll('.user-avatar').forEach(img => img.src = avatar);
                document.getElementById('user-menu-avatar').src = avatar;
                document.getElementById('user-menu-name').textContent = user.name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
                document.getElementById('user-menu-email').textContent = '@' + (user.username || '');
            }
        }

        // ============================================
        // –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø (–ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å)
        // ============================================

        /**
         * –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É –≤—Ö–æ–¥–∞
         */
        function showLoginForm() {
            document.getElementById('login-form').classList.remove('hidden');
            document.getElementById('register-form').classList.add('hidden');
            document.getElementById('tab-login').classList.add('active');
            document.getElementById('tab-register').classList.remove('active');
            document.getElementById('login-error').classList.add('hidden');
        }

        /**
         * –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
         */
        function showRegisterForm() {
            document.getElementById('login-form').classList.add('hidden');
            document.getElementById('register-form').classList.remove('hidden');
            document.getElementById('tab-login').classList.remove('active');
            document.getElementById('tab-register').classList.add('active');
            document.getElementById('register-error').classList.add('hidden');
        }

        /**
         * –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥–∞
         */
        async function handleLogin() {
            const username = document.getElementById('login-username').value.trim();
            const password = document.getElementById('login-password').value;
            const errorEl = document.getElementById('login-error');

            errorEl.classList.add('hidden');

            if (!username || !password) {
                errorEl.textContent = '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è';
                errorEl.classList.remove('hidden');
                return;
            }

            document.getElementById('loading').classList.remove('hidden');

            try {
                await API.login(username, password);
                await initApp();
                showMainApp();
            } catch (error) {
                errorEl.textContent = error.message;
                errorEl.classList.remove('hidden');
            } finally {
                document.getElementById('loading').classList.add('hidden');
            }
        }

        /**
         * –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
         */
        async function handleRegister() {
            const username = document.getElementById('register-username').value.trim();
            const name = document.getElementById('register-name').value.trim();
            const password = document.getElementById('register-password').value;
            const passwordConfirm = document.getElementById('register-password-confirm').value;
            const errorEl = document.getElementById('register-error');

            errorEl.classList.add('hidden');

            // –í–∞–ª–∏–¥–∞—Ü–∏—è
            if (!username || !password) {
                errorEl.textContent = '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è';
                errorEl.classList.remove('hidden');
                return;
            }

            if (username.length < 3) {
                errorEl.textContent = '–õ–æ–≥–∏–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞';
                errorEl.classList.remove('hidden');
                return;
            }

            if (password.length < 6) {
                errorEl.textContent = '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤';
                errorEl.classList.remove('hidden');
                return;
            }

            if (password !== passwordConfirm) {
                errorEl.textContent = '–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç';
                errorEl.classList.remove('hidden');
                return;
            }

            document.getElementById('loading').classList.remove('hidden');

            try {
                await API.register(username, password, name || username);
                await initApp();
                showMainApp();
            } catch (error) {
                errorEl.textContent = error.message;
                errorEl.classList.remove('hidden');
            } finally {
                document.getElementById('loading').classList.add('hidden');
            }
        }

        // –¢–∞–π–º–µ—Ä –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞
        let tokenCheckInterval = null;

        /**
         * –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫—É—é –ø—Ä–æ–≤–µ—Ä–∫—É —Ç–æ–∫–µ–Ω–∞
         */
        function startTokenCheck() {
            if (tokenCheckInterval) {
                clearInterval(tokenCheckInterval);
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
            tokenCheckInterval = setInterval(() => {
                if (isDemo) return;

                // –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –∏—Å—Ç—ë–∫ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞
                if (!API.isAuthenticated()) {
                    console.log('–°–µ—Å—Å–∏—è –∏—Å—Ç–µ–∫–ª–∞, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞');
                    showAuthPage();
                }
            }, 5 * 60 * 1000);
        }

        /**
         * –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Ç–æ–∫–µ–Ω–∞
         */
        function stopTokenCheck() {
            if (tokenCheckInterval) {
                clearInterval(tokenCheckInterval);
                tokenCheckInterval = null;
            }
        }

        /**
         * –í—ã—Ö–æ–¥ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞
         */
        async function signOut() {
            hideUserMenu();
            stopTokenCheck();

            // –í –¥–µ–º–æ-—Ä–µ–∂–∏–º–µ –ø—Ä–æ—Å—Ç–æ –≤—ã—Ö–æ–¥–∏–º –∏–∑ –¥–µ–º–æ
            if (isDemo) {
                exitDemoAndLogin();
                return;
            }

            // –í—ã—Ö–æ–¥ —á–µ—Ä–µ–∑ API (—É–¥–∞–ª—è–µ—Ç —Å–µ—Å—Å–∏—é –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)
            await API.logout();

            // –û—á–∏—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            exercises = [];
            currentWorkout = [];
            lastWorkoutData = {};

            showAuthPage();
        }

        /**
         * –ü–æ–∫–∞–∑–∞—Ç—å –º–µ–Ω—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
         */
        function showUserMenu() {
            document.getElementById('user-menu-modal').classList.remove('hidden');
        }

        /**
         * –°–∫—Ä—ã—Ç—å –º–µ–Ω—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
         */
        function hideUserMenu() {
            document.getElementById('user-menu-modal').classList.add('hidden');
        }

        /**
         * –ó–∞–ø—É—Å–∫ –¥–µ–º–æ-—Ä–µ–∂–∏–º–∞
         */
        function startDemoMode() {
            isDemo = true;
            DEMO_WORKOUTS = generateDemoWorkouts();

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ
            exercises = DEMO_EXERCISES;

            // –ó–∞–ø–æ–ª–Ω—è–µ–º lastWorkoutData –∏–∑ –¥–µ–º–æ-—Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
            const byExerciseAndDate = {};
            DEMO_WORKOUTS.forEach(w => {
                const key = w.exercise_id + '_' + w.date;
                if (!byExerciseAndDate[key]) {
                    byExerciseAndDate[key] = {
                        exercise_id: w.exercise_id,
                        date: w.date,
                        sets: []
                    };
                }
                byExerciseAndDate[key].sets.push({
                    weight: w.weight,
                    reps: w.reps
                });
            });

            Object.values(byExerciseAndDate).forEach(item => {
                const existing = lastWorkoutData[item.exercise_id];
                if (!existing || !existing.date || new Date(item.date) > new Date(existing.date)) {
                    lastWorkoutData[item.exercise_id] = {
                        date: item.date,
                        sets: item.sets
                    };
                }
            });

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–∞—Ç—É
            document.getElementById('workout-date').value = workoutDate;
            updateDateDisplay();

            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å–ø–∏—Å–∫–∏
            renderExercisesList();
            populateStatsSelect();

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–∞–Ω–Ω–µ—Ä –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
            document.body.classList.add('demo-mode');
            document.getElementById('demo-banner').classList.remove('hidden');
            showMainApp();

            // –°–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            document.getElementById('loading').classList.add('hidden');
        }

        /**
         * –í—ã—Ö–æ–¥ –∏–∑ –¥–µ–º–æ –∏ –ø–µ—Ä–µ—Ö–æ–¥ –∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
         */
        function exitDemoAndLogin() {
            isDemo = false;
            exercises = [];
            currentWorkout = [];
            lastWorkoutData = {};
            DEMO_WORKOUTS = [];
            DEMO_BODY_METRICS = [];
            bodyMetrics = [];

            document.body.classList.remove('demo-mode');
            document.getElementById('demo-banner').classList.add('hidden');
            hideDemoSaveModal();
            showAuthPage();
        }

        /**
         * –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–µ–º–æ-—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
         */
        function showDemoSaveModal() {
            document.getElementById('demo-save-modal').classList.remove('hidden');
        }

        /**
         * –°–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–µ–º–æ-—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
         */
        function hideDemoSaveModal() {
            document.getElementById('demo-save-modal').classList.add('hidden');
        }

        /**
         * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
         */
        async function initApp() {
            // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É —Ç–æ–∫–µ–Ω–∞ (–µ—Å–ª–∏ –Ω–µ –¥–µ–º–æ-—Ä–µ–∂–∏–º)
            if (!isDemo) {
                startTokenCheck();
            }

            // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–∞—Ç—É
            document.getElementById('workout-date').value = workoutDate;
            updateDateDisplay();

            // –û–±–Ω–æ–≤–ª—è–µ–º UI –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            updateUserUI();

            // –ó–∞–≥—Ä—É–∑–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
            await loadExercises();

            // –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–∞–Ω–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è
            await loadLastWorkoutData();

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
            showMainApp();

            // –°–∫—Ä—ã—Ç—å –∑–∞–≥—Ä—É–∑–∫—É
            document.getElementById('loading').classList.add('hidden');
        }


        /**
         * –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ –∫–∞–∂–¥–æ–º—É —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—é
         */
        async function loadLastWorkoutData() {
            try {
                const workouts = await API.getWorkouts();

                // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è–º, –±–µ—Ä—ë–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–∞–Ω–Ω—ã–µ
                workouts.forEach(w => {
                    if (!lastWorkoutData[w.exercise_id]) {
                        lastWorkoutData[w.exercise_id] = {
                            sets: []
                        };
                    }
                });

                // –î–ª—è –∫–∞–∂–¥–æ–≥–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è —Å–æ–±–∏—Ä–∞–µ–º –ø–æ–¥—Ö–æ–¥—ã –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
                const byExerciseAndDate = {};
                workouts.forEach(w => {
                    const key = w.exercise_id + '_' + w.date;
                    if (!byExerciseAndDate[key]) {
                        byExerciseAndDate[key] = {
                            exercise_id: w.exercise_id,
                            date: w.date,
                            sets: []
                        };
                    }
                    byExerciseAndDate[key].sets.push({
                        weight: w.weight,
                        reps: w.reps
                    });
                });

                // –ë–µ—Ä—ë–º –ø–æ—Å–ª–µ–¥–Ω—é—é —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
                Object.values(byExerciseAndDate).forEach(item => {
                    const existing = lastWorkoutData[item.exercise_id];
                    if (!existing || !existing.date || new Date(item.date) > new Date(existing.date)) {
                        lastWorkoutData[item.exercise_id] = {
                            date: item.date,
                            sets: item.sets.sort((a, b) => a.set_number - b.set_number)
                        };
                    }
                });
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏:', error);
            }
        }

        /**
         * –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–∞–Ω–Ω—ã–µ –ø–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—é
         */
        function getLastExerciseData(exerciseId) {
            const data = lastWorkoutData[exerciseId];
            if (data && data.sets && data.sets.length > 0) {
                return data.sets;
            }
            // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: 40 –∫–≥, 10 –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π
            return [
                { weight: 40, reps: 10 },
                { weight: 40, reps: 10 },
                { weight: 40, reps: 10 }
            ];
        }

        // ============================================
        // –ó–ê–ì–†–£–ó–ö–ê –î–ê–ù–ù–´–•
        // ============================================
        async function loadExercises() {
            try {
                exercises = await API.getExercises();
                renderExercisesList();
                populateStatsSelect();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π:', error);
                alert('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ.');
            }
        }

        // ============================================
        // –ù–ê–í–ò–ì–ê–¶–ò–Ø
        // ============================================
        function showPage(pageName) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));

            document.getElementById('page-' + pageName).classList.add('active');
            event.target.closest('.nav-btn').classList.add('active');

            window.scrollTo(0, 0);

            // –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            if (pageName === 'history') {
                loadHistory();
            } else if (pageName === 'stats') {
                loadStats();
            } else if (pageName === 'body') {
                loadBodyMetrics();
            }
        }

        // ============================================
        // –î–ê–¢–ê
        // ============================================
        function openDatePicker() {
            document.getElementById('workout-date').showPicker();
        }

        document.getElementById('workout-date').addEventListener('change', (e) => {
            workoutDate = e.target.value;
            updateDateDisplay();
        });

        function updateDateDisplay() {
            const date = new Date(workoutDate);
            const options = { weekday: 'long', day: 'numeric', month: 'long' };
            const formatted = date.toLocaleDateString('ru-RU', options);
            document.getElementById('workout-date-display').textContent = formatted.charAt(0).toUpperCase() + formatted.slice(1);

            // –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫
            const today = new Date().toISOString().split('T')[0];
            const yesterday = new Date(Date.now() - 86400000).toISOString().split('T')[0];

            if (workoutDate === today) {
                document.getElementById('header-date').textContent = '–°–µ–≥–æ–¥–Ω—è';
            } else if (workoutDate === yesterday) {
                document.getElementById('header-date').textContent = '–í—á–µ—Ä–∞';
            } else {
                document.getElementById('header-date').textContent = date.toLocaleDateString('ru-RU', { day: 'numeric', month: 'long' });
            }
        }

        // ============================================
        // –°–¢–†–ê–ù–ò–¶–ê –¢–†–ï–ù–ò–†–û–í–ö–ò
        // ============================================
        function showAddExerciseModal() {
            const modal = document.getElementById('add-exercise-modal');
            const list = document.getElementById('exercise-select-list');

            // –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
            const byCategory = {};
            exercises.forEach(ex => {
                if (!byCategory[ex.category]) {
                    byCategory[ex.category] = [];
                }
                byCategory[ex.category].push(ex);
            });

            // –û—Ç–¥–µ–ª—å–Ω–æ –±–∞–∑–æ–≤—ã–µ –∏ –∏–∑–æ–ª–∏—Ä—É—é—â–∏–µ
            const baseCategories = ['–ì—Ä—É–¥—å', '–°–ø–∏–Ω–∞', '–ü–ª–µ—á–∏', '–ù–æ–≥–∏'];

            let html = '<div class="section-title">–ë–∞–∑–æ–≤—ã–µ</div>';
            baseCategories.forEach(cat => {
                if (byCategory[cat]) {
                    html += `<div class="category-section">
                        <div class="category-title">${cat}</div>
                        <div class="exercises-grid">
                            ${byCategory[cat].filter(e => e.type === 'base').map(ex => `
                                <button class="exercise-tag" onclick="addExerciseToWorkout('${ex.id}')">
                                    <div class="exercise-tag-icon">${getExerciseIcon(ex.category)}</div>
                                    ${ex.name}
                                </button>
                            `).join('')}
                        </div>
                    </div>`;
                }
            });

            html += '<div class="section-title" style="margin-top: 24px;">–ò–∑–æ–ª–∏—Ä—É—é—â–∏–µ</div>';
            Object.entries(byCategory).forEach(([cat, exs]) => {
                const isolations = exs.filter(e => e.type === 'isolation' || e.type === 'custom');
                if (isolations.length > 0) {
                    html += `<div class="category-section">
                        <div class="category-title">${cat}</div>
                        <div class="exercises-grid">
                            ${isolations.map(ex => `
                                <button class="exercise-tag" onclick="addExerciseToWorkout('${ex.id}')">
                                    <div class="exercise-tag-icon">${getExerciseIcon(ex.category)}</div>
                                    ${ex.name}
                                </button>
                            `).join('')}
                        </div>
                    </div>`;
                }
            });

            list.innerHTML = html;
            modal.classList.remove('hidden');
        }

        function hideAddExerciseModal() {
            document.getElementById('add-exercise-modal').classList.add('hidden');
        }

        function getExerciseIcon(category) {
            const icons = {
                '–ì—Ä—É–¥—å': '<svg class="exercise-icon" viewBox="0 0 512 512" fill="currentColor"><path d="M328.9285,384.0338l-88.7768-19.4819a45.1112,45.1112,0,0,1-22.987-13.1816,45.1318,45.1318,0,0,1-22.9911,13.1816l-88.7685,19.4819A74.41,74.41,0,0,1,59.02,379.3844l10.5835,69.76A12.787,12.787,0,0,0,82.2459,460.013h38.8186a13.8146,13.8146,0,0,1,.2532-2.635c11.3056-54.6549,66.2153-62.9,68.5956-63.24a12.7481,12.7481,0,0,1,3.5714,25.2447c-1.7868.2553-37.8267,6.2054-46.58,40.63H287.408c-8.84-34.51-44.9653-40.375-46.58-40.63a12.7479,12.7479,0,0,1,3.5693-25.2447c2.3823.34,57.2069,8.5851,68.5956,63.24a14.5059,14.5059,0,0,1,.2552,2.635h38.8186a12.7869,12.7869,0,0,0,12.6421-10.8689l10.5648-69.6363a75.1639,75.1639,0,0,1-46.3453,4.526Z"/><path d="M456.8851,168.4729,445.77,157.3571a118.9832,118.9832,0,0,0-69.3779-33.9335l-65.709-8.2137A34.0008,34.0008,0,0,1,280.9,81.4719V64.7754A12.7881,12.7881,0,0,0,268.1128,51.987H166.1875A12.7881,12.7881,0,0,0,153.4,64.7754v16.697A34,34,0,0,1,123.617,115.21l-61.0315,7.6284A12.77,12.77,0,0,0,51.4,135.509l-.0125,199.267c0,5.3939,3.4967,12.5,7.77,15.7912l.1805.139a47.4215,47.4215,0,0,0,39.0988,8.7475l90.2751-19.8124a19.9909,19.9909,0,0,0,15.7051-19.5255V230.403A25.5145,25.5145,0,0,0,188.5851,206.79c-24.1075-9.94-62.1106-21.8134-106.0985-21.8134a12.75,12.75,0,1,1,0-25.5c48.0947,0,89.4741,12.8828,115.7129,23.6945a51.2519,51.2519,0,0,1,18.9652,13.5443,51.2285,51.2285,0,0,1,18.9611-13.5484c26.2387-10.8076,67.6181-23.69,115.7129-23.69a12.75,12.75,0,0,1,0,25.5c-43.9755,0-81.97,11.867-106.0778,21.8009a25.5235,25.5235,0,0,0-15.8441,23.6251v89.7231a19.9793,19.9793,0,0,0,15.6968,19.5152L334.39,359.1232a50.7429,50.7429,0,0,0,51.8716-19.6355A99.3146,99.3146,0,0,0,405.52,280.494V255.986a12.75,12.75,0,1,1,25.5,0v24.508a124.5529,124.5529,0,0,1-21.9161,70.6885,322.33,322.33,0,0,0,28.2724,36.4518,12.7458,12.7458,0,0,0,22.1777-8.4964l1.0583-201.5995A12.7314,12.7314,0,0,0,456.8851,168.4729Z"/></svg>',
                '–°–ø–∏–Ω–∞': '<svg class="exercise-icon" viewBox="0 0 512 512" fill="currentColor"><path d="M434.5,230.5H421.75V179.4792A16.98,16.98,0,0,0,404.7708,162.5H387.7272A16.9769,16.9769,0,0,0,370.75,179.4792V332.5228A16.9765,16.9765,0,0,0,387.7272,349.5h17.0436A16.98,16.98,0,0,0,421.75,332.5228V281.5H434.5a25.5,25.5,0,0,0,0-51Z"/><path d="M328.2147,145.5H311.2832A17.0353,17.0353,0,0,0,294.25,162.5353V230.5h-76.5V162.5353A17.0371,17.0371,0,0,0,200.7147,145.5H183.7832A17.0353,17.0353,0,0,0,166.75,162.5353V349.4668A17.0336,17.0336,0,0,0,183.7832,366.5h16.9315A17.0353,17.0353,0,0,0,217.75,349.4668V281.5h76.5v67.9668A17.0336,17.0336,0,0,0,311.2832,366.5h16.9315A17.0353,17.0353,0,0,0,345.25,349.4668V162.5353A17.0371,17.0371,0,0,0,328.2147,145.5Z"/><path d="M124.2708,162.5H107.2272A16.9769,16.9769,0,0,0,90.25,179.4792V230.5H77.5a25.5,25.5,0,0,0,0,51H90.25v51.0228A16.9765,16.9765,0,0,0,107.2272,349.5h17.0436A16.98,16.98,0,0,0,141.25,332.5228V179.4792A16.98,16.98,0,0,0,124.2708,162.5Z"/></svg>',
                '–ü–ª–µ—á–∏': '<svg class="exercise-icon" viewBox="0 0 512 512" fill="currentColor"><path d="M454.4343,245.3087l-12.8351-22.1849a29.5616,29.5616,0,0,0-25.7552-14.875H352.9448a33.9894,33.9894,0,0,0-34,34v68H232.4133a244.264,244.264,0,0,1-11.8992,26.69c-7.8185,14.8231-30.15,3.4908-22.7812-11.56a229.8355,229.8355,0,0,0,17.17-43.69c7.3248-26.6522,9.66-51.4157,7.2259-77.0945a84.0784,84.0784,0,0,0,31.0241-45.8151C277.8769,54.2383,132.6258,7.3,91.3992,107.1c-10.9145,29.7814,1.7243,59.92-15.4726,88.3987a226.89,226.89,0,0,0-16.1488,42.67c-9.1786,34.17-9.8592,67.2353-3.5693,94.095,4.4561,17.8753,3.9986,36.4371-2.3809,53.6349-11.773,43.2192,33.2626,85.8537,75.483,71.1437l201.8737-54.2287a76.0144,76.0144,0,0,0,27.54-17.5945l88.9948-88.9953A42.21,42.21,0,0,0,454.4343,245.3087Zm-326.5693,45.73a183.1658,183.1658,0,0,1-13.3456,35.36,12.7014,12.7014,0,0,1-11.3908,6.97c-9.2014.19-15.7362-10.2568-11.3884-18.445,13.8824-26.74,21.1407-67.2838,14.5341-93.585a12.8276,12.8276,0,0,1,9.5193-15.3C143.8742,200.3057,133.38,271.1115,127.865,291.0387Z"/></svg>',
                '–ù–æ–≥–∏': '<svg class="exercise-icon" viewBox="0 0 512 512" fill="currentColor"><path d="M428.5878,61.591A12.7583,12.7583,0,0,0,416.2238,52H95.7762a12.7583,12.7583,0,0,0-12.364,9.591C75.4746,92.4056,52,194.471,52,324c0,56.8142,9.8738,106.0248,14.572,126.22A12.67,12.67,0,0,0,78.9651,460H183.4865a12.7778,12.7778,0,0,0,12.0174-8.4808c16.9585-47.0053,30.0094-111.3607,44.3449-270.4042a65.0917,65.0917,0,0,1-27.625-15.0446l-41.3089-37.1455A12.7592,12.7592,0,1,1,188,109.97l41.3088,37.23c15.7259,14.11,37.6545,14.11,53.38,0l41.2258-37.23a12.8386,12.8386,0,0,1,18.0189.9348,12.6863,12.6863,0,0,1-.9338,18.02L299.7742,166.07a66.368,66.368,0,0,1-27.71,15.0446c14.3354,159.0466,27.461,223.4015,44.432,270.4068A12.7762,12.7762,0,0,0,328.5115,460H433.0349a12.67,12.67,0,0,0,12.3931-9.78C450.1262,430.0248,460,380.8142,460,324,460,194.471,436.5254,92.4056,428.5878,61.591ZM166.75,217.92a12.75,12.75,0,0,1,25.5,0c0,59.2447-37.5714,110.0751-75.9044,126.0551.5935,12.58,1.4443,25.2448,3.0588,38.3351a12.7874,12.7874,0,0,1-11.1355,14.1948,9.22,9.22,0,0,1-1.5294.0851,12.7572,12.7572,0,0,1-12.6649-11.22c-2.04-16.83-3.229-33.405-3.6544-49.385v-.68c-.0851-3.8251-.17-7.65-.17-11.3051a1075.4085,1075.4085,0,0,1,7.479-126.0546,12.752,12.752,0,1,1,25.33,2.9748,1076.2015,1076.2015,0,0,0-7.2237,114.835C142.2689,299.52,166.75,261.1,166.75,217.92ZM421.58,335.3051a2.1138,2.1138,0,0,1-.085.68c-.34,15.98-1.5315,32.5546-3.5694,49.385a12.8239,12.8239,0,0,1-12.667,11.22,9.2331,9.2331,0,0,1-1.5294-.0851A12.7267,12.7267,0,0,1,392.5956,382.31c1.5294-13.0053,2.4632-25.7553,2.9737-38.3351-38.25-15.98-75.8193-66.81-75.8193-126.0551a12.75,12.75,0,0,1,25.5,0c0,43.18,24.3939,81.6,50.83,97.835a1052.7953,1052.7953,0,0,0-7.1407-114.835,12.752,12.752,0,1,1,25.33-2.9748A1091.9083,1091.9083,0,0,1,421.75,324C421.75,327.74,421.6649,331.48,421.58,335.3051Z"/></svg>',
                '–†—É–∫–∏': '<svg class="exercise-icon" viewBox="0 0 512 512" fill="currentColor"><path d="M376.7809,287.8908a105.6316,105.6316,0,0,1,4.9307,9.7747,12.6156,12.6156,0,0,1-7.9916,17.085,12.8146,12.8146,0,0,1-15.4685-7.14c-26.3737-59.7889-108.8917-73.8287-153.2552-25.4984a92.6432,92.6432,0,0,0-24.8194,52.6135,12.8591,12.8591,0,0,1-12.667,11.4747,12.685,12.685,0,0,1-12.6649-14.0252,119.248,119.248,0,0,1,50.1513-83.47V193.2006h68a34,34,0,0,0,34-34V96.2159a29.84,29.84,0,0,0-14.875-25.7553l-22.186-12.8351A42.19,42.19,0,0,0,219.02,64.3409l-88.9947,88.9947a76.2219,76.2219,0,0,0-17.6807,27.54l-56.8645,153.34a55.2822,55.2822,0,0,0,33.5746,71.4c44.4548,15.47,125.375,34.085,183.9412,34.085,28.9116-1.9486,56.9309-13.2579,85.7636-3.7374a324.569,324.569,0,0,0,34.6807,7.1377l-4.59-13.8551a12.8111,12.8111,0,0,1,8.5544-16.3886c6.6538-2,13.6216,2.3474,15.8231,8.9373l12.7685,38.2213h21.2913a12.7087,12.7087,0,0,0,12.7087-12.7087V291.1383a12.7871,12.7871,0,0,0-13.3519-12.7047A342.1659,342.1659,0,0,0,376.7809,287.8908Zm-58.0556,75.5651a226.9552,226.9552,0,0,1-85.34,7.48c-16.5185-2.0669-14.0553-26.82,2.6355-25.33a203.5,203.5,0,0,0,75.6492-6.63C327.9018,334.6,334.8,358.5527,318.7253,363.4559Z"/></svg>',
                '–ò–∫—Ä—ã': '<svg class="exercise-icon" viewBox="0 0 512 512" fill="currentColor"><path d="M416.2248,52H95.7752a12.7569,12.7569,0,0,0-12.3627,9.59C75.4741,92.4029,52,194.4693,52,324c0,56.837,9.8826,106.0643,14.5779,126.2447A12.6391,12.6391,0,0,0,78.9415,460H183.5787a12.7271,12.7271,0,0,0,11.9837-8.4392c15.4111-42.8592,27.6428-100.1747,40.5489-230.5808l-53.38,8.16a70.6724,70.6724,0,0,1-10.2847.7647,68.1118,68.1118,0,0,1-57.0347-30.855l-11.83-18.1118c-3.8128-5.8376-2.9207-14.03,2.7821-18.0416a12.7678,12.7678,0,0,1,18.1431,3.4286l12.24,18.7852a42.6759,42.6759,0,0,0,42.0746,18.87l57.2048-8.84a8.5023,8.5023,0,0,0,7.2238-8.4149V137a12.75,12.75,0,0,1,25.5,0v49.7253a8.5042,8.5042,0,0,0,7.2258,8.4149l57.1317,8.8285A42.6368,42.6368,0,0,0,375.34,185.11l12.2416-18.7852A12.72,12.72,0,0,1,408.917,180.18l-12.2416,18.87a68.2222,68.2222,0,0,1-57.0347,30.855,69.8229,69.8229,0,0,1-10.2846-.7647l-53.4654-8.16c12.9078,130.4226,25.1428,187.7361,40.6252,230.597A12.728,12.728,0,0,0,328.4939,460H433.0585a12.6391,12.6391,0,0,0,12.3636-9.7553C450.1174,430.0643,460,380.837,460,324c0-129.5307-23.4741-231.5971-31.4125-262.41A12.7569,12.7569,0,0,0,416.2248,52ZM106.146,242.91a12.7955,12.7955,0,0,1,11.8992,13.5147C116.5157,279.0352,115.75,301.73,115.75,324c0,12.41.5956,25.33,1.6166,38.3351a12.7534,12.7534,0,0,1-11.646,13.77h-1.0189a12.826,12.826,0,0,1-12.75-11.6449C90.8456,350.69,90.25,337.09,90.25,324c0-22.865.7657-46.1549,2.2952-69.19A12.6589,12.6589,0,0,1,106.146,242.91ZM420.05,364.46a12.6851,12.6851,0,0,1-12.6649,11.6449h-1.104a11.8291,11.8291,0,0,1-11.7149-12.9637C395.7205,349.7759,396.25,336.5781,396.25,324c0-22.1849-.7637-44.88-2.208-67.5751A12.7372,12.7372,0,0,1,405.9412,242.91a12.5341,12.5341,0,0,1,13.5157,11.9c1.5294,23.2048,2.2931,46.4947,2.2931,69.19C421.75,337.0052,421.1565,350.605,420.05,364.46Z"/></svg>',
                '–ö–æ—Ä': '<svg class="exercise-icon" viewBox="0 0 512 512" fill="currentColor"><path d="M407.4467,192.263a89.8645,89.8645,0,0,1-18.9548-2.04L283.5181,167.1879a51.2726,51.2726,0,0,1-27.625-16.66,51.2871,51.2871,0,0,1-27.625,16.66L123.2923,190.2231a89.8645,89.8645,0,0,1-18.9548,2.04,87.59,87.59,0,0,1-34.5956-7.2253c13.26,65.11,29.58,115.43,32.7258,195.84a146.64,146.64,0,0,1-7.3109,51.7647l-3.5486,10.5814a12.7378,12.7378,0,0,0,12.0756,16.7889H408.1a12.7378,12.7378,0,0,0,12.0756-16.7889l-3.5486-10.5814a146.6373,146.6373,0,0,1-7.3109-51.7647c3.146-80.41,19.4653-130.73,32.7258-195.84A87.9024,87.9024,0,0,1,407.4467,192.263ZM166.7261,418.108a12.7852,12.7852,0,0,1-12.75,12.155,1.4428,1.4428,0,0,1-.5935-.0851,12.748,12.748,0,0,1-12.1565-13.3451l6.292-126.82a89.4334,89.4334,0,0,1,49.2154-75.395l28.0483-14.0252a12.7536,12.7536,0,1,1,11.4758,22.78l-28.05,14.0252a63.8136,63.8136,0,0,0-35.1891,53.89Zm138.3824-35.02H268.7261V426.013a12.75,12.75,0,1,1-25.5,0V383.0881H206.933a12.75,12.75,0,1,1,0-25.5h36.2931V318.9127H210.077a12.75,12.75,0,0,1,0-25.5h33.1491v-38.93a12.75,12.75,0,1,1,25.5,0v38.93h33.2364a12.75,12.75,0,0,1,0,25.5H268.7261v38.6754h36.3824a12.75,12.75,0,0,1,0,25.5Zm53.5483,47.09a1.8674,1.8674,0,0,1-.6807.0851,12.7661,12.7661,0,0,1-12.6628-12.155l-6.292-126.82a63.9831,63.9831,0,0,0-35.1891-53.89l-28.05-14.0252a12.7536,12.7536,0,1,1,11.4758-22.78L315.223,214.618a89.1037,89.1037,0,0,1,49.2153,75.395l6.2878,126.82A12.676,12.676,0,0,1,358.6568,430.1779Z"/><path d="M447.2593,51.987H268.6556v64.94l-.0125.1416A23.2156,23.2156,0,0,0,286.7949,141.78l107.1278,23.5037a62.1,62.1,0,0,0,57.0429-16.419L452.9,146.98a23.5589,23.5589,0,0,0,7.1117-16.8672V64.74A12.7524,12.7524,0,0,0,447.2593,51.987Z"/><path d="M119.5673,164.9093l105.4241-23.13a23.2154,23.2154,0,0,0,18.1517-24.7109l-.0124-.1416V51.987H64.7427A12.7541,12.7541,0,0,0,51.9886,64.74v66.4058a21.7787,21.7787,0,0,0,6.9042,15.91l1.8012,1.6856C74.546,161.6985,101.04,168.9746,119.5673,164.9093Z"/></svg>'
            };
            return icons[category] || icons['–°–ø–∏–Ω–∞'];
        }

        function addExerciseToWorkout(exerciseId) {
            const exercise = exercises.find(e => e.id === exerciseId);
            if (!exercise) return;

            // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å –ø—Ä–æ—à–ª–æ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
            const lastData = getLastExerciseData(exerciseId);

            // –î–æ–±–∞–≤–ª—è–µ–º —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ —Å 3 –ø–æ–¥—Ö–æ–¥–∞–º–∏ (–¥–∞–Ω–Ω—ã–µ –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏ –∏–ª–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
            const sets = [];
            for (let i = 0; i < 3; i++) {
                if (lastData[i]) {
                    sets.push({
                        weight: lastData[i].weight || 40,
                        reps: lastData[i].reps || 10
                    });
                } else {
                    // –ï—Å–ª–∏ –≤ –∏—Å—Ç–æ—Ä–∏–∏ –º–µ–Ω—å—à–µ 3 –ø–æ–¥—Ö–æ–¥–æ–≤, –±–µ—Ä—ë–º –ø–æ—Å–ª–µ–¥–Ω–∏–π –∏–∑–≤–µ—Å—Ç–Ω—ã–π –∏–ª–∏ –¥–µ—Ñ–æ–ª—Ç
                    const lastKnown = lastData[lastData.length - 1] || { weight: 40, reps: 10 };
                    sets.push({
                        weight: lastKnown.weight || 40,
                        reps: lastKnown.reps || 10
                    });
                }
            }

            currentWorkout.push({
                exercise: exercise,
                sets: sets
            });

            renderCurrentWorkout();
            hideAddExerciseModal();
        }

        function renderCurrentWorkout() {
            const container = document.getElementById('exercises-container');

            if (currentWorkout.length === 0) {
                container.innerHTML = '<div class="empty-state">–î–æ–±–∞–≤—å—Ç–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É</div>';
                document.getElementById('save-workout-btn').style.display = 'none';
                return;
            }

            document.getElementById('save-workout-btn').style.display = 'flex';

            container.innerHTML = currentWorkout.map((item, exIndex) => `
                <div class="exercise-card">
                    <div class="exercise-card-header">
                        <div class="exercise-icon">${getExerciseIcon(item.exercise.category)}</div>
                        <div class="exercise-info">
                            <div class="exercise-name">${item.exercise.name}</div>
                            <div class="exercise-category">${item.exercise.category}</div>
                        </div>
                        <button class="btn-icon danger" onclick="removeExercise(${exIndex})">√ó</button>
                    </div>
                    <div class="exercise-card-body">
                        <div class="sets-header">
                            <span></span>
                            <span>–í–µ—Å</span>
                            <span>–ü–æ–≤—Ç–æ—Ä—ã</span>
                            <span></span>
                        </div>
                        ${item.sets.map((set, setIndex) => `
                            <div class="set-row">
                                <span class="set-num">${setIndex + 1}</span>
                                <input type="number" class="set-input" placeholder="–∫–≥" value="${set.weight}"
                                    onchange="updateSet(${exIndex}, ${setIndex}, 'weight', this.value)">
                                <input type="number" class="set-input" placeholder="0" value="${set.reps}"
                                    onchange="updateSet(${exIndex}, ${setIndex}, 'reps', this.value)">
                                <button class="btn-icon danger" style="width:32px;height:32px;"
                                    onclick="removeSet(${exIndex}, ${setIndex})" ${item.sets.length === 1 ? 'disabled' : ''}>√ó</button>
                            </div>
                        `).join('')}
                        <button class="add-set-btn" onclick="addSet(${exIndex})">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"/>
                                <line x1="5" y1="12" x2="19" y2="12"/>
                            </svg>
                            –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Ö–æ–¥
                        </button>
                        <button class="timer-btn" onclick="startTimer()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M12 6v6l4 2"/>
                            </svg>
                            –¢–∞–π–º–µ—Ä –æ—Ç–¥—ã—Ö–∞ ¬∑ 2:00
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function updateSet(exIndex, setIndex, field, value) {
            currentWorkout[exIndex].sets[setIndex][field] = value;
        }

        function addSet(exIndex) {
            currentWorkout[exIndex].sets.push({ weight: '', reps: '' });
            renderCurrentWorkout();
        }

        function removeSet(exIndex, setIndex) {
            if (currentWorkout[exIndex].sets.length > 1) {
                currentWorkout[exIndex].sets.splice(setIndex, 1);
                renderCurrentWorkout();
            }
        }

        function removeExercise(exIndex) {
            currentWorkout.splice(exIndex, 1);
            renderCurrentWorkout();
        }

        function showConfirmModal() {
            // –°–æ–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            let totalSets = 0;
            let totalReps = 0;
            let totalVolume = 0;
            let exercisesHtml = '';

            currentWorkout.forEach(item => {
                let exSets = 0;
                let exReps = 0;
                let exVolume = 0;
                let setsDetails = [];

                item.sets.forEach(set => {
                    const weight = parseFloat(set.weight) || 0;
                    const reps = parseInt(set.reps) || 0;

                    if (weight > 0 || reps > 0) {
                        exSets++;
                        exReps += reps;
                        exVolume += weight * reps;
                        setsDetails.push(`${weight}–∫–≥ √ó ${reps}`);
                    }
                });

                if (exSets > 0) {
                    totalSets += exSets;
                    totalReps += exReps;
                    totalVolume += exVolume;

                    exercisesHtml += `
                        <div class="confirm-exercise">
                            <div class="confirm-exercise-header">
                                <span class="confirm-exercise-icon">${getExerciseIcon(item.exercise.category)}</span>
                                <span class="confirm-exercise-name">${item.exercise.name}</span>
                            </div>
                            <div class="confirm-exercise-sets">${setsDetails.join(' ¬∑ ')}</div>
                        </div>
                    `;
                }
            });

            if (totalSets === 0) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø–æ–¥—Ö–æ–¥');
                return;
            }

            const modalBody = document.getElementById('confirm-modal-body');
            modalBody.innerHTML = `
                <div class="confirm-stats">
                    <div class="confirm-stat">
                        <div class="confirm-stat-value">${currentWorkout.length}</div>
                        <div class="confirm-stat-label">—É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π</div>
                    </div>
                    <div class="confirm-stat">
                        <div class="confirm-stat-value">${totalSets}</div>
                        <div class="confirm-stat-label">–ø–æ–¥—Ö–æ–¥–æ–≤</div>
                    </div>
                    <div class="confirm-stat">
                        <div class="confirm-stat-value">${totalReps}</div>
                        <div class="confirm-stat-label">–ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π</div>
                    </div>
                    <div class="confirm-stat">
                        <div class="confirm-stat-value">${(totalVolume / 1000).toFixed(1)}—Ç</div>
                        <div class="confirm-stat-label">–æ–±—ä—ë–º</div>
                    </div>
                </div>
                <div class="confirm-exercises-list">
                    ${exercisesHtml}
                </div>
            `;

            document.getElementById('confirm-modal').classList.remove('hidden');
        }

        function hideConfirmModal() {
            document.getElementById('confirm-modal').classList.add('hidden');
        }

        async function confirmSaveWorkout() {
            hideConfirmModal();
            await saveWorkout();
        }

        async function saveWorkout() {
            // –ë–ª–æ–∫–∏—Ä—É–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –¥–µ–º–æ-—Ä–µ–∂–∏–º–µ
            if (isDemo) {
                showDemoSaveModal();
                return;
            }

            // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –ø–æ–¥—Ö–æ–¥—ã
            const workouts = [];

            currentWorkout.forEach(item => {
                item.sets.forEach((set, index) => {
                    const weight = parseFloat(set.weight) || 0;
                    const reps = parseInt(set.reps) || 0;

                    if (weight > 0 || reps > 0) {
                        workouts.push({
                            date: workoutDate,
                            exercise_id: item.exercise.id,
                            exercise_name: item.exercise.name,
                            set_number: index + 1,
                            weight: weight,
                            reps: reps
                        });
                    }
                });
            });

            if (workouts.length === 0) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø–æ–¥—Ö–æ–¥');
                return;
            }

            try {
                document.getElementById('loading').classList.remove('hidden');
                await API.addWorkouts(workouts);

                alert('–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!');
                currentWorkout = [];
                renderCurrentWorkout();
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + error.message);
            } finally {
                document.getElementById('loading').classList.add('hidden');
            }
        }

        // ============================================
        // –¢–ê–ô–ú–ï–†
        // ============================================
        let timerSeconds = 120;
        let timerInterval = null;
        let timerTotal = 120;

        function startTimer(seconds = 120) {
            timerSeconds = seconds;
            timerTotal = seconds;
            document.getElementById('timer-modal').classList.remove('hidden');
            updateTimerDisplay();

            timerInterval = setInterval(() => {
                timerSeconds--;
                updateTimerDisplay();

                if (timerSeconds <= 0) {
                    stopTimer();
                    if (navigator.vibrate) navigator.vibrate([200, 100, 200]);
                    playBeep();
                }
            }, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
            document.getElementById('timer-modal').classList.add('hidden');
        }

        function addTimerTime(seconds) {
            timerSeconds += seconds;
            timerTotal += seconds;
            updateTimerDisplay();
        }

        function updateTimerDisplay() {
            const mins = Math.floor(timerSeconds / 60);
            const secs = timerSeconds % 60;
            document.getElementById('timer-display').textContent =
                mins.toString().padStart(2, '0') + ':' + secs.toString().padStart(2, '0');

            // –û–±–Ω–æ–≤–∏—Ç—å –∫—Ä—É–≥–æ–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å
            const progress = document.getElementById('timer-progress');
            const circumference = 2 * Math.PI * 90;
            const offset = circumference - (timerSeconds / timerTotal) * circumference;
            progress.style.strokeDasharray = circumference;
            progress.style.strokeDashoffset = offset;
        }

        function playBeep() {
            const ctx = new (window.AudioContext || window.webkitAudioContext)();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.connect(gain);
            gain.connect(ctx.destination);
            osc.frequency.value = 800;
            gain.gain.value = 0.3;
            osc.start();
            setTimeout(() => osc.stop(), 200);
        }

        // ============================================
        // –ò–°–¢–û–†–ò–Ø
        // ============================================
        async function loadHistory() {
            const container = document.getElementById('history-container');

            try {
                // –í –¥–µ–º–æ-—Ä–µ–∂–∏–º–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ
                const workouts = isDemo ? DEMO_WORKOUTS : await API.getWorkouts();

                if (workouts.length === 0) {
                    container.innerHTML = '<div class="empty-state">–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π</div>';
                    return;
                }

                // –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ –∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—é
                const grouped = {};
                workouts.forEach(w => {
                    const dateKey = w.date;
                    if (!grouped[dateKey]) {
                        grouped[dateKey] = {};
                    }
                    if (!grouped[dateKey][w.exercise_id]) {
                        grouped[dateKey][w.exercise_id] = {
                            name: w.exercise_name,
                            sets: []
                        };
                    }
                    grouped[dateKey][w.exercise_id].sets.push({
                        weight: w.weight,
                        reps: w.reps
                    });
                });

                // –†–µ–Ω–¥–µ—Ä
                let html = '';
                const dates = Object.keys(grouped).sort((a, b) => new Date(b) - new Date(a));

                dates.forEach(dateKey => {
                    const date = new Date(dateKey);
                    const today = new Date().toISOString().split('T')[0];
                    const yesterday = new Date(Date.now() - 86400000).toISOString().split('T')[0];

                    let dateLabel;
                    if (dateKey === today) {
                        dateLabel = '–°–µ–≥–æ–¥–Ω—è';
                    } else if (dateKey === yesterday) {
                        dateLabel = '–í—á–µ—Ä–∞';
                    } else {
                        dateLabel = date.toLocaleDateString('ru-RU', { day: 'numeric', month: 'long' });
                    }

                    html += `<div class="history-group">
                        <div class="history-date">${dateLabel}</div>`;

                    Object.values(grouped[dateKey]).forEach(ex => {
                        const exerciseData = exercises.find(e => e.name === ex.name);
                        const icon = exerciseData ? getExerciseIcon(exerciseData.category) : 'üèãÔ∏è';

                        html += `
                            <div class="history-card">
                                <div class="history-icon">${icon}</div>
                                <div class="history-info">
                                    <div class="history-exercise">${ex.name}</div>
                                    <div class="history-details">${ex.sets.length} –ø–æ–¥—Ö–æ–¥–æ–≤</div>
                                    <div class="history-sets">
                                        ${ex.sets.map(s => `<span class="history-set">${s.weight}–∫–≥ √ó ${s.reps}</span>`).join('')}
                                    </div>
                                </div>
                            </div>
                        `;
                    });

                    html += '</div>';
                });

                container.innerHTML = html;
            } catch (error) {
                container.innerHTML = '<div class="empty-state">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>';
            }
        }

        // ============================================
        // –°–¢–ê–¢–ò–°–¢–ò–ö–ê
        // ============================================
        let muscleGroupChart = null;
        let currentMuscleGroup = '–ì—Ä—É–¥—å';
        let currentWorkoutsData = [];

        function populateStatsSelect() {
            const select = document.getElementById('stats-exercise-select');
            select.innerHTML = '<option value="">–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</option>';

            exercises.forEach(ex => {
                const option = document.createElement('option');
                option.value = ex.id;
                option.textContent = ex.name;
                select.appendChild(option);
            });
        }

        async function loadStats() {
            const select = document.getElementById('stats-exercise-select');
            const exerciseId = select.value;

            if (!exerciseId) {
                document.getElementById('stats-container').style.display = 'none';
                document.getElementById('stats-overview').style.display = 'block';
                await loadMonthlyOverview();
                return;
            }

            document.getElementById('stats-overview').style.display = 'none';

            try {
                const stats = await API.getStats(exerciseId);

                document.getElementById('stat-max-weight').textContent = stats.maxWeight + ' –∫–≥';
                document.getElementById('stat-total-sets').textContent = stats.totalSets;
                document.getElementById('stat-total-reps').textContent = stats.totalReps;

                if (stats.lastWorkout) {
                    const date = new Date(stats.lastWorkout.date);
                    document.getElementById('stat-last-date').textContent =
                        date.toLocaleDateString('ru-RU', { day: 'numeric', month: 'short' });
                } else {
                    document.getElementById('stat-last-date').textContent = '‚Äî';
                }

                // –ì—Ä–∞—Ñ–∏–∫
                renderWeightChart(stats.workouts);

                document.getElementById('stats-container').style.display = 'block';
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
            }
        }

        async function loadMonthlyOverview() {
            try {
                // –í –¥–µ–º–æ-—Ä–µ–∂–∏–º–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ
                const workouts = isDemo ? DEMO_WORKOUTS : await API.getWorkouts();

                const now = new Date();
                const thirtyDaysAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
                const sixtyDaysAgo = new Date(now.getTime() - 60 * 24 * 60 * 60 * 1000);

                // –§–∏–ª—å—Ç—Ä—É–µ–º –ø–æ –ø–µ—Ä–∏–æ–¥–∞–º
                const currentMonth = workouts.filter(w => new Date(w.date) >= thirtyDaysAgo);
                const prevMonth = workouts.filter(w => {
                    const d = new Date(w.date);
                    return d >= sixtyDaysAgo && d < thirtyDaysAgo;
                });

                // –°—á–∏—Ç–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü
                const workoutDays = new Set(currentMonth.map(w => w.date));
                const uniqueExercises = new Set(currentMonth.map(w => w.exercise_id));
                const totalVolume = currentMonth.reduce((sum, w) => sum + (parseFloat(w.weight) || 0) * (parseInt(w.reps) || 0), 0);
                const totalSets = currentMonth.length;

                // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏
                document.getElementById('overview-workouts').textContent = workoutDays.size;
                document.getElementById('overview-volume').textContent = (totalVolume / 1000).toFixed(1) + '—Ç';
                document.getElementById('overview-exercises').textContent = uniqueExercises.size;
                document.getElementById('overview-sets').textContent = totalSets;

                // –°—á–∏—Ç–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–∞ –ø—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
                const prevWorkoutDays = new Set(prevMonth.map(w => w.date));
                const prevVolume = prevMonth.reduce((sum, w) => sum + (parseFloat(w.weight) || 0) * (parseInt(w.reps) || 0), 0);
                const prevSets = prevMonth.length;

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –µ—Å–ª–∏ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –∑–∞ –ø—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü
                if (prevMonth.length > 0) {
                    const progressItems = document.getElementById('progress-items');
                    const comparisons = [
                        {
                            label: '–¢—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫',
                            current: workoutDays.size,
                            prev: prevWorkoutDays.size
                        },
                        {
                            label: '–û–±—ä—ë–º (–∫–≥)',
                            current: Math.round(totalVolume),
                            prev: Math.round(prevVolume)
                        },
                        {
                            label: '–ü–æ–¥—Ö–æ–¥–æ–≤',
                            current: totalSets,
                            prev: prevSets
                        }
                    ];

                    progressItems.innerHTML = comparisons.map(c => {
                        const diff = c.prev > 0 ? Math.round((c.current - c.prev) / c.prev * 100) : (c.current > 0 ? 100 : 0);
                        const isPositive = diff >= 0;
                        return `
                            <div class="progress-item">
                                <div class="progress-item-label">${c.label}</div>
                                <div class="progress-item-values">
                                    <span class="progress-item-current">${c.current}</span>
                                    <span class="progress-item-diff ${isPositive ? 'positive' : 'negative'}">
                                        ${isPositive ? '‚Üë' : '‚Üì'} ${Math.abs(diff)}%
                                    </span>
                                </div>
                            </div>
                        `;
                    }).join('');

                    document.getElementById('progress-comparison').style.display = 'block';
                }

                // –¢–æ–ø —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π
                renderTopExercises(currentMonth);

                // –ì—Ä–∞—Ñ–∏–∫ –ø–æ –≥—Ä—É–ø–ø–∞–º –º—ã—à—Ü
                currentWorkoutsData = currentMonth;
                renderMuscleGroupChart(currentMuscleGroup);

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ–±–∑–æ—Ä–∞:', error);
            }
        }

        function switchMuscleTab(muscleGroup) {
            currentMuscleGroup = muscleGroup;

            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —Ç–∞–±
            document.querySelectorAll('.muscle-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.muscle === muscleGroup);
            });

            // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –≥—Ä–∞—Ñ–∏–∫
            renderMuscleGroupChart(muscleGroup);
        }

        function renderTopExercises(workouts) {
            const container = document.getElementById('top-exercises-list');

            // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è–º
            const byExercise = {};
            workouts.forEach(w => {
                if (!byExercise[w.exercise_id]) {
                    byExercise[w.exercise_id] = {
                        name: w.exercise_name,
                        sets: 0,
                        volume: 0,
                        maxWeight: 0
                    };
                }
                byExercise[w.exercise_id].sets++;
                byExercise[w.exercise_id].volume += (parseFloat(w.weight) || 0) * (parseInt(w.reps) || 0);
                byExercise[w.exercise_id].maxWeight = Math.max(byExercise[w.exercise_id].maxWeight, parseFloat(w.weight) || 0);
            });

            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –æ–±—ä—ë–º—É –∏ –±–µ—Ä—ë–º —Ç–æ–ø-5
            const sorted = Object.entries(byExercise)
                .sort((a, b) => b[1].volume - a[1].volume)
                .slice(0, 5);

            if (sorted.length === 0) {
                container.innerHTML = '<div class="empty-state" style="padding: 20px;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∑–∞ —ç—Ç–æ—Ç –ø–µ—Ä–∏–æ–¥</div>';
                return;
            }

            const maxVolume = sorted[0][1].volume;

            container.innerHTML = sorted.map(([id, data], index) => {
                const exercise = exercises.find(e => e.id === id);
                const icon = exercise ? getExerciseIcon(exercise.category) : 'üèãÔ∏è';
                const percentage = (data.volume / maxVolume * 100).toFixed(0);

                return `
                    <div class="top-exercise-item">
                        <div class="top-exercise-rank">${index + 1}</div>
                        <div class="top-exercise-icon">${icon}</div>
                        <div class="top-exercise-info">
                            <div class="top-exercise-name">${data.name}</div>
                            <div class="top-exercise-stats">${data.sets} –ø–æ–¥—Ö–æ–¥–æ–≤ ¬∑ –º–∞–∫—Å. ${data.maxWeight} –∫–≥</div>
                            <div class="top-exercise-bar">
                                <div class="top-exercise-bar-fill" style="width: ${percentage}%"></div>
                            </div>
                        </div>
                        <div class="top-exercise-volume">${(data.volume / 1000).toFixed(1)}—Ç</div>
                    </div>
                `;
            }).join('');
        }

        function renderMuscleGroupChart(muscleGroup) {
            const colors = {
                '–ì—Ä—É–¥—å': '#FF6B35',
                '–°–ø–∏–Ω–∞': '#4CAF50',
                '–ü–ª–µ—á–∏': '#2196F3',
                '–ù–æ–≥–∏': '#9C27B0'
            };

            const ctx = document.getElementById('muscle-group-chart');
            if (!ctx) return;

            if (muscleGroupChart) {
                muscleGroupChart.destroy();
            }

            const color = colors[muscleGroup] || '#FF6B35';

            // –§–∏–ª—å—Ç—Ä—É–µ–º —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –ø–æ –≥—Ä—É–ø–ø–µ –º—ã—à—Ü
            const groupExerciseIds = exercises
                .filter(e => e.category === muscleGroup)
                .map(e => e.id);

            const groupWorkouts = currentWorkoutsData.filter(w => groupExerciseIds.includes(w.exercise_id));

            // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ –∏ —Å—á–∏—Ç–∞–µ–º —Ç–æ–Ω–Ω–∞–∂
            const byDate = {};
            groupWorkouts.forEach(w => {
                const date = w.date;
                if (!byDate[date]) {
                    byDate[date] = 0;
                }
                byDate[date] += (parseFloat(w.weight) || 0) * (parseInt(w.reps) || 0);
            });

            const sortedDates = Object.keys(byDate).sort();
            const labels = sortedDates.map(d =>
                new Date(d).toLocaleDateString('ru-RU', { day: 'numeric', month: 'short' })
            );
            const data = sortedDates.map(d => byDate[d] / 1000); // –≤ —Ç–æ–Ω–Ω–∞—Ö

            if (data.length === 0) {
                muscleGroupChart = new Chart(ctx.getContext('2d'), {
                    type: 'line',
                    data: { labels: ['–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'], datasets: [{ data: [0], borderColor: color }] },
                    options: {
                        responsive: true,
                        plugins: { legend: { display: false } }
                    }
                });
                return;
            }

            muscleGroupChart = new Chart(ctx.getContext('2d'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '–¢–æ–Ω–Ω–∞–∂',
                        data: data,
                        borderColor: color,
                        backgroundColor: color + '20',
                        tension: 0.3,
                        fill: true,
                        pointRadius: 4,
                        pointBackgroundColor: color
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: {
                            display: true,
                            ticks: {
                                maxRotation: 45,
                                minRotation: 45,
                                font: { size: 10 }
                            }
                        },
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: value => parseFloat(value).toFixed(1) + '—Ç'
                            }
                        }
                    }
                }
            });
        }

        function renderWeightChart(workouts) {
            const ctx = document.getElementById('weight-chart').getContext('2d');

            if (weightChart) {
                weightChart.destroy();
            }

            // –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ (–º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –≤–µ—Å –∑–∞ –¥–µ–Ω—å)
            const byDate = {};
            workouts.forEach(w => {
                const date = w.date;
                if (!byDate[date] || w.weight > byDate[date]) {
                    byDate[date] = parseFloat(w.weight) || 0;
                }
            });

            const labels = Object.keys(byDate).map(d =>
                new Date(d).toLocaleDateString('ru-RU', { day: 'numeric', month: 'short' })
            );
            const data = Object.values(byDate);

            weightChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '–í–µ—Å (–∫–≥)',
                        data: data,
                        borderColor: '#FF6B35',
                        backgroundColor: 'rgba(255, 107, 53, 0.1)',
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: { beginAtZero: false }
                    }
                }
            });
        }

        // ============================================
        // –°–¢–†–ê–ù–ò–¶–ê –£–ü–†–ê–ñ–ù–ï–ù–ò–ô
        // ============================================
        function renderExercisesList() {
            const container = document.getElementById('exercises-list-container');

            // –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞
            const byCategory = {};
            exercises.forEach(ex => {
                if (!byCategory[ex.category]) {
                    byCategory[ex.category] = [];
                }
                byCategory[ex.category].push(ex);
            });

            const baseCategories = ['–ì—Ä—É–¥—å', '–°–ø–∏–Ω–∞', '–ü–ª–µ—á–∏', '–ù–æ–≥–∏'];

            let html = '<div class="section-title">–ë–∞–∑–æ–≤—ã–µ</div>';
            baseCategories.forEach(cat => {
                if (byCategory[cat]) {
                    const baseExs = byCategory[cat].filter(e => e.type === 'base');
                    if (baseExs.length > 0) {
                        html += `<div class="category-section">
                            <div class="category-title">${cat}</div>
                            <div class="exercises-grid">
                                ${baseExs.map(ex => `
                                    <div class="exercise-tag">
                                        <div class="exercise-tag-icon">${getExerciseIcon(cat)}</div>
                                        ${ex.name}
                                    </div>
                                `).join('')}
                            </div>
                        </div>`;
                    }
                }
            });

            html += '<div class="section-title" style="margin-top: 24px;">–ò–∑–æ–ª–∏—Ä—É—é—â–∏–µ</div>';
            Object.entries(byCategory).forEach(([cat, exs]) => {
                const isolations = exs.filter(e => e.type === 'isolation' || e.type === 'custom');
                if (isolations.length > 0) {
                    html += `<div class="category-section">
                        <div class="category-title">${cat}</div>
                        <div class="exercises-grid">
                            ${isolations.map(ex => `
                                <div class="exercise-tag">
                                    <div class="exercise-tag-icon">${getExerciseIcon(cat)}</div>
                                    ${ex.name}
                                </div>
                            `).join('')}
                        </div>
                    </div>`;
                }
            });

            container.innerHTML = html;
        }

        // ============================================
        // –ü–ê–†–ê–ú–ï–¢–†–´ –¢–ï–õ–ê
        // ============================================

        /**
         * –†–∞—Å—á–µ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç–∞ –∂–∏—Ä–∞ –ø–æ —Ñ–æ—Ä–º—É–ª–µ –í–ú–° –°–®–ê (–¥–ª—è –º—É–∂—á–∏–Ω)
         * % –∂–∏—Ä–∞ = 495 / (1.0324 - 0.19077 * log10(—Ç–∞–ª–∏—è - —à–µ—è) + 0.15456 * log10(—Ä–æ—Å—Ç)) - 450
         */
        function calculateBodyFat(height, neck, waist) {
            if (!height || !neck || !waist || waist <= neck) return null;

            const logWaistNeck = Math.log10(waist - neck);
            const logHeight = Math.log10(height);

            const bodyFat = 495 / (1.0324 - 0.19077 * logWaistNeck + 0.15456 * logHeight) - 450;

            return Math.max(0, Math.min(50, bodyFat)).toFixed(1); // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º 0-50%
        }

        /**
         * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ % –∂–∏—Ä–∞ –ø—Ä–∏ –≤–≤–æ–¥–µ
         */
        function updateBodyFatPreview() {
            const height = parseFloat(document.getElementById('input-height').value);
            const neck = parseFloat(document.getElementById('input-neck').value);
            const waist = parseFloat(document.getElementById('input-waist').value);

            const preview = document.getElementById('body-fat-preview');
            const valueEl = document.getElementById('body-fat-value');

            if (height && neck && waist && waist > neck) {
                const bodyFat = calculateBodyFat(height, neck, waist);
                valueEl.textContent = bodyFat + '%';
                preview.style.display = 'block';
            } else {
                preview.style.display = 'none';
            }
        }

        /**
         * –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–µ–º–æ-–¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ç–µ–ª–∞
         */
        let DEMO_BODY_METRICS = [];

        function generateDemoBodyMetrics() {
            const metrics = [];
            const today = new Date();

            // –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ –∫–æ–ª–µ–±–∞–Ω–∏—è –≤–µ—Å–∞ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (—Ä–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è)
            // –ë–∞–∑–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è: –≤–µ—Å ~78–∫–≥, —Ç–∞–ª–∏—è ~86—Å–º, —à–µ—è ~37—Å–º
            const baseWeight = 78;
            const baseWaist = 86;
            const baseNeck = 37;

            // –ü–∞—Ç—Ç–µ—Ä–Ω —Å –∫–æ–ª–µ–±–∞–Ω–∏—è–º–∏: –Ω–∞–±–æ—Ä –≤–µ—Å–∞ —Å –æ—Ç–∫–∞—Ç–∞–º–∏, % –∂–∏—Ä–∞ —Å ~17.9% –¥–æ ~16.4%
            const weightVariations = [0, 0.5, 0.2, 0.8, 0.5, 1.3, 0.9, 1.5, 1.8];
            const waistVariations = [0, -0.3, 0.1, -0.5, -0.2, -0.7, -0.4, -1.0, -1.2];
            const neckVariations = [0, 0.2, 0.1, 0.4, 0.3, 0.6, 0.5, 0.7, 0.8];

            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 8 –Ω–µ–¥–µ–ª—å
            for (let i = 8; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i * 7);

                const idx = 8 - i;
                const height = 178;
                const weight = (baseWeight + weightVariations[idx]).toFixed(1);
                const neck = (baseNeck + neckVariations[idx]).toFixed(1);
                const waist = (baseWaist + waistVariations[idx]).toFixed(1);

                // –†–∞—Å—á–µ—Ç % –∂–∏—Ä–∞ –ø–æ —Ñ–æ—Ä–º—É–ª–µ –í–ú–° –°–®–ê
                const bodyFat = calculateBodyFat(height, parseFloat(neck), parseFloat(waist));

                metrics.push({
                    id: 'bm_demo_' + i,
                    date: date.toISOString().split('T')[0],
                    height: height,
                    weight: parseFloat(weight),
                    neck: parseFloat(neck),
                    waist: parseFloat(waist),
                    body_fat_percent: bodyFat
                });
            }

            return metrics;
        }

        /**
         * –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö —Ç–µ–ª–∞
         */
        async function loadBodyMetrics() {
            try {
                if (isDemo) {
                    if (DEMO_BODY_METRICS.length === 0) {
                        DEMO_BODY_METRICS = generateDemoBodyMetrics();
                    }
                    bodyMetrics = DEMO_BODY_METRICS;
                } else {
                    bodyMetrics = await API.getBodyMetrics();
                }

                renderBodyMetrics();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ç–µ–ª–∞:', error);
            }
        }

        /**
         * –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ç–µ–ª–∞
         */
        function renderBodyMetrics() {
            const currentMetrics = document.getElementById('current-body-metrics');
            const bodyCharts = document.getElementById('body-charts');
            const metricsHistory = document.getElementById('body-metrics-history');

            if (bodyMetrics.length === 0) {
                currentMetrics.style.display = 'none';
                bodyCharts.style.display = 'none';
                metricsHistory.style.display = 'none';
                return;
            }

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏–∏
            currentMetrics.style.display = 'block';
            bodyCharts.style.display = 'block';
            metricsHistory.style.display = 'block';

            // –¢–µ–∫—É—â–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ (–ø–æ—Å–ª–µ–¥–Ω–µ–µ –∏–∑–º–µ—Ä–µ–Ω–∏–µ)
            const latest = bodyMetrics[0];
            document.getElementById('current-weight-val').textContent = latest.weight + ' –∫–≥';
            document.getElementById('current-body-fat').textContent = latest.body_fat_percent + '%';
            document.getElementById('current-waist').textContent = latest.waist + ' —Å–º';

            // –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤–µ—Å–∞ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü
            const monthAgo = new Date();
            monthAgo.setMonth(monthAgo.getMonth() - 1);
            const oldMetric = bodyMetrics.find(m => new Date(m.date) <= monthAgo);

            if (oldMetric) {
                const change = (latest.weight - oldMetric.weight).toFixed(1);
                const changeText = change > 0 ? '+' + change : change;
                document.getElementById('weight-change').textContent = changeText + ' –∫–≥';
            } else if (bodyMetrics.length > 1) {
                const oldest = bodyMetrics[bodyMetrics.length - 1];
                const change = (latest.weight - oldest.weight).toFixed(1);
                const changeText = change > 0 ? '+' + change : change;
                document.getElementById('weight-change').textContent = changeText + ' –∫–≥';
            }

            // –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ä–æ—Å—Ç–∞ –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏–∑–º–µ—Ä–µ–Ω–∏—è
            if (latest.height && !document.getElementById('input-height').value) {
                document.getElementById('input-height').value = latest.height;
            }

            // –ì—Ä–∞—Ñ–∏–∫–∏
            renderWeightBodyChart();
            renderBodyFatChart();

            // –ò—Å—Ç–æ—Ä–∏—è
            renderBodyMetricsHistory();
        }

        /**
         * –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –≥—Ä–∞—Ñ–∏–∫–∞ –≤–µ—Å–∞ —Ç–µ–ª–∞
         */
        function renderWeightBodyChart() {
            const ctx = document.getElementById('weight-body-chart').getContext('2d');

            if (weightBodyChart) {
                weightBodyChart.destroy();
            }

            const sortedMetrics = [...bodyMetrics].sort((a, b) => new Date(a.date) - new Date(b.date));

            const labels = sortedMetrics.map(m =>
                new Date(m.date).toLocaleDateString('ru-RU', { day: 'numeric', month: 'short' })
            );
            const data = sortedMetrics.map(m => parseFloat(m.weight));

            weightBodyChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '–í–µ—Å (–∫–≥)',
                        data: data,
                        borderColor: '#FF6B35',
                        backgroundColor: 'rgba(255, 107, 53, 0.1)',
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            ticks: {
                                callback: value => parseFloat(value).toFixed(1) + ' –∫–≥'
                            }
                        }
                    }
                }
            });
        }

        /**
         * –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –≥—Ä–∞—Ñ–∏–∫–∞ % –∂–∏—Ä–∞
         */
        function renderBodyFatChart() {
            const ctx = document.getElementById('body-fat-chart').getContext('2d');

            if (bodyFatChart) {
                bodyFatChart.destroy();
            }

            const sortedMetrics = [...bodyMetrics].sort((a, b) => new Date(a.date) - new Date(b.date));

            const labels = sortedMetrics.map(m =>
                new Date(m.date).toLocaleDateString('ru-RU', { day: 'numeric', month: 'short' })
            );
            const data = sortedMetrics.map(m => parseFloat(m.body_fat_percent));

            bodyFatChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '% –∂–∏—Ä–∞',
                        data: data,
                        borderColor: '#4CAF50',
                        backgroundColor: 'rgba(76, 175, 80, 0.1)',
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            ticks: {
                                callback: value => parseFloat(value).toFixed(1) + '%'
                            }
                        }
                    }
                }
            });
        }

        /**
         * –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ—Ä–µ–Ω–∏–π
         */
        function renderBodyMetricsHistory() {
            const container = document.getElementById('body-metrics-history-list');

            container.innerHTML = bodyMetrics.slice(0, 10).map(m => {
                const date = new Date(m.date);
                const dateStr = date.toLocaleDateString('ru-RU', { day: 'numeric', month: 'long' });

                return `
                    <div class="body-metric-history-card">
                        <div class="body-metric-date">${dateStr}</div>
                        <div class="body-metric-values">
                            <span class="body-metric-tag">‚öñÔ∏è ${m.weight} –∫–≥</span>
                            <span class="body-metric-tag">üìâ ${m.body_fat_percent}%</span>
                            <span class="body-metric-tag">üìè ${m.waist} —Å–º</span>
                            <span class="body-metric-tag">üëî ${m.neck} —Å–º</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        /**
         * –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–º–µ—Ä–µ–Ω–∏–π —Ç–µ–ª–∞
         */
        async function saveBodyMetric() {
            const height = parseFloat(document.getElementById('input-height').value);
            const weight = parseFloat(document.getElementById('input-weight').value);
            const neck = parseFloat(document.getElementById('input-neck').value);
            const waist = parseFloat(document.getElementById('input-waist').value);

            if (!height || !weight || !neck || !waist) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                return;
            }

            if (waist <= neck) {
                alert('–û—Ö–≤–∞—Ç —Ç–∞–ª–∏–∏ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –±–æ–ª—å—à–µ –æ—Ö–≤–∞—Ç–∞ —à–µ–∏');
                return;
            }

            const bodyFat = calculateBodyFat(height, neck, waist);

            const metric = {
                date: new Date().toISOString().split('T')[0],
                height: height,
                weight: weight,
                neck: neck,
                waist: waist,
                body_fat_percent: bodyFat
            };

            if (isDemo) {
                showDemoSaveModal();
                return;
            }

            try {
                document.getElementById('loading').classList.remove('hidden');
                await API.addBodyMetric(metric);

                // –û—á–∏—â–∞–µ–º –ø–æ–ª—è (–∫—Ä–æ–º–µ —Ä–æ—Å—Ç–∞)
                document.getElementById('input-weight').value = '';
                document.getElementById('input-neck').value = '';
                document.getElementById('input-waist').value = '';
                document.getElementById('body-fat-preview').style.display = 'none';

                alert('–ò–∑–º–µ—Ä–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');

                // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                await loadBodyMetrics();
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + error.message);
            } finally {
                document.getElementById('loading').classList.add('hidden');
            }
        }
    </script>
</body>
</html>
